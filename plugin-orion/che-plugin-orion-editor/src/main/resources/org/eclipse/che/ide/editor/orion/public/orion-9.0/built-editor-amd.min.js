/*

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013,2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others. All rights reserved.
 This program and the accompanying materials are made available under the
 terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: 
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2013, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
(function(){function t(l,m,h,d,q,b){m[l]&&(h.push(l),(!0===m[l]||1===m[l])&&d.push(q+l+"/"+b))}function x(l,m,h,d,q){m=d+m+"/"+q;require._fileExists(l.toUrl(m+".js"))&&h.push(m)}function v(l,m,h){for(var d in m)m.hasOwnProperty(d)&&(!l.hasOwnProperty(d)||h)?l[d]=m[d]:"object"===typeof m[d]&&(!l[d]&&m[d]&&(l[d]={}),v(l[d],m[d],h))}var d=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(l){var m=l.config?l.config():{};return{version:"2.0.4",load:function(h,l,q,b){b=b||{};b.locale&&
(m.locale=b.locale);var a=d.exec(h),k=a[1],c=a[4],f=a[5],p=c.split("-"),n=[],g={},w,r="";a[5]?(k=a[1],h=k+f):(f=a[4],c=m.locale,c||(c=m.locale="undefined"===typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),p=c.split("-"));if(b.isBuild){n.push(h);x(l,"root",n,k,f);for(w=0;w<p.length;w++)c=p[w],r+=(r?"-":"")+c,x(l,r,n,k,f);if(b.locales)for(a=0;a<b.locales.length;a++){c=b.locales[a];p=c.split("-");r="";for(h=0;h<p.length;h++)c=p[h],r+=(r?"-":"")+c,x(l,r,n,k,
f)}l(n,function(){q()})}else l([h],function(a){var b=[],c;t("root",a,b,n,k,f);for(w=0;w<p.length;w++)c=p[w],r+=(r?"-":"")+c,t(r,a,b,n,k,f);l(n,function(){var c,p,e;for(c=b.length-1;-1<c&&b[c];c--){e=b[c];p=a[e];if(!0===p||1===p)p=l(k+e+"/"+f);v(g,p)}q(g)})})}}})})();define("orion/editor/nls/messages",{root:!0});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",diffAdded:"Diff Added Lines",diffDeleted:"Diff Deleted Lines",diffModified:"Diff Modified Lines",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",
charNext:"Next Character",pageUp:"Page Up",pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",
selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",
deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",escape:"Escape",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",
setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",
findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",
collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode: Enter or ESC to exit",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Column ${1}",multiSelections:"${0} selection regions",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",
vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page",
"vi/":"${0} Search Forward","vi?":"${0} Search Backward",vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",
viR:"Begin Overwriting Text",vis:"Substitute a Character",viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",next:"Next",previous:"Previous",replace:"Replace",replaceAll:"Replace All",findWith:"Find With",replaceWith:"Replace With",caseInsensitive:"Aa",regex:"/.*/",wholeWord:"\\b",caseInsensitiveTooltip:"Toggle Case Insensitive",regexTooltip:"Toggle Regex",wholeWordTooltip:"Toggle Whole Word",
closeTooltip:"Close",replacingAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",notFound:"Not found"});
define("orion/editor/eventTarget",[],function(){function t(){}t.addMixin=function(x){var v=t.prototype,d;for(d in v)v.hasOwnProperty(d)&&(x[d]=v[d])};t.prototype={addEventListener:function(t,v,d){this._eventTypes||(this._eventTypes={});var l=this._eventTypes[t];l||(l=this._eventTypes[t]={level:0,listeners:[]});l.listeners.push({listener:v,useCapture:d})},dispatchEvent:function(t){var v=t.type;this._dispatchEvent("pre"+v,t);this._dispatchEvent(v,t);this._dispatchEvent("post"+v,t)},_dispatchEvent:function(t,
v){var d=this._eventTypes?this._eventTypes[t]:null;if(d){var l=d.listeners;try{if(d.level++,l)for(var m=0,h=l.length;m<h;m++)if(l[m]){var s=l[m].listener;"function"===typeof s?s.call(this,v):s.handleEvent&&"function"===typeof s.handleEvent&&s.handleEvent(v)}}finally{if(d.level--,d.compact&&0===d.level){for(m=l.length-1;0<=m;m--)l[m]||l.splice(m,1);0===l.length&&delete this._eventTypes[t];d.compact=!1}}}},isListening:function(t){return!this._eventTypes?!1:void 0!==this._eventTypes[t]},removeEventListener:function(t,
v,d){if(this._eventTypes){var l=this._eventTypes[t];if(l){for(var m=l.listeners,h=0,s=m.length;h<s;h++){var q=m[h];if(q&&q.listener===v&&q.useCapture===d){0!==l.level?(m[h]=null,l.compact=!0):m.splice(h,1);break}}0===m.length&&delete this._eventTypes[t]}}}};return{EventTarget:t}});define("orion/regex",[],function(){return{escape:function(t){return t.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(t){return(t=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(t))?{pattern:t[1],flags:t[2]}:null}}});
define("orion/util",[],function(){var t=navigator.userAgent,x=-1!==t.indexOf("MSIE")||-1!==t.indexOf("Trident")?document.documentMode:void 0,v=parseFloat(t.split("Firefox/")[1]||t.split("Minefield/")[1])||void 0,d=-1!==t.indexOf("Opera")?parseFloat(t.split("Version/")[1]):void 0,l=parseFloat(t.split("Chrome/")[1])||void 0,m=-1!==t.indexOf("Safari")&&!l,h=parseFloat(t.split("WebKit/")[1])||void 0,s=-1!==t.indexOf("Android"),q=-1!==t.indexOf("iPad"),t=-1!==t.indexOf("iPhone"),b=q||t,a=-1!==navigator.platform.indexOf("Mac"),
k=-1!==navigator.platform.indexOf("Win"),c=-1!==navigator.platform.indexOf("Linux"),f="undefined"!==typeof document&&"ontouchstart"in document.createElement("input");return{formatMessage:function(a){var b=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,c){return b[(c<<0)+1]})},createElement:function(a,b){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",b):a.createElement(b)},isIE:x,isFirefox:v,isOpera:d,isChrome:l,isSafari:m,isWebkit:h,isAndroid:s,isIPad:q,isIPhone:t,
isIOS:b,isMac:a,isWindows:k,isLinux:c,isTouch:f,platformDelimiter:k?"\r\n":"\n"}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(t,x,v){function d(l,m){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(l);this.setLineDelimiter(m)}d.prototype={destroy:function(){},find:function(l){1<this._text.length&&(this._text=[this._text.join("")]);var m=l.string,h=l.regex,d=m,q="",b=l.caseInsensitive;if(d)if(h){if(m=x.parse(d))d=m.pattern,q=m.flags}else d=m.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"),b&&(d=d.replace(/[iI\u0130\u0131]/g,
"[Ii\u0130\u0131]"));var a=null,k;if(d){var m=l.reverse,c=l.wrap,h=l.wholeWord,f=l.start||0;l=l.end;var p=null!==l&&void 0!==l;-1===q.indexOf("g")&&(q+="g");-1===q.indexOf("m")&&(q+="m");b&&-1===q.indexOf("i")&&(q+="i");h&&(d="\\b"+d+"\\b");var n=this._text[0],g,w,r=0;p&&(b=f<l?f:l,n=n.substring(b,f<l?l:f),r=b);var y=RegExp(d,q);m?k=function(){var a=null;for(y.lastIndex=0;;){w=y.lastIndex;g=y.exec(n);if(w===y.lastIndex)return null;if(g){if(!(g.index+r<f)){if(!c||a)break;f=n.length+r}a={start:g.index+
r,end:y.lastIndex+r}}else break}a&&(f=a.start);return a}:(p||(y.lastIndex=f),k=function(){for(;;){w=y.lastIndex;g=y.exec(n);if(w===y.lastIndex)break;if(g)return{start:g.index+r,end:y.lastIndex+r};if(!(0!==w&&c))break}return null});a=k()}return{next:function(){var b=a;b&&(a=k());return b},hasNext:function(){return null!==a}}},getCharCount:function(){for(var l=0,m=0;m<this._text.length;m++)l+=this._text[m].length;return l},getLine:function(l,m){var h=this.getLineCount();if(!(0<=l&&l<h))return null;
var d=this._lineOffsets[l];if(l+1<h){h=this.getText(d,this._lineOffsets[l+1]);if(m)return h;for(var d=h.length,q;10===(q=h.charCodeAt(d-1))||13===q;)d--;return h.substring(0,d)}return this.getText(d)},getLineAtOffset:function(l){var d=this.getCharCount();if(!(0<=l&&l<=d))return-1;var h=this.getLineCount();if(l===d)return h-1;var s,q,b=this._lastLineIndex;if(0<=b&&b<h&&(s=this._lineOffsets[b],q=b+1<h?this._lineOffsets[b+1]:d,s<=l&&l<q))return b;for(var a=h,k=-1;1<a-k;)if(b=Math.floor((a+k)/2),s=this._lineOffsets[b],
q=b+1<h?this._lineOffsets[b+1]:d,l<=s)a=b;else if(l<q){a=b;break}else k=b;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(l,d){var h=this.getLineCount();if(!(0<=l&&l<h))return-1;if(l+1<h){h=this._lineOffsets[l+1];if(d)return h;for(var s=this.getText(Math.max(this._lineOffsets[l],h-2),h),q=s.length,b;10===(b=s.charCodeAt(q-1))||13===b;)q--;return h-(s.length-q)}return this.getCharCount()},
getLineStart:function(l){return!(0<=l&&l<this.getLineCount())?-1:this._lineOffsets[l]},getText:function(l,d){void 0===l&&(l=0);void 0===d&&(d=this.getCharCount());if(l===d)return"";for(var h=0,s=0,q;s<this._text.length;){q=this._text[s].length;if(l<=h+q)break;h+=q;s++}for(var b=h,a=s;s<this._text.length;){q=this._text[s].length;if(d<=h+q)break;h+=q;s++}if(a===s)return this._text[a].substring(l-b,d-h);b=this._text[a].substring(l-b);h=this._text[s].substring(0,d-h);return b+this._text.slice(a+1,s).join("")+
h},onChanging:function(l){return this.dispatchEvent(l)},onChanged:function(l){return this.dispatchEvent(l)},setLineDelimiter:function(l,d){"auto"===l&&(l=void 0,1<this.getLineCount()&&(l=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=l?l:v.platformDelimiter;if(d){var h=this.getLineCount();if(1<h){for(var s=Array(h),q=0;q<h;q++)s[q]=this.getLine(q);this.setText(s.join(this._lineDelimiter))}}},setText:function(l,d,h){void 0===l&&(l="");void 0===d&&(d=0);void 0===h&&(h=
this.getCharCount());if(!(d===h&&""===l)){for(var s=this.getLineAtOffset(d),q=this.getLineAtOffset(h),b=d,a=h-d,k=q-s,c=l.length,f=0,p=this.getLineCount(),n=0,g=0,w=0,r=[];;){-1!==n&&n<=w&&(n=l.indexOf("\r",w));-1!==g&&g<=w&&(g=l.indexOf("\n",w));if(-1===g&&-1===n)break;w=-1!==n&&-1!==g?n+1===g?g+1:(n<g?n:g)+1:-1!==n?n+1:g+1;r.push(d+w);f++}this.onChanging({type:"Changing",text:l,start:b,removedCharCount:a,addedCharCount:c,removedLineCount:k,addedLineCount:f});0===r.length&&(w=this.getLineStart(s),
q=q+1<p?this.getLineStart(q+1):this.getCharCount(),d!==w&&(l=this.getText(w,d)+l,d=w),h!==q&&(l+=this.getText(h,q),h=q));w=c-a;for(q=s+k+1;q<p;q++)this._lineOffsets[q]+=w;if(5E4>r.length)s=[s+1,k].concat(r),Array.prototype.splice.apply(this._lineOffsets,s);else{w=s+1;this._lineOffsets.splice(w,k);for(p=0;p<r.length;p+=5E4)s=[w,0].concat(r.slice(p,Math.min(r.length,p+5E4))),Array.prototype.splice.apply(this._lineOffsets,s),w+=5E4}for(w=p=0;w<this._text.length;){q=this._text[w].length;if(d<=p+q)break;
p+=q;w++}s=p;for(r=w;w<this._text.length;){q=this._text[w].length;if(h<=p+q)break;p+=q;w++}q=this._text[w];d=this._text[r].substring(0,d-s);h=q.substring(h-p);r=[r,w-r+1];d&&r.push(d);l&&r.push(l);h&&r.push(h);Array.prototype.splice.apply(this._text,r);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:b,removedCharCount:a,addedCharCount:c,removedLineCount:k,addedLineCount:f})}}};t.EventTarget.addMixin(d.prototype);return{TextModel:d}});
define("orion/keyBinding",["orion/util"],function(t){function x(d,l,m,h,s,q){this.type=q||"keydown";this.keyCode="string"===typeof d&&"keydown"===this.type?d.toUpperCase().charCodeAt(0):d;this.mod1=void 0!==l&&null!==l?l:!1;this.mod2=void 0!==m&&null!==m?m:!1;this.mod3=void 0!==h&&null!==h?h:!1;this.mod4=void 0!==s&&null!==s?s:!1}function v(d){this.keys=d}x.prototype={getKeys:function(){return[this]},match:function(d,l){if(void 0!==l){if(0!==l)return!1}else if(d instanceof Array){if(1<d.length)return!1;
d=d[0]}return d.type!==this.type?!1:this.keyCode===d.keyCode||this.keyCode===String.fromCharCode(t.isOpera?d.which:void 0!==d.charCode?d.charCode:d.keyCode)?this.mod1!==(t.isMac?d.metaKey:d.ctrlKey)||"keydown"===this.type&&this.mod2!==d.shiftKey||this.mod3!==d.altKey||t.isMac&&this.mod4!==d.ctrlKey?!1:!0:!1},equals:function(d){return!d||this.keyCode!==d.keyCode||this.mod1!==d.mod1||this.mod2!==d.mod2||this.mod3!==d.mod3||this.mod4!==d.mod4||this.type!==d.type?!1:!0}};v.prototype={getKeys:function(){return this.keys.slice(0)},
match:function(d,l){var m=this.keys;if(void 0!==l)return l>m.length?!1:m[l].match(d)?l===m.length-1?!0:l+1:!1;d instanceof Array||(d=[d]);if(d.length>m.length)return!1;var h;for(h=0;h<d.length;h++)if(!m[h].match(d[h]))return!1;return h===m.length?!0:h},equals:function(d){if(!d.keys||d.keys.length!==this.keys.length)return!1;for(var l=0;l<d.keys.length;l++)if(!d.keys[l].equals(this.keys[l]))return!1;return!0}};return{KeyBinding:x,KeyStroke:x,KeySequence:v}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(t,x){function v(d){d&&(this._view=d,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function d(d){v.call(this,d)}v.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(d){for(var m=[],h=this._keyBindings,s=0;s<h.length;s++)h[s].actionID===d&&m.push(h[s].keyBinding);return m},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(d){if("keydown"===
d.type)switch(d.keyCode){case 16:case 17:case 18:case 91:return}for(var m=this._keyBindingIndex,h=this._matchingKeyBindings||this._keyBindings,s=[],q=0;q<h.length;q++){var b=h[q],a=b.keyBinding.match(d,m);if(!0===a)return this._keyBindingIndex=0,this._matchingKeyBindings=null,b.actionID;"number"===typeof a&&s.push(b)}if(0===s.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=s,"noop"},setKeyBinding:function(d,m){for(var h=this._keyBindings,
s=0;s<h.length;s++){var q=h[s];if(q.keyBinding.equals(d)){m?q.actionID=m:q.predefined?q.actionID="noop":h.splice(s,1);return}}m&&h.push({keyBinding:d,actionID:m})},setView:function(d){this._view=d}};d.prototype=new v;d.prototype.createKeyBindings=function(){var d=t.KeyBinding,m=[];m.push({actionID:"lineUp",keyBinding:new d(38),predefined:!0});m.push({actionID:"lineDown",keyBinding:new d(40),predefined:!0});m.push({actionID:"charPrevious",keyBinding:new d(37),predefined:!0});m.push({actionID:"charNext",
keyBinding:new d(39),predefined:!0});x.isMac?(m.push({actionID:"scrollPageUp",keyBinding:new d(33),predefined:!0}),m.push({actionID:"scrollPageDown",keyBinding:new d(34),predefined:!0}),m.push({actionID:"pageUp",keyBinding:new d(33,null,null,!0),predefined:!0}),m.push({actionID:"pageDown",keyBinding:new d(34,null,null,!0),predefined:!0}),m.push({actionID:"lineStart",keyBinding:new d(37,!0),predefined:!0}),m.push({actionID:"lineEnd",keyBinding:new d(39,!0),predefined:!0}),m.push({actionID:"wordPrevious",
keyBinding:new d(37,null,null,!0),predefined:!0}),m.push({actionID:"wordNext",keyBinding:new d(39,null,null,!0),predefined:!0}),m.push({actionID:"scrollTextStart",keyBinding:new d(36),predefined:!0}),m.push({actionID:"scrollTextEnd",keyBinding:new d(35),predefined:!0}),m.push({actionID:"textStart",keyBinding:new d(38,!0),predefined:!0}),m.push({actionID:"textEnd",keyBinding:new d(40,!0),predefined:!0}),m.push({actionID:"scrollPageUp",keyBinding:new d(38,null,null,null,!0),predefined:!0}),m.push({actionID:"scrollPageDown",
keyBinding:new d(40,null,null,null,!0),predefined:!0}),m.push({actionID:"lineStart",keyBinding:new d(37,null,null,null,!0),predefined:!0}),m.push({actionID:"lineEnd",keyBinding:new d(39,null,null,null,!0),predefined:!0}),m.push({actionID:"lineStart",keyBinding:new d(38,null,null,!0),predefined:!0}),m.push({actionID:"lineEnd",keyBinding:new d(40,null,null,!0),predefined:!0})):(m.push({actionID:"pageUp",keyBinding:new d(33),predefined:!0}),m.push({actionID:"pageDown",keyBinding:new d(34),predefined:!0}),
m.push({actionID:"lineStart",keyBinding:new d(36),predefined:!0}),m.push({actionID:"lineEnd",keyBinding:new d(35),predefined:!0}),m.push({actionID:"wordPrevious",keyBinding:new d(37,!0),predefined:!0}),m.push({actionID:"wordNext",keyBinding:new d(39,!0),predefined:!0}),m.push({actionID:"textStart",keyBinding:new d(36,!0),predefined:!0}),m.push({actionID:"textEnd",keyBinding:new d(35,!0),predefined:!0}));x.isFirefox&&x.isLinux&&(m.push({actionID:"lineUp",keyBinding:new d(38,!0),predefined:!0}),m.push({actionID:"lineDown",
keyBinding:new d(40,!0),predefined:!0}));x.isWindows&&(m.push({actionID:"scrollLineUp",keyBinding:new d(38,!0),predefined:!0}),m.push({actionID:"scrollLineDown",keyBinding:new d(40,!0),predefined:!0}));m.push({actionID:"selectLineUp",keyBinding:new d(38,null,!0),predefined:!0});m.push({actionID:"selectLineDown",keyBinding:new d(40,null,!0),predefined:!0});m.push({actionID:"selectCharPrevious",keyBinding:new d(37,null,!0),predefined:!0});m.push({actionID:"selectCharNext",keyBinding:new d(39,null,!0),
predefined:!0});m.push({actionID:"selectPageUp",keyBinding:new d(33,null,!0),predefined:!0});m.push({actionID:"selectPageDown",keyBinding:new d(34,null,!0),predefined:!0});x.isMac?(m.push({actionID:"selectLineStart",keyBinding:new d(37,!0,!0),predefined:!0}),m.push({actionID:"selectLineEnd",keyBinding:new d(39,!0,!0),predefined:!0}),m.push({actionID:"selectWordPrevious",keyBinding:new d(37,null,!0,!0),predefined:!0}),m.push({actionID:"selectWordNext",keyBinding:new d(39,null,!0,!0),predefined:!0}),
m.push({actionID:"selectTextStart",keyBinding:new d(36,null,!0),predefined:!0}),m.push({actionID:"selectTextEnd",keyBinding:new d(35,null,!0),predefined:!0}),m.push({actionID:"selectTextStart",keyBinding:new d(38,!0,!0),predefined:!0}),m.push({actionID:"selectTextEnd",keyBinding:new d(40,!0,!0),predefined:!0}),m.push({actionID:"selectLineStart",keyBinding:new d(37,null,!0,null,!0),predefined:!0}),m.push({actionID:"selectLineEnd",keyBinding:new d(39,null,!0,null,!0),predefined:!0}),m.push({actionID:"selectLineStart",
keyBinding:new d(38,null,!0,!0),predefined:!0}),m.push({actionID:"selectLineEnd",keyBinding:new d(40,null,!0,!0),predefined:!0})):(x.isLinux&&(m.push({actionID:"selectWholeLineUp",keyBinding:new d(38,!0,!0),predefined:!0}),m.push({actionID:"selectWholeLineDown",keyBinding:new d(40,!0,!0),predefined:!0})),m.push({actionID:"selectLineStart",keyBinding:new d(36,null,!0),predefined:!0}),m.push({actionID:"selectLineEnd",keyBinding:new d(35,null,!0),predefined:!0}),m.push({actionID:"selectWordPrevious",
keyBinding:new d(37,!0,!0),predefined:!0}),m.push({actionID:"selectWordNext",keyBinding:new d(39,!0,!0),predefined:!0}),m.push({actionID:"selectTextStart",keyBinding:new d(36,!0,!0),predefined:!0}),m.push({actionID:"selectTextEnd",keyBinding:new d(35,!0,!0),predefined:!0}));m.push({actionID:"undo",keyBinding:new t.KeyBinding("z",!0),predefined:!0});x.isMac?m.push({actionID:"redo",keyBinding:new t.KeyBinding("z",!0,!0),predefined:!0}):m.push({actionID:"redo",keyBinding:new t.KeyBinding("y",!0),predefined:!0});
m.push({actionID:"deletePrevious",keyBinding:new d(8),predefined:!0});m.push({actionID:"deletePrevious",keyBinding:new d(8,null,!0),predefined:!0});m.push({actionID:"deleteNext",keyBinding:new d(46),predefined:!0});m.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0),predefined:!0});m.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0,!0),predefined:!0});m.push({actionID:"deleteWordNext",keyBinding:new d(46,!0),predefined:!0});m.push({actionID:"tab",keyBinding:new d(9),predefined:!0});
m.push({actionID:"shiftTab",keyBinding:new d(9,null,!0),predefined:!0});m.push({actionID:"enter",keyBinding:new d(13),predefined:!0});m.push({actionID:"enter",keyBinding:new d(13,null,!0),predefined:!0});m.push({actionID:"escape",keyBinding:new d(27),predefined:!0});m.push({actionID:"selectAll",keyBinding:new d("a",!0),predefined:!0});m.push({actionID:"toggleTabMode",keyBinding:new d("m",!0),predefined:!0});x.isMac&&(m.push({actionID:"deleteNext",keyBinding:new d(46,null,!0),predefined:!0}),m.push({actionID:"deleteWordPrevious",
keyBinding:new d(8,null,null,!0),predefined:!0}),m.push({actionID:"deleteWordNext",keyBinding:new d(46,null,null,!0),predefined:!0}));m.push({actionID:"toggleWrapMode",keyBinding:new t.KeyBinding("w",!0,!1,!0)});m.push({actionID:"toggleOverwriteMode",keyBinding:new t.KeyBinding(45)});if(!x.isFirefox){var h=x.isMac&&x.isChrome;m.push({actionID:"noop",keyBinding:new d("u",!h,!1,!1,h),predefined:!0});m.push({actionID:"noop",keyBinding:new d("i",!h,!1,!1,h),predefined:!0});m.push({actionID:"noop",keyBinding:new d("b",
!h,!1,!1,h),predefined:!0})}x.isFirefox&&(m.push({actionID:"copy",keyBinding:new d(45,!0),predefined:!0}),m.push({actionID:"paste",keyBinding:new d(45,null,!0),predefined:!0}),m.push({actionID:"cut",keyBinding:new d(46,null,!0),predefined:!0}));x.isMac&&(m.push({actionID:"lineStart",keyBinding:new d("a",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"lineEnd",keyBinding:new d("e",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"lineUp",keyBinding:new d("p",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"lineDown",
keyBinding:new d("n",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"charPrevious",keyBinding:new d("b",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"charNext",keyBinding:new d("f",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"deletePrevious",keyBinding:new d("h",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"deleteNext",keyBinding:new d("d",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"deleteLineEnd",keyBinding:new d("k",!1,!1,!1,!0),predefined:!0}),x.isFirefox?(m.push({actionID:"scrollPageDown",
keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"deleteLineStart",keyBinding:new d("u",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"deleteWordPrevious",keyBinding:new d("w",!1,!1,!1,!0),predefined:!0})):(m.push({actionID:"pageDown",keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"centerLine",keyBinding:new d("l",!1,!1,!1,!0),predefined:!0}),m.push({actionID:"enterNoCursor",keyBinding:new d("o",!1,!1,!1,!0),predefined:!0})));return m};return{KeyMode:v,DefaultKeyMode:d}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(t,x,v){function d(d){d=d||{};this._document=d.document||document}var l={};d.getTheme=function(m){m=m||"default";var h=l[m];h||(h=l[m]=new d);return h};d.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(d,h){var l=this,q=l._themeClass;l._themeClass=d;this._load(d,h,function(){l.onThemeChanged({type:"ThemeChanged",oldValue:q,newValue:l.getThemeClass()})})},onThemeChanged:function(d){return this.dispatchEvent(d)},
buildStyleSheet:function(d,h){var l=function(a){return a.replace(this._capitalRegEx,function(a){return"-"+a}.bind(this)).toLowerCase()}.bind(this),q=function(a,b,c,f,p){var n=[];Object.keys(a).forEach(function(g){var w=a[g];"string"===typeof w?n.push("\t"+l(g)+": "+w+";"):q(w,c===g?b:b+(f?" .":".")+g,c,!1,p)});n.length&&(p.push(b+(f?".textview":"")+" {"),p.push.apply(p,n),p.push("}"))},b=[""];q(h.styles,"."+d,h.className,!0,b);return b.join("\n")},_createStyle:function(d,h,l,q){var b=this._document;
d="orion-theme-"+d;var a=b.getElementById(d);if(a){if(q||a.firstChild.data===h)return;a.removeChild(a.firstChild);a.appendChild(b.createTextNode(h))}else q?(a=v.createElement(b,"link"),a.rel="stylesheet",a.type="text/css",a.href=h,a.addEventListener("load",function(){l()})):(a=v.createElement(b,"style"),a.appendChild(b.createTextNode(h))),a.id=d,(b.getElementsByTagName("head")[0]||b.documentElement).appendChild(a);q||l()},_load:function(d,h,l){if(d)if("string"===typeof h)this._createStyle(d,h,l);
else if(h=h.href,".css"!==h.substring(h.length-4)&&(h+=".css"),/^\//.test(h)||/[a-zA-Z0-9]+:\/\//i.test(h)||!t.toUrl)this._createStyle(d,h,l,!0);else{var q=this;t(["text!"+h],function(b){q._createStyle(d,b,l,!1)})}else l()},_capitalRegEx:/[A-Z]/g};x.EventTarget.addMixin(d.prototype);return{TextTheme:d}});
define("orion/editor/util",[],function(){return{contains:function(t,x){if(!x)return!1;if(!t.compareDocumentPosition){for(var v=x;v;){if(t===v)return!0;v=v.parentNode}return!1}return t===x||0!==(t.compareDocumentPosition(x)&16)},getNodeStyle:function(t,x,v){var d;if(t&&(d=t.style[x],!d))if(t.currentStyle){for(d=0;-1!==(d=x.indexOf("-",d));)x=x.substring(0,d)+x.substring(d+1,d+2).toUpperCase()+x.substring(d+2);d=t.currentStyle[x]}else d=(t=t.ownerDocument.defaultView.getComputedStyle(t,null))?t.getPropertyValue(x):
null;return d||v},addEventListener:function(t,x,v,d){"function"===typeof t.addEventListener?t.addEventListener(x,v,!0===d):t.attachEvent("on"+x,v)},removeEventListener:function(t,x,v,d){"function"===typeof t.removeEventListener?t.removeEventListener(x,v,!0===d):t.detachEvent("on"+x,v)},Animation:function(){function t(t){this.options=t}t.prototype.play=function(){var t="number"===typeof this.options.duration?this.options.duration:350,v=this.options.easing||this.defaultEasing,d=this.options.onAnimate||
function(){},l=this.options.curve[0],m=this.options.curve[1],h=m-l,s=-1,q,b=this;this.interval=this.options.window.setInterval(function(){s=-1===s?(new Date).getTime():s;var a=((new Date).getTime()-s)/t;1>a?(a=v(a),q=l+a*h,d(q)):(d(m),b.stop())},"number"===typeof this.options.rate?this.options.rate:20)};t.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};t.prototype.defaultEasing=function(t){return Math.sin(t*(Math.PI/2))};return t}()}});
define("orion/metrics",[],function(){function t(d,l){var m=window.location.protocol+"//"+window.location.hostname+window.location.pathname+window.location.search,h=window.location.pathname+window.location.search,s=document.title;v=d;v.forEach(function(d){d.pageLoad(m,h,s,l)})}function x(d,l,m,h){v.forEach(function(s){s.logTiming(d,l,m,h)})}var v=[];return{init:t,initFromRegistry:function(d,l){var m=[];d.getServiceReferences("orion.metrics").forEach(function(h){m.push(d.getService(h))});t(m,l)},logEvent:function(d,
l,m,h){v.forEach(function(s){s.logEvent(d,l,m,h)})},logPageLoadTiming:function(d,l){window.performance&&(window.performance.getEntriesByName&&window.performance.mark&&!window.performance.getEntriesByName(d).length)&&(window.performance.mark(d),x("page",d,window.performance.now(),l))},logTiming:x}});
define("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util orion/metrics".split(" "),function(t,x,v,d,l,m,h,s){function q(e,u,a){if(a){u.className="";a=u.attributes;for(var b=a.length;0<b--;)(!h.isIE||9<=h.isIE||9>h.isIE&&a[b].specified)&&u.removeAttribute(a[b].name)}if(e){e.styleClass&&(u.className=e.styleClass);if(a=e.style)for(var c in a)a.hasOwnProperty(c)&&(u.style[c]=
a[c]);if(e=e.attributes)for(var g in e)e.hasOwnProperty(g)&&u.setAttribute(g,e[g])}}function b(e){return e instanceof Array?e.slice(0):e}function a(e,u){if(!e)return u;if(!u)return e;for(var a in u)u.hasOwnProperty(a)&&(e.hasOwnProperty(a)||(e[a]=u[a]));return e}function k(e,u){if(e===u)return!0;if(e&&!u||!e&&u||e&&e.constructor===String||u&&u.constructor===String)return!1;if(e instanceof Array||u instanceof Array){if(!(e instanceof Array&&u instanceof Array)||e.length!==u.length)return!1;for(var a=
0;a<e.length;a++)if(!k(e[a],u[a]))return!1;return!0}if(!(e instanceof Object)||!(u instanceof Object))return!1;for(a in e)if(e.hasOwnProperty(a)&&(!u.hasOwnProperty(a)||!k(e[a],u[a])))return!1;for(a in u)if(!e.hasOwnProperty(a))return!1;return!0}function c(e,u,a){for(var b=0,c=0,g=0,f=e.length;g<f;){-1!==b&&b<=g&&(b=e.indexOf("\r",g));-1!==c&&c<=g&&(c=e.indexOf("\n",g));var k=g,p;if(-1===c&&-1===b){u(e.substring(g));break}-1!==b&&-1!==c?b+1===c?(p=b,g=c+1):(p=b<c?b:c,g=(b<c?b:c)+1):-1!==b?(p=b,g=
b+1):(p=c,g=c+1);u(e.substring(k,p));a?a():g===f&&u("")}}function f(e){var u,a,b,c,g=e.ownerDocument.defaultView||e.ownerDocument.parentWindow;g.getComputedStyle?(e=g.getComputedStyle(e,null),u=e.getPropertyValue("padding-left"),a=e.getPropertyValue("padding-top"),b=e.getPropertyValue("padding-right"),c=e.getPropertyValue("padding-bottom")):e.currentStyle&&(u=e.currentStyle.paddingLeft,a=e.currentStyle.paddingTop,b=e.currentStyle.paddingRight,c=e.currentStyle.paddingBottom);return{left:parseInt(u,
10)||0,top:parseInt(a,10)||0,right:parseInt(b,10)||0,bottom:parseInt(c,10)||0}}function p(e){var u,a,b,c,g=e._trim;if(!g){var g=f(e),k=e.ownerDocument.defaultView||e.ownerDocument.parentWindow;k.getComputedStyle?(c=k.getComputedStyle(e,null),u=c.getPropertyValue("border-left-width"),a=c.getPropertyValue("border-top-width"),b=c.getPropertyValue("border-right-width"),c=c.getPropertyValue("border-bottom-width")):e.currentStyle&&(u=e.currentStyle.borderLeftWidth,a=e.currentStyle.borderTopWidth,b=e.currentStyle.borderRightWidth,
c=e.currentStyle.borderBottomWidth);u=parseInt(u,10)||0;a=parseInt(a,10)||0;b=parseInt(b,10)||0;c=parseInt(c,10)||0;g.left+=u;g.top+=a;g.right+=b;g.bottom+=c;e._trim=g}return g}function n(e,u,a,b){function c(u){if(u.animationName===f){var a=u.target;"function"===typeof a.__DOMReady&&(e.defaultView||e.parentWindow).setTimeout(function(){a.__DOMReady()},0)}}function g(e,u){for(var a=["","-webkit-","-moz-","-ms-","-o-"],B="",b="body ."+e+" {\n",c=0;c<a.length;c++)B+="@"+a[c]+"keyframes "+u+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",
b+=a[c]+"animation-duration: 0.001s;\n"+a[c]+"animation-name: "+u+";\n";return B+(b+"}")}a="_"+a+"DOMReady";u.className=u.className?u.className+" "+a:a;u.__DOMReady=b;b=a+"Style";if(!e.getElementById(b)){var f=a+"Animation";C(e,"animationstart",c,!1);C(e,"MSAnimationStart",c,!1);C(e,"webkitAnimationStart",c,!1);u=e.createElement("style");u.id=b;b=e.getElementsByTagName("head")[0]||e.documentElement;u.appendChild(e.createTextNode(g(a,f)));b.insertBefore(u,b.firstChild)}}function g(e,u,a){this.start=
e;this.end=u;this.caret=a;this._columnX=-1}function w(e){this._view=e;this._divs=[];for(var u=e._clipDiv||e._rootDiv,a=0;3>a;a++){var b=e._createSelectionDiv();u.appendChild(b);this._divs.push(b)}}function r(e){this.left=e.left;this.top=e.top;this.right=e.right;this.bottom=e.bottom}function y(e,u,a){this.view=e;this.lineIndex=u;this._lineDiv=a}function A(e){this._init(e||{})}var C=m.addEventListener,z=m.removeEventListener,D=m.Animation;g.compare=function(e,u){if(e.length!==u.length)return!1;for(var a=
0;a<e.length;a++)if(!e[a].equals(u[a]))return!1;return!0};g.editing=function(e,u){var a;if(u){for(a=e.length-1;0<=a;a--)if(e[a]._editing)return e[a];return e[e.length-1]}for(a=0;a<e.length;a++)if(e[a]._editing)return e[a];return e[0]};g.convert=function(e){return 1===e.length?e[0]:e};g.contains=function(e,u){return e.some(function(e){return e.contains(u)})};g.merge=function(e){if(1>=e.length)return e;e.sort(function(e,u){return e.start-u.start});for(var u=[],a=e[0],b=1;b<e.length;b++)e[b].start>=
a.end||a._editing||e[b]._editing?(u.push(a),a=e[b]):a.end=Math.max(a.end,e[b].end);u.push(a);return u};g.prototype={clone:function(){var e=new g(this.start,this.end,this.caret);e._columnX=this._columnX;e._editing=this._editing;e._docX=this._docX;return e},contains:function(e){return this.start<=e&&e<this.end?!0:!1},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(e){this.caret?this.start=e:this.end=e;this.start>this.end&&(e=this.start,this.start=this.end,this.end=
e,this.caret=!this.caret)},setCaret:function(e){this.end=this.start=e;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},getAnchor:function(){return this.caret?this.end:this.start},getOrientedSelection:function(){return{start:this.getAnchor(),end:this.getCaret()}},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(e){return this.caret===e.caret&&
this.start===e.start&&this.end===e.end&&this._editing===e._editing}};w.prototype={destroy:function(){this._divs&&(this._divs.forEach(function(e){e.parentNode.removeChild(e)}),this._divs=null)},setPrimary:function(e){this.primary=e},update:function(){var e=this._view,u=this.primary,a=e._hasFocus,e=e._cursorVisible,b=!this.primary&&this._selection&&this._selection.isEmpty(),c;c=b?"textviewSelectionCaret":a?"textviewSelection":"textviewSelectionUnfocused";this._divs[0].style.visibility=b&&e&&a||!b?"visible":
"hidden";this._divs[0].style.zIndex=e&&b?"2":"0";this._divs.forEach(function(e){e.className=c;h.isWebkit&&u&&(e.style.background=a?"transparent":"")})},setSelection:function(e){this._selection=e;this.update();var u=this._view,a=u._model,b=a.getLineAtOffset(e.start),c=a.getLineAtOffset(e.end),g=u._getLineNext();if(g){var f=u._getLinePrevious(),k;b<g.lineIndex?(b=g,k=a.getLineStart(g.lineIndex)):b>f.lineIndex?(b=f,k=a.getLineStart(f.lineIndex)):(b=u._getLineNode(b),k=e.start);c<g.lineIndex?(u=g,a=a.getLineStart(g.lineIndex)):
c>f.lineIndex?(u=f,a=a.getLineStart(f.lineIndex)):(u=u._getLineNode(c),a=e.end);this._setDOMSelection(b,k,u,a,e.caret)}},_setDOMSelection:function(e,u,a,b,c){this._setDOMFullSelection(e,u,a,b);if(this.primary){var g=this._view;e=e._line.getNodeOffset(u);a=a._line.getNodeOffset(b);if(e.node&&a.node)if(b=g._getWindow(),u=g._parent.ownerDocument,b.getSelection){var f=b.getSelection();b=u.createRange();b.setStart(e.node,e.offset);b.setEnd(a.node,a.offset);if(g._hasFocus&&(f.anchorNode!==e.node||f.anchorOffset!==
e.offset||f.focusNode!==a.node||f.focusOffset!==a.offset||f.anchorNode!==a.node||f.anchorOffset!==a.offset||f.focusNode!==e.node||f.focusOffset!==e.offset))g._anchorNode=e.node,g._anchorOffset=e.offset,g._focusNode=a.node,g._focusOffset=a.offset,g._ignoreSelect=!1,0<f.rangeCount&&f.removeAllRanges(),f.addRange(b),g._ignoreSelect=!0;g._cursorDiv&&(b=u.createRange(),c?(b.setStart(e.node,e.offset),b.setEnd(e.node,e.offset)):(b.setStart(a.node,a.offset),b.setEnd(a.node,a.offset)),c=b.getClientRects()[0],
e=g._cursorDiv.parentNode,a=e.getBoundingClientRect(),c&&a&&(g._cursorDiv.style.top=c.top-a.top+e.scrollTop+"px",g._cursorDiv.style.left=c.left-a.left+e.scrollLeft+"px"))}else u.selection&&g._hasFocus&&(c=u.body,b=h.createElement(u,"div"),c.appendChild(b),c.removeChild(b),b=c.createTextRange(),b.moveToElementText(e.node.parentNode),b.moveStart("character",e.offset),c=c.createTextRange(),c.moveToElementText(a.node.parentNode),c.moveStart("character",a.offset),b.setEndPoint("EndToStart",c),g._ignoreSelect=
!1,b.select(),g._ignoreSelect=!0)}},_setDOMFullSelection:function(e,u,a,b){this._divs.forEach(function(e){e.style.width=e.style.height="0px"});var c=this._view;if(c._fullSelection&&!h.isIOS&&!(e===a&&u===b&&this.primary)){var g=c._getViewPadding(),f=c._clientDiv.getBoundingClientRect(),k=c._viewDiv.getBoundingClientRect(),p=k.left+g.left,n=f.right,g=k.top+g.top,r=f.bottom,k=f=0;c._clipDiv?(k=c._clipDiv.getBoundingClientRect(),f=k.left-c._clipDiv.scrollLeft):(k=c._rootDiv.getBoundingClientRect(),f=
k.left);k=k.top;c._ignoreDOMSelection=!0;var w=new y(c,e.lineIndex,e),d=w.getBoundingClientRect(u,!1),q=d.left;e===a&&u===b?(u=w,b=d):(u=new y(c,a.lineIndex,a),b=u.getBoundingClientRect(b,!1));u=b.left;c._ignoreDOMSelection=!1;var w=this._divs[0],q=Math.min(n,Math.max(p,q)),m=Math.min(r,Math.max(g,d.top)),l=n,c=Math.min(r,Math.max(g,d.bottom));w.style.left=q-f+"px";w.style.top=m-k+"px";w.style.width=Math.max(0,l-q)+"px";w.style.height=Math.max(0,c-m)+"px";e.lineIndex===a.lineIndex?(l=Math.min(u,n),
w.style.width=Math.max(this.primary?0:1,l-q)+"px"):(d=Math.min(r,Math.max(g,b.top)),u=Math.min(n,Math.max(p,u)),g=Math.min(r,Math.max(g,b.bottom)),r=this._divs[2],r.style.left=p-f+"px",r.style.top=d-k+"px",r.style.width=Math.max(0,u-p)+"px",r.style.height=Math.max(0,g-d)+"px",1<Math.abs(e.lineIndex-a.lineIndex)&&(e=this._divs[1],e.style.left=p-f+"px",e.style.top=c-k+"px",e.style.width=Math.max(0,n-p)+"px",e.style.height=Math.max(0,d-c)+"px"))}}};r.prototype={toString:function(){return"{l\x3d"+this.left+
", t\x3d"+this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};y.prototype={create:function(e,u){if(!this._lineDiv){var a=this._lineDiv=this._createLine(e,u,this.lineIndex);a._line=this;return a}},_createLine:function(e,u,a){var b=this.view,c=b._model,g=c.getLine(a),f=c.getLineStart(a),p={type:"LineStyle",textView:b,lineIndex:a,lineText:g,lineStart:f};b.onLineStyle(p);var n=e.ownerDocument,c=u||h.createElement(n,"div");if(!u||!k(u.viewStyle,p.style))q(p.style,c,u),u&&(u._trim=null),c.viewStyle=
p.style,c.setAttribute("role","presentation");c.lineIndex=a;if(u&&c.viewLineText===g&&k(p.ranges,c.viewRanges))return c;c.viewRanges=p.ranges;c.viewLineText=g;a=[];this._createRanges(p.ranges,g,0,g.length,f,{tabOffset:0,ranges:a});p=" ";!b._fullSelection&&9>h.isIE&&(p="\ufeff");b={text:p,style:b._metrics.largestFontStyle,ignoreChars:1};0===a.length||!a[a.length-1].style||"div"!==a[a.length-1].style.tagName?a.push(b):a.splice(a.length-1,0,b);var r,w,d,y=p=0;if(h.isFirefox&&2E3<g.length){u&&(c.innerHTML=
"",u.lineWidth=void 0);u=n.createDocumentFragment();for(g=0;g<a.length;g++)b=a[g],f=b.text,r=b.style,r=this._createSpan(c,f,r,b.ignoreChars),u.appendChild(r);c.appendChild(u)}else{var m,l;if(u){if(w=u.modelChangedEvent)0===w.removedLineCount&&0===w.addedLineCount?(l=w.start-f,m=w.addedCharCount-w.removedCharCount):l=-1,u.modelChangedEvent=void 0;w=u.firstChild}for(g=0;g<a.length;g++){b=a[g];f=b.text;p+=f.length;r=b.style;if(w)if(d=w.firstChild.data,n=w.viewStyle,d===f&&k(r,n)){y+=d.length;w._rectsCache=
void 0;r=w=w.nextSibling;continue}else for(;w;){if(-1!==l){n=p;n>=l&&(n-=m);d=(d=w.firstChild.data)?d.length:0;if(y+d>n)break;y+=d}n=w.nextSibling;c.removeChild(w);w=n}r=this._createSpan(c,f,r,b.ignoreChars);w?c.insertBefore(r,w):c.appendChild(r);u&&(u.lineWidth=void 0)}if(u)for(m=r?r.nextSibling:null;m;)n=m.nextSibling,u.removeChild(m),m=n}c.parentNode||e.appendChild(c);return c},_createRanges:function(e,u,a,b,c,g){if(!(a>b)){if(e)for(var f=0;f<e.length;f++){var p=e[f];if(!(p.end<c+a)){var n=Math.max(c+
a,p.start)-c;if(n>b)break;var r=Math.min(c+b,p.end)-c;if(n<=r){n=Math.max(a,n);r=Math.min(b,r);a<n&&this._createRange(u,a,n,null,g);if(!p.style||!p.style.unmergeable)for(;f+1<e.length&&e[f+1].start-c===r&&k(p.style,e[f+1].style);)p=e[f+1],r=Math.min(c+b,p.end)-c,f++;this._createRange(u,n,r,p.style,g);a=r}}}a<b&&this._createRange(u,a,b,null,g)}},_createRange:function(e,u,a,b,c){if(!(u>a)){var g=this.view._customTabSize;if(g&&8!==g)for(var f=e.indexOf("\t",u);-1!==f&&f<a;){u<f&&(u={text:e.substring(u,
f),style:b},c.ranges.push(u),c.tabOffset+=u.text.length);u=g-c.tabOffset%g;if(0<u){for(var k="\u00a0",p=1;p<u;p++)k+=" ";u={text:k,style:b,ignoreChars:u-1};c.ranges.push(u);c.tabOffset+=u.text.length}u=f+1;if(u===a)return;f=e.indexOf("\t",u)}u<=a&&(u={text:e.substring(u,a),style:b},c.ranges.push(u),c.tabOffset+=u.text.length)}},_createSpan:function(e,u,a,b){var c=this.view,g="span";a&&a.tagName&&(g=a.tagName.toLowerCase());var f="a"===g;f&&(this.hasLink=!0);f&&!c._linksVisible&&(g="span");f=e.ownerDocument;
e=h.createElement(e.ownerDocument,g);e.appendChild(f.createTextNode(a&&a.text?a.text:u));a&&a.html?(e.innerHTML=a.html,e.ignore=!0):a&&a.node&&(e.appendChild(a.node),e.ignore=!0);q(a,e);if("a"===g){var k=c._getWindow();C(e,"click",function(e){return c._handleLinkClick(e?e:k.event)},!1)}e.viewStyle=a;b&&(e.ignoreChars=b);return e},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(e,u){var a=this._ensureCreated(),
b=this.view;if(void 0===e)return this._getLineBoundingClientRect(a,!0);var c=b._model,g=a.ownerDocument,f=this.lineIndex,k=null;if(e<c.getLineEnd(f)){var p=c.getLineStart(f);this.forEach(function(u){var c=u.firstChild,f=this._nodeLength(u);if(p+f>e){var n=e-p;if(1===c.length)k=new r(u.getBoundingClientRect());else if(b._isRangeRects)f=g.createRange(),f.setStart(c,n),f.setEnd(c,n+1),k=new r(f.getBoundingClientRect());else if(h.isIE)f=g.body.createTextRange(),f.moveToElementText(u),f.collapse(),(c=
0===n&&8===h.isIE)&&(n=1),f.moveEnd("character",n+1),f.moveStart("character",n),k=new r(f.getBoundingClientRect()),c&&(k.left=u.getClientRects()[0].left);else{var w=c.data;u.removeChild(c);u.appendChild(g.createTextNode(w.substring(0,n)));var d=h.createElement(g,"span");d.appendChild(g.createTextNode(w.substring(n,n+1)));u.appendChild(d);u.appendChild(g.createTextNode(w.substring(n+1)));k=new r(d.getBoundingClientRect());u.innerHTML="";u.appendChild(c);this._createdDiv||(u=b._getSelections()[0],(p<=
u.start&&u.start<p+f||p<=u.end&&u.end<p+f)&&b._updateDOMSelection())}11>h.isIE&&(n=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,u=n.screen.logicalXDPI/n.screen.deviceXDPI,n=n.screen.logicalYDPI/n.screen.deviceYDPI,k.left*=u,k.right*=u,k.top*=n,k.bottom*=n);return!1}p+=f;return!0})}c=this.getBoundingClientRect();k||(b._wrapMode?(f=this.getClientRects(),k=f[f.length-1],k.left=k.right,k.left+=c.left,k.top+=c.top,k.right+=c.left,k.bottom+=c.top):(k=new r(c),k.left=k.right));if(u||void 0===
u)k.left-=c.left,k.top-=c.top,k.right-=c.left,k.bottom-=c.top;return k},forEach:function(e){for(var u=this._ensureCreated().firstChild;u;){var a=u.nextSibling;if(!u.ignore&&!e.call(this,u))break;u=a}},_getClientRects:function(e,u){var a,b,c,g;if(!e._rectsCache){a=e.getClientRects();b=Array(a.length);for(g=0;g<a.length;g++)c=b[g]=new r(a[g]),c.left-=u.left,c.top-=u.top,c.right-=u.left,c.bottom-=u.top;e._rectsCache=b}a=e._rectsCache;b=[a.length];for(g=0;g<a.length;g++)b[g]=new r(a[g]);return b},getClientRects:function(e){if(!this.view._wrapMode)return[this.getBoundingClientRect()];
var u=[],a=this._ensureCreated().getBoundingClientRect();this.forEach(function(e){e=this._getClientRects(e,a);for(var b=0;b<e.length;b++){var c=e[b],g,f;if(c.top!==c.bottom){var k=c.top+(c.bottom-c.top)/2;for(g=0;g<u.length&&!(f=u[g],f.top<=k&&k<f.bottom);g++);g===u.length?u.push(c):(c.left<f.left&&(f.left=c.left),c.top<f.top&&(f.top=c.top),c.right>f.right&&(f.right=c.right),c.bottom>f.bottom&&(f.bottom=c.bottom))}}return!0});return void 0!==e?u[e]:u},_getLineBoundingClientRect:function(e,u){var a=
new r(e.getBoundingClientRect());if(!this.view._wrapMode){a.right=a.left;for(var c=e.lastChild;c&&c.ignoreChars===c.firstChild.length;)c=c.previousSibling;c&&(c=c.getBoundingClientRect(),a.right=c.right+p(e).right)}u&&(c=p(e),a.left+=c.left,a.right-=c.right);return a},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(e){if(!this.view._wrapMode)return 0;var u=this.getClientRects();e=this.getBoundingClientRect(e);e=e.top+(e.bottom-e.top)/2;for(var a=
0;a<u.length;a++)if(u[a].top<=e&&e<u[a].bottom)return a;return u.length-1},getLineStart:function(e){if(!this.view._wrapMode||0===e)return this.view._model.getLineStart(this.lineIndex);var a=this.getClientRects();return this.getOffset(a[e].left+1,a[e].top+1)},_nodeLength:function(e){if(!e||e.ignore)return 0;var a=e.firstChild.length;e.ignoreChars&&(a-=e.ignoreChars);return a},getModelOffset:function(e,a){if(!e)return 0;var c=0;this.forEach(function(b){var g=b.firstChild;if(g===e)return b.ignoreChars&&
(c-=b.ignoreChars),c+=a,!1;b.ignoreChars&&(c-=b.ignoreChars);c+=g.data.length;return!0});return Math.max(0,c)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(e){var a=0,c,b,g=this.view._model,f=g.getLineStart(this.lineIndex),k=e-f,p=g.getLineEnd(this.lineIndex)-f;this.forEach(function(e){var g=e.firstChild,f=this._nodeLength(e);if(f+a>k||a+f>=p)return c=g,b=k-a,e.ignoreChars&&(0<f&&b===f)&&(b+=e.ignoreChars),!1;a+=f;return!0});return{node:c,offset:b}},getText:function(e){var a=
"",c=0;this.forEach(function(b){var g;if(b.ignoreChars){g=b.lastChild;for(var f=0,k=[],p=-1;g;){var n=g.data;if(n)for(var r=n.length-1;0<=r;r--){var w=n.substring(r,r+1);f<b.ignoreChars&&(" "===w||"\ufeff"===w)?f++:k.push("\u00a0"===w?"\t":w)}e===g&&(p=k.length);g=g.previousSibling}k=k.reverse().join("");-1!==p&&(c=a.length+k.length-p);a+=k}else for(g=b.firstChild;g;)e===g&&(c=a.length),a+=g.data,g=g.nextSibling;return!0});return{text:a,offset:c}},getOffset:function(e,a){function c(b,B,n){var q=b.firstChild,
E=d._nodeLength(b),y=r.ownerDocument,m=y.defaultView||y.parentWindow,l=11>h.isIE?m.screen.logicalXDPI/m.screen.deviceXDPI:1,A=11>h.isIE?m.screen.logicalYDPI/m.screen.deviceYDPI:1,s,C,t,m=n.left+w.left,z,v;if(h.isIE||g._isRangeRects){for(var y=g._isRangeRects?y.createRange():y.body.createTextRange(),D=E,x=-1;1<D-x;){var G=Math.floor((D+x)/2);n=x+1;s=G===E-1&&b.ignoreChars?q.length:G+1;z=0===n&&8===h.isIE;g._isRangeRects?(y.setStart(q,n),y.setEnd(q,s)):(z&&(n=1),y.moveToElementText(b),y.move("character",
n),y.moveEnd("character",s-n));v=y.getClientRects();for(var O=!1,N=0;N<v.length;N++)if(n=v[N],s=(z?m:n.left)*l-w.left,t=n.right*l-w.left,C=n.top*A-w.top,n=n.bottom*A-w.top,s<=e&&e<t&&(!g._wrapMode||C<=a&&a<=n)){O=!0;break}O?D=G:x=G}B+=D;n=D;s=D===E-1&&b.ignoreChars?q.length:Math.min(D+1,q.length);g._isRangeRects?(y.setStart(q,n),y.setEnd(q,s)):(y.moveToElementText(b),y.move("character",n),y.moveEnd("character",s-n));v=y.getClientRects();E=!1;0<v.length&&(n=v[0],s=(z?m:n.left)*l-w.left,t=n.right*l-
w.left,E=e>s+(t-s)/2);b=B-p;q=f.getLine(k);l=q.charCodeAt(b);55296<=l&&56319>=l&&E?b<q.length&&(l=q.charCodeAt(b+1),56320<=l&&57343>=l&&(B+=1)):56320<=l&&(57343>=l&&!E)&&0<b&&(l=q.charCodeAt(b-1),55296<=l&&56319>=l&&(B-=1));E&&B++}else{l=[];for(z=0;z<E;z++)l.push("\x3cspan\x3e"),z===E-1?l.push(q.data.substring(z)):l.push(q.data.substring(z,z+1)),l.push("\x3c/span\x3e");b.innerHTML=l.join("");for(l=b.firstChild;l;){n=l.getBoundingClientRect();s=n.left-w.left;t=n.right-w.left;if(s<=e&&e<t){e>s+(t-s)/
2&&B++;break}B++;l=l.nextSibling}d._createdDiv||(b.innerHTML="",b.appendChild(q),b=g._getSelections()[0],(B<=b.start&&b.start<B+E||B<=b.end&&b.end<B+E)&&g._updateDOMSelection())}return B}function b(c){if(c.ignore)return null;c=d._getClientRects(c,w);for(var f=0;f<c.length;f++){var B=c[f];if(B.left<=e&&e<B.right&&(!g._wrapMode||B.top<=a&&a<=B.bottom))return B}return null}var g=this.view,f=g._model,k=this.lineIndex,p=f.getLineStart(k),n=f.getLineEnd(k);if(p===n)return p;var r=this._ensureCreated(),
w=this.getBoundingClientRect(),d=this,q,y;if(g._wrapMode){q=this.getClientRects();a<q[0].top&&(a=q[0].top);for(var m=0;m<q.length&&!(y=q[m],y.top<=a&&a<y.bottom);m++);e<y.left&&(e=y.left);e>y.right&&(e=y.right-1)}else 0>e&&(e=0),e>w.right-w.left&&(e=w.right-w.left);var l,A;if(this._lastHitChild&&this._lastHitChild.parentNode){if(l=this._lastHitOffset,A=this._lastHitChild,y=b(A),!y){q=l;for(var m=l+this._nodeLength(A),s=A.previousSibling,C=A.nextSibling;s||C;){if(s){q-=this._nodeLength(s);if(y=b(s)){A=
s;l=q;break}s=s.previousSibling}if(C){if(y=b(C)){A=C;l=m;break}m+=this._nodeLength(C);C=C.nextSibling}}}}else l=p,this.forEach(function(e){A=e;if(y=b(A))return!1;l+=this._nodeLength(A);return!0});A&&y&&(this._lastHitChild=A,this._lastHitOffset=l,l=c(A,l,y));return Math.min(n,Math.max(p,l))},getNextOffset:function(e,a){if("line"===a.unit){var c=this.view._model,b=c.getLineAtOffset(e);if(0<a.count)return a.count--,c.getLineEnd(b);a.count++;return c.getLineStart(b)}return"wordend"===a.unit||"wordWS"===
a.unit||"wordendWS"===a.unit?this._getNextOffset_W3C(e,a):h.isIE?this._getNextOffset_IE(e,a):this._getNextOffset_W3C(e,a)},_getNextOffset_W3C:function(e,a){function c(e){return 33<=e&&47>=e||58<=e&&64>=e||91<=e&&94>=e||96===e||123<=e&&126>=e}function b(e){return 32===e||9===e}var g=this.view._model,f=g.getLineAtOffset(e),k=g.getLine(f),n=g.getLineStart(f),g=g.getLineEnd(f),f=k.length,p=e-n,r,w=0>a.count?-1:1;if("word"===a.unit||"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit)for(var d,
q,h;0!==a.count;){if(0<a.count){if(p===f)return g;r=k.charCodeAt(p);d=c(r);q=!d&&!b(r);for(p++;p<f;){r=k.charCodeAt(p);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){h=c(r);if("wordend"===a.unit){if(!h&&d)break}else if(h&&!d)break;r=!h&&!b(r)}else r=!b(r);if("wordend"===a.unit||"wordendWS"===a.unit){if(!r&&q)break}else if(r&&!q)break;q=r;d=h;p++}}else{if(0===p)return n;p--;r=k.charCodeAt(p);d=c(r);for(q=!d&&!b(r);0<p;){r=k.charCodeAt(p-1);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){h=c(r);if("wordend"===
a.unit){if(h&&!d)break}else if(!h&&d)break;r=!h&&!b(r)}else r=!b(r);if("wordend"===a.unit||"wordendWS"===a.unit){if(r&&!q)break}else if(!r&&q)break;q=r;d=h;p--}}a.count-=w}else for(;0!==a.count&&0<=p+w&&p+w<=f;)p+=w,r=k.charCodeAt(p),56320<=r&&57343>=r&&0<p&&(r=k.charCodeAt(p-1),55296<=r&&56319>=r&&(p+=w)),a.count-=w;return n+p},_getNextOffset_IE:function(e,a){var b=this._ensureCreated(),c=this.view._model,g=this.lineIndex,f=0,k;k=c.getLineStart(g);var p=c.getLine(g),n=c.getLineStart(g),r=b.ownerDocument,
w=0>a.count?-1:1;if(e===c.getLineEnd(g)){for(b=b.lastChild;b&&b.ignoreChars===b.firstChild.length;)b=b.previousSibling;if(!b)return k;f=r.body.createTextRange();f.moveToElementText(b);k=f.text.length;f.moveEnd(a.unit,w);f=e+f.text.length-k}else if(e===k&&0>a.count)f=k;else for(b=b.firstChild;b;){c=this._nodeLength(b);if(k+c>e){f=r.body.createTextRange();if(e===k&&0>a.count){for(k=b.previousSibling;k&&(!k.firstChild||!k.firstChild.length);)k=k.previousSibling;f.moveToElementText(k?k:b.previousSibling)}else f.moveToElementText(b),
f.collapse(),f.moveEnd("character",e-k);k=f.text.length;f.moveEnd(a.unit,w);f=e+f.text.length-k;break}k=c+k;b=b.nextSibling}k=f-n;f=p.charCodeAt(k);56320<=f&&57343>=f&&0<k&&(f=p.charCodeAt(k-1),55296<=f&&56319>=f&&(k+=w));a.count-=w;return k+n},updateLinks:function(){var e=this._ensureCreated();if(this.hasLink){var a=this;this.forEach(function(b){var c=b.viewStyle;c&&(c.tagName&&"a"===c.tagName.toLowerCase())&&e.replaceChild(a._createSpan(e,b.firstChild.data,c),b);return!0})}},destroy:function(){var e=
this._createdDiv;e&&(e.parentNode.removeChild(e),this._createdDiv=null)}};A.prototype={addKeyMode:function(e,a){var b=this._keyModes;void 0!==a?b.splice(a,0,e):b.push(e);e._modeAdded&&e._modeAdded()},addRuler:function(e,a){var b=this._rulers;if(void 0!==a){var c,g;for(g=c=0;c<b.length&&g<a;c++)e.getLocation()===b[c].getLocation()&&g++;b.splice(g,0,e);a=g}else b.push(e);this._createRuler(e,a);e.setView(this);this._update()},computeSize:function(){var e=0,a=0,b=this._model,c=this._clientDiv;if(!c)return{width:e,
height:a};var g=c.style.width;h.isWebkit&&(c.style.width="0x7fffffffpx");for(var b=b.getLineCount(),f=0;f<b;f++){var k=this._getLine(f),p=k.getBoundingClientRect(),e=Math.max(e,p.right-p.left),a=a+(p.bottom-p.top);k.destroy()}h.isWebkit&&(c.style.width=g);c=this._getViewPadding();e+=c.right+c.left+this._metrics.scrollWidth;a+=c.bottom+c.top+this._metrics.scrollWidth;return{width:e,height:a}},convert:function(e,a,b){if(!this._clientDiv)return e;var c=this._getScroll(),g=this._getViewPadding(),f=this._viewDiv.getBoundingClientRect();
"document"===a&&(void 0!==e.x&&(e.x+=-c.x+f.left+g.left),void 0!==e.y&&(e.y+=-c.y+f.top+g.top));"document"===b&&(void 0!==e.x&&(e.x+=c.x-f.left-g.left),void 0!==e.y&&(e.y+=c.y-f.top-g.top));return e},destroy:function(){for(var e=0;e<this._rulers.length;e++)this._rulers[e].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=
this._theme=this._model=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(e){if(e=this._actions[e])return e.actionDescription},getActions:function(e){var a=[],b=this._actions,c;for(c in b)b.hasOwnProperty(c)&&(e||!b[c].defaultHandler)&&a.push(c);return a},getBottomIndex:function(e){return!this._clientDiv?0:this._getBottomIndex(e)},getBottomPixel:function(){return!this._clientDiv?
0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var e=this._getScroll();return{x:e.x,y:e.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(e){for(var a=[],b=this._keyModes,c=0;c<b.length;c++)a=a.concat(b[c].getKeyBindings(e));return a},getKeyModes:function(){return this._keyModes.slice(0)},
getLineHeight:function(e){return!this._clientDiv?0:this._getLineHeight(e)},getLineIndex:function(e){return!this._clientDiv?0:this._getLineIndex(e)},isValidTextPosition:function(e,a){if(!this._clientDiv)return!1;var b=this._getLineIndex(a,!0);if(0>b)return!1;var b=this._getLine(b),c=this.getOffsetAtLocation(e,a),c=b.getBoundingClientRect(c);b.destroy();return e>c.right?!1:!0},getLinePixel:function(e){return!this._clientDiv?0:this._getLinePixel(e)},getLocationAtOffset:function(e){if(!this._clientDiv)return{x:0,
y:0};var a=this._model;e=Math.min(Math.max(0,e),a.getCharCount());var a=a.getLineAtOffset(e),b=this._getLine(a);e=b.getBoundingClientRect(e);b.destroy();b=e.left;a=this._getLinePixel(a)+e.top;return{x:b,y:a}},getNextOffset:function(e,a){var b=new g(e,e,!1);this._doMove(a,b);return b.getCaret()},getOptions:function(){var e;if(0===arguments.length)e=this._defaultOptions();else if(1===arguments.length){if(e=arguments[0],"string"===typeof e)return b(this["_"+e])}else{e={};for(var a in arguments)arguments.hasOwnProperty(a)&&
(e[arguments[a]]=void 0)}for(var c in e)e.hasOwnProperty(c)&&(e[c]=b(this["_"+c]));return e},getModel:function(){return this._model},getOffsetAtLocation:function(e,a){if(!this._clientDiv)return 0;var b=this._getLineIndex(a),c=this._getLine(b),b=c.getOffset(e,a-this._getLinePixel(b));c.destroy();return b},getLineAtOffset:function(e){return this.getModel().getLineAtOffset(e)},getLineStart:function(e){return this.getModel().getLineStart(e)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){return this._getSelection()},
getSelections:function(){return this._getSelections()},getSelectionText:function(e){var a=[],b=this;this._getSelections().forEach(function(e){e.isEmpty()||a.push(b._getBaseText(e.start,e.end))});return a.join(void 0!==e?e:this._model.getLineDelimiter())},getText:function(e,a){return this._model.getText(e,a)},getTopIndex:function(e){return!this._clientDiv?0:this._getTopIndex(e)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(e,a,b){if(this._clientDiv){if(e=
this._actions[e]){e.actionDescription&&e.actionDescription.id&&s.logEvent("editor","action",e.actionDescription.id);if(!a&&e.handler&&e.handler(b))return!0;if(e.defaultHandler)return"boolean"===typeof e.defaultHandler(b)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(e){return this.dispatchEvent(e)},onDragStart:function(e){return this.dispatchEvent(e)},onDrag:function(e){return this.dispatchEvent(e)},onDragEnd:function(e){return this.dispatchEvent(e)},onDragEnter:function(e){return this.dispatchEvent(e)},
onDragOver:function(e){return this.dispatchEvent(e)},onDragLeave:function(e){return this.dispatchEvent(e)},onDrop:function(e){return this.dispatchEvent(e)},onDestroy:function(e){return this.dispatchEvent(e)},onSaving:function(e){return this.dispatchEvent(e)},onInputChanged:function(e){return this.dispatchEvent(e)},onLineStyle:function(e){return this.dispatchEvent(e)},onKeyDown:function(e){return this.dispatchEvent(e)},onKeyPress:function(e){return this.dispatchEvent(e)},onKeyUp:function(e){return this.dispatchEvent(e)},
onModelChanged:function(e){return this.dispatchEvent(e)},onModelChanging:function(e){return this.dispatchEvent(e)},onModify:function(e){return this.dispatchEvent(e)},onMouseDown:function(e){return this.dispatchEvent(e)},onMouseUp:function(e){return this.dispatchEvent(e)},onMouseMove:function(e){return this.dispatchEvent(e)},onMouseOver:function(e){return this.dispatchEvent(e)},onMouseOut:function(e){return this.dispatchEvent(e)},onTouchStart:function(e){return this.dispatchEvent(e)},onTouchMove:function(e){return this.dispatchEvent(e)},
onTouchEnd:function(e){return this.dispatchEvent(e)},onOptions:function(e){return this.dispatchEvent(e)},onSelection:function(e){return this.dispatchEvent(e)},onScroll:function(e){return this.dispatchEvent(e)},onVerify:function(e){return this.dispatchEvent(e)},onFocus:function(e){return this.dispatchEvent(e)},onBlur:function(e){return this.dispatchEvent(e)},redraw:function(){if(!(0<this._redrawCount)){var e=this._model.getLineCount();this.redrawRulers(0,e);this.redrawLines(0,e)}},redrawRulers:function(e,
a){if(!(0<this._redrawCount))for(var b=this.getRulers(),c=0;c<b.length;c++)this.redrawLines(e,a,b[c])},redrawLines:function(e,a,b){if(!(0<this._redrawCount)&&(void 0===e&&(e=0),void 0===a&&(a=this._model.getLineCount()),e!==a)){var c=this._clientDiv;if(c){if(b)for(c=this._getRulerParent(b).firstChild;c&&c._ruler!==b;)c=c.nextSibling;b?c.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(e,a);var g=-1;!b&&-1!==this._imeOffset&&(g=this._model.getLineAtOffset(this._imeOffset));if(!b||"page"===b.getOverview())for(c=
c.firstChild;c;){var f=c.lineIndex;e<=f&&(f<a&&f!==g)&&(c.lineChanged=!0);c=c.nextSibling}!b&&(!this._wrapMode&&e<=this._maxLineIndex&&this._maxLineIndex<a)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this.dispatchEvent({type:"Redraw",startLine:e,endLine:a,ruler:b});this._queueUpdate()}}},redrawRange:function(e,a){if(!(0<this._redrawCount)){var b=this._model;void 0===e&&(e=0);void 0===a&&(a=b.getCharCount());var c=b.getLineAtOffset(e),b=b.getLineAtOffset(Math.max(e,
a-1))+1;this.redrawLines(c,b)}},removeKeyMode:function(e){for(var a=this._keyModes,b=0;b<a.length;b++)if(a[b]===e){a.splice(b,1);break}e._modeRemoved&&e._modeRemoved()},removeRuler:function(e){for(var a=this._rulers,b=0;b<a.length;b++)if(a[b]===e){a.splice(b,1);e.setView(null);this._destroyRuler(e);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(e,a,b){if(e){var c=this._actions,g=c[e];g||(g=c[e]={});g.handler=a;void 0!==b&&(g.actionDescription=
b)}},setKeyBinding:function(e,a){this._keyModes[0].setKeyBinding(e,a)},setCaretOffset:function(e,a,b){var c=this._model.getCharCount();e=Math.max(0,Math.min(e,c));e=new g(e,e,!1);this._setSelection(e,void 0===a||a,!0,b)},setHorizontalPixel:function(e){this._clientDiv&&(e=Math.max(0,e),this._scrollView(e-this._getScroll().x,0))},setRedraw:function(e){e?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(e){if(e!==this._model){e=e||new x.TextModel;this._model.removeEventListener("preChanging",
this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var a=this._model.getLineCount(),b=this._model.getCharCount(),c=e.getLineCount(),g=e.getCharCount(),f={type:"ModelChanging",text:e.getText(),start:0,removedCharCount:b,addedCharCount:g,removedLineCount:a,addedLineCount:c};this.onModelChanging(f);this._model=e;f={type:"ModelChanged",start:0,removedCharCount:b,addedCharCount:g,removedLineCount:a,addedLineCount:c};this.onModelChanged(f);this._model.addEventListener("preChanging",
this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(e){var a=this._defaultOptions(),c;for(c in e)if(e.hasOwnProperty(c)){var g=e[c];if(!k(this["_"+c],g)){var f=a[c]?a[c].update:null;f?f.call(this,g):this["_"+c]=b(g)}}this.onOptions({type:"Options",options:e})},setSelection:function(e,a,b,c){var f=e>a;if(f){var k=e;e=a;a=k}k=this._model.getCharCount();e=Math.max(0,Math.min(e,k));a=Math.max(0,Math.min(a,
k));e=new g(e,a,f);this._setSelection(e,void 0===b||b,!0,c)},setSelections:function(e,a,b){e=this._rangesToSelections(e);this._setSelection(e,void 0===a||a,!0,b)},setText:function(e,a,b,c,f){var k="string"===typeof e,p=void 0===a&&void 0===b&&k;k?(void 0===a&&(a=0),void 0===b&&(b=this._model.getCharCount()),e={text:e,selection:[new g(a,b,!1)]}):e.selection=this._rangesToSelections(e.selection);e._code=!0;p&&(this._variableLineHeight=!1);this._modifyContent(e,!p,void 0===c||c,f);p&&13>h.isFirefox&&
this._fixCaret()},setTopIndex:function(e,a){this._clientDiv&&this._scrollViewAnimated(0,this._getLinePixel(Math.max(0,e))-this._getScroll().y,a)},setTopPixel:function(e,a){this._clientDiv&&this._scrollViewAnimated(0,Math.max(0,e)-this._getScroll().y,a)},showSelection:function(e,a){return this._showCaret(e?!1:!0,a,e)},update:function(e,a){this._clientDiv&&((e||this._metrics.invalid)&&this._updateStyle(),void 0===a||a?this._update():this._queueUpdate())},_handleRootMouseDown:function(e){this._cancelCheckSelection();
if(!this._ignoreEvent(e)){13>h.isFirefox&&1===e.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var a=this._overlayDiv||this._clientDiv;9>h.isIE&&(a=this._viewDiv);for(var b=e.target?e.target:e.srcElement;b;){if(a===b||b.className&&-1!==b.className.indexOf("textViewFind"))return;b=b.parentNode}e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();if(!this._isW3CEvents){var c=this;this._getWindow().setTimeout(function(){c._clientDiv.focus()},
0)}}},_handleRootMouseUp:function(e){this._ignoreEvent(e)||(13>h.isFirefox&&1===e.which&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1),h.isFirefox&&1===e.which&&(this._fixCaret(),this._ignoreBlur=!1))},_handleBlur:function(){this._cancelCheckSelection();if(!this._ignoreBlur){this._commitIME();this._hasFocus=!1;if(9>h.isIE&&!this._getSelections()[0].isEmpty()){var e=this._rootDiv,a=h.createElement(e.ownerDocument,"div");e.appendChild(a);e.removeChild(a)}this._cursorDiv&&
(this._cursorDiv.style.display="none");if(this._domSelection)if(this._domSelection.forEach(function(e){e.update()}),e=this._getWindow(),a=this._parent.ownerDocument,e.getSelection){a=e.getSelection();for(e=a.anchorNode;e;){if(e===this._clientDiv){0<a.rangeCount&&a.removeAllRanges();break}e=e.parentNode}}else if(a.selection){this._ignoreSelect=!1;for(e=a.selection.createRange().parentElement();e;){if(e===this._clientDiv){a.selection.empty();break}e=e.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},
_handleCompositionStart:function(e){this._ignoreEvent(e)||(this._imeTimeout&&(this._getWindow().clearTimeout(this._imeTimeout),this._imeTimeout=null),this._imeText&&(this._commitIME(this._imeText),this._imeText=null),this._startIME(),this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null))},_handleCompositionUpdate:function(e){this._ignoreEvent(e)||(this._imeText=e.data)},_handleCompositionEnd:function(e){this._ignoreEvent(e)||(this._imeText=e.data,this._imeTimeout=
this._getWindow().setTimeout(function(){this._commitIME(this._imeText);this._imeText=this._imeTimeout=null}.bind(this),0))},_handleContextMenu:function(e){if(!this._ignoreEvent(e)){h.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var a=!1;this.isListening("ContextMenu")?(a=this._createMouseEvent("ContextMenu",e),a.screenX=e.screenX,a.screenY=e.screenY,this.onContextMenu(a),a=a.defaultPrevented):h.isMac&&(h.isFirefox&&0===e.button)&&(a=!0);if(a)return e.preventDefault&&e.preventDefault(),
!1;this._contextMenuOpen=!0;h.isFirefox&&(this._checkSelectionChange=!0,this._pollSelectionChange(!0))}},_handleCopy:function(e){this._cancelCheckSelection();if(!this._ignoreEvent(e)&&!this._ignoreCopy&&this._doCopy(e))return e.preventDefault&&e.preventDefault(),!1},_handleCut:function(e){this._cancelCheckSelection();if(!this._ignoreEvent(e)&&this._doCut(e))return e.preventDefault&&e.preventDefault(),!1},_handleDataModified:function(e){this._ignoreEvent(e)||this._startIME()},_handleDblclick:function(e){this._ignoreEvent(e)||
(this._lastMouseTime=e.timeStamp?e.timeStamp:(new Date).getTime(),2!==this._clickCount&&(this._clickCount=2,this._handleMouse(e)))},_handleDragStart:function(e){if(!this._ignoreEvent(e)){if(13>h.isFirefox){var a=this;this._getWindow().setTimeout(function(){a._clientDiv.contentEditable=!0;a._clientDiv.draggable=!1;a._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",e)),this._dragOffset=-1;else return e.preventDefault&&
e.preventDefault(),!1}},_handleDrag:function(e){if(!this._ignoreEvent(e)&&this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",e))},_handleDragEnd:function(e){if(!this._ignoreEvent(e)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",e));13>h.isFirefox&&(this._fixCaret(),"none"===e.dataTransfer.dropEffect&&!e.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(e){if(!this._ignoreEvent(e)){var a=
!0;this._dropTarget=!0;this.isListening("DragEnter")&&(a=!1,this.onDragEnter(this._createMouseEvent("DragEnter",e)));if(h.isWebkit||a)return e.preventDefault&&e.preventDefault(),!1}},_handleDragOver:function(e){if(!this._ignoreEvent(e)){var a=!0;this.isListening("DragOver")&&(a=!1,this.onDragOver(this._createMouseEvent("DragOver",e)));if(h.isWebkit||a)return a&&(e.dataTransfer.dropEffect="none"),e.preventDefault&&e.preventDefault(),!1}},_handleDragLeave:function(e){if(!this._ignoreEvent(e)&&(this._dropTarget=
!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",e))},_handleDrop:function(e){if(!this._ignoreEvent(e)){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",e));e.preventDefault&&e.preventDefault();return!1}},_handleFocus:function(){this._hasFocus=!0;h.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display=
"block");this._domSelection&&this._domSelection.forEach(function(e){e.update()});if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(e){this._cancelCheckSelection();if(!this._ignoreEvent(e)){if(this.isListening("KeyDown")){var a=this._createKeyEvent("KeyDown",e);this.onKeyDown(a);if(a.defaultPrevented){h.isFirefox&&(this._keyDownPrevented=!0);e.preventDefault();return}}a=!1;switch(e.keyCode){case 16:case 17:case 18:case 91:a=!0;break;default:this._setLinksVisible(!1)}if(229===
e.keyCode){if(this._readonly)return e.preventDefault&&e.preventDefault(),!1;a=!0;h.isSafari&&h.isMac&&e.ctrlKey&&(a=!1,e.keyCode=129);a&&this._startIME()}else a||this._commitIME();if((h.isMac||h.isLinux)&&4>h.isFirefox||12.16>h.isOpera)return this._keyDownEvent=e,!0;if(this._doAction(e))return e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1,e.keyCode=0),!1}},_handleKeyPress:function(e){if(!this._ignoreEvent(e))if(this._keyDownPrevented)e.preventDefault&&
(e.preventDefault(),e.stopPropagation()),this._keyDownPrevented=void 0;else{if(h.isMac&&h.isWebkit&&(63232<=e.keyCode&&63487>=e.keyCode||13===e.keyCode||8===e.keyCode)||((h.isMac||h.isLinux)&&4>h.isFirefox||12.16>h.isOpera)&&this._doAction(this._keyDownEvent))return e.preventDefault&&e.preventDefault(),!1;var a=h.isMac?e.metaKey:e.ctrlKey;if(void 0!==e.charCode&&a)switch(e.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(a=this._createKeyEvent("KeyPress",e),this.onKeyPress(a),
a.defaultPrevented)){e.preventDefault();return}if(this._doAction(e))return e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1,e.keyCode=0),!1;a=!1;if(h.isMac){if(e.ctrlKey||e.metaKey)a=!0}else if(h.isFirefox){if(e.ctrlKey||e.altKey)a=!0}else e.ctrlKey^e.altKey&&(a=!0);if(!a&&(a=h.isOpera?e.which:void 0!==e.charCode?e.charCode:e.keyCode,31<a))return this._doContent(String.fromCharCode(a)),e.preventDefault&&e.preventDefault(),!1}},_handleDocKeyUp:function(e){(h.isMac?
e.metaKey:e.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(e){if(!this._ignoreEvent(e)){if(this.isListening("KeyUp")){var a=this._createKeyEvent("KeyUp",e);this.onKeyUp(a);if(a.defaultPrevented){e.preventDefault();return}}this._handleDocKeyUp(e);13===e.keyCode&&this._commitIME()}},_handleLinkClick:function(e){if(!(h.isMac?e.metaKey:e.ctrlKey))return e.preventDefault&&e.preventDefault(),!1},_handleMouse:function(e){var a=this._getWindow(),b=!0,c=a;if(h.isIE||h.isFirefox&&!this._overlayDiv)c=
this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var f=this;a.setTimeout(function(){f.focus();f._ignoreFocus=!1},0)}var a=e.shiftKey,k=e.altKey,p=h.isMac?e.metaKey:e.ctrlKey;this._blockSelection=this._doubleClickSelection=null;1===this._clickCount?(b=(!h.isOpera||12.16<=h.isOpera)&&this._hasFocus&&this.isListening("DragStart"),(b=this._setSelectionTo(e.clientX,e.clientY,!0,a,p,b))&&this._setGrab(c)):(this._isW3CEvents&&this._setGrab(c),this._setSelectionTo(e.clientX,e.clientY,
!0,a,p,!1),this._doubleClickSelection=g.editing(this._getSelections()));k&&(this._blockSelection=g.editing(this._getSelections()));return b},_handleMouseDown:function(e){if(!this._ignoreEvent(e)){if(this._linksVisible)if("A"!==(e.target||e.srcElement).tagName)this._setLinksVisible(!1);else return;this._commitIME();var a=e.which;a||(4===e.button&&(a=2),2===e.button&&(a=3),1===e.button&&(a=1));var b=2!==a&&e.timeStamp?e.timeStamp:(new Date).getTime(),c=b-this._lastMouseTime,g=Math.abs(this._lastMouseX-
e.clientX),f=Math.abs(this._lastMouseY-e.clientY),k=this._lastMouseButton===a;this._lastMouseX=e.clientX;this._lastMouseY=e.clientY;this._lastMouseTime=b;this._lastMouseButton=a;1===a&&(this._isMouseDown=!0,k&&c<=this._clickTime&&g<=this._clickDist&&f<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")&&(b=this._createMouseEvent("MouseDown",e),this.onMouseDown(b),b.defaultPrevented)){e.preventDefault();return}if(1===a&&this._handleMouse(e)&&(9<=h.isIE||h.isOpera||
h.isChrome||h.isSafari||h.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),e.preventDefault();h.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(e){if(!this._ignoreEvent(e)&&!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",e))},_handleMouseOut:function(e){if(!this._ignoreEvent(e)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",e))},_handleMouseMove:function(e){if(!this._animation){var a=
this._isClientDiv(e);if(this.isListening("MouseMove")&&(a||this._isMouseDown)){var b=this._createMouseEvent("MouseMove",e);this.onMouseMove(b);if(b.defaultPrevented){e.preventDefault();return}}if(!this._dropTarget){b=this._linksVisible||this._lastMouseMoveX!==e.clientX||this._lastMouseMoveY!==e.clientY;this._lastMouseMoveX=e.clientX;this._lastMouseMoveY=e.clientY;this._setLinksVisible(b&&!this._isMouseDown&&e.altKey&&(h.isMac?e.metaKey:e.ctrlKey));this._checkOverlayScroll();if(!this._isW3CEvents){if(0===
e.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===e.button&&0!==(this._clickCount&1)&&a)return this._clickCount=2,this._handleMouse(e,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){a=e.clientX;e=e.clientY;var c=this._getViewPadding(),g=this._viewDiv.getBoundingClientRect(),f=this._getClientWidth(),k=this._getClientHeight(),b=g.left+c.left,p=g.top+c.top,f=g.left+c.left+f,c=g.top+c.top+k;e<p?this._doAutoScroll("up",a,e-p):e>c?this._doAutoScroll("down",a,e-c):a<b&&!this._wrapMode?
this._doAutoScroll("left",a-b,e):a>f&&!this._wrapMode?this._doAutoScroll("right",a-f,e):(this._endAutoScroll(),this._setSelectionTo(a,e,!1,!0))}}}},_isClientDiv:function(e){var a=this._overlayDiv||this._clientDiv;for(e=e.target?e.target:e.srcElement;e;){if(a===e)return!0;e=e.parentNode}return!1},_createKeyEvent:function(e,a){return{type:e,event:a,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(e,a){var b=this.convert({x:a.clientX,y:a.clientY},"page","document");return{type:e,
event:a,clickCount:this._clickCount,x:b.x,y:b.y,preventDefault:function(){this.defaultPrevented=!0}}},_createTouchEvent:function(e,a){var b=a.touches.length?this.convert({x:a.touches[0].clientX,y:a.touches[0].clientY},"page","document"):{};return{type:e,event:a,touchCount:a.touches.length,x:b.x,y:b.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(e){var a=e.which?0===e.button:1===e.button;if(this.isListening("MouseUp")&&(this._isClientDiv(e)||a&&this._isMouseDown)){var b=
this._createMouseEvent("MouseUp",e);this.onMouseUp(b);if(b.defaultPrevented){e.preventDefault();this._isMouseDown=!1;return}}if(!this._linksVisible){if(a&&this._isMouseDown){var b=this._getSelections(),c=g.editing(b);b.forEach(function(e){e._editing=!1});-1!==this._dragOffset&&(c.extend(this._dragOffset),c.collapse(),b=c,this._dragOffset=-1);this._setSelection(b,!1);this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null)}a&&h.isFirefox&&(this._updateDOMSelection(),e.preventDefault())}},
_handleMouseWheel:function(e){if(!this._noScroll){var a=this._getLineHeight(),b=0,c=0;h.isIE||h.isOpera?c=-e.wheelDelta/40*a:h.isFirefox?"wheel"===e.type?e.deltaMode?(b=Math.max(-256,Math.min(256,e.deltaX))*a,c=Math.max(-256,Math.min(256,e.deltaY))*a):(b=e.deltaX,c=e.deltaY):(a=h.isMac?3*e.detail:Math.max(-256,Math.min(256,e.detail))*a,e.axis===e.HORIZONTAL_AXIS?b=a:c=a):h.isMac?(c=e.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=e.timeStamp,b=0!==e.wheelDeltaX%120?1:40>c?40/(40-c):40,c=0!==
e.wheelDeltaY%120?1:40>c?40/(40-c):40,b=Math.ceil(-e.wheelDeltaX/b),-1<b&&0>b&&(b=-1),0<b&&1>b&&(b=1),c=Math.ceil(-e.wheelDeltaY/c),-1<c&&0>c&&(c=-1),0<c&&1>c&&(c=1)):(b=-e.wheelDeltaX,c=8*(-e.wheelDeltaY/120)*a);if(h.isSafari||h.isChrome&&h.isMac){for(a=e.target;a&&void 0===a.lineIndex;)a=a.parentNode;this._mouseWheelLine=a}a=this._getScroll();this._scrollView(b,c);b=this._getScroll();if(a.x!==b.x||a.y!==b.y)return e.preventDefault&&e.preventDefault(),!1}},_handlePaste:function(e){this._cancelCheckSelection();
if(!this._ignoreEvent(e)&&!this._ignorePaste&&this._doPaste(e)){if(h.isIE){var a=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){a._updateDOMSelection();a._ignoreFocus=!1},0)}e.preventDefault&&e.preventDefault();return!1}},_handleResize:function(){var e=this._rootDiv.clientWidth,a=this._rootDiv.clientHeight;if(this._rootWidth!==e||this._rootHeight!==a)this._rootWidth!==e&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=e,this._rootHeight=a,e=9>h.isIE,a=this._calculateMetrics(),
k(a,this._metrics)||(this._metrics.invalid&&!a.invalid?this._updateStyle(!1,a):(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=a),e=!0),e?this._queueUpdate():this._update(),this.dispatchEvent({type:"Resize"})},_handleRulerEvent:function(e){for(var a=e.target?e.target:e.srcElement,b=a.lineIndex;a&&!a._ruler;)void 0===b&&void 0!==a.lineIndex&&(b=a.lineIndex),a=a.parentNode;var c=a?a._ruler:null;if(void 0===b&&c&&"document"===c.getOverview()){var g=this._getClientHeight(),
f=this._model.getLineCount(),k=this._getViewPadding(),b=this._viewDiv.getBoundingClientRect(),p=this._getLineHeight(),g=g+k.top+k.bottom-2*this._metrics.scrollWidth;p*f<g?k=k.top:(p=g/f,k=this._metrics.scrollWidth);b=Math.floor((e.clientY-b.top-k)/p);0<=b&&b<f||(b=void 0)}if(c)switch(e.type){case "click":if(c.onClick)c.onClick(b,e);break;case "dblclick":if(c.onDblClick)c.onDblClick(b,e);break;case "mousemove":if(c.onMouseMove)c.onMouseMove(b,e);break;case "mouseover":if(c.onMouseOver)c.onMouseOver(b,
e);break;case "mouseout":if(c.onMouseOut){for(f=e.relatedTarget;f&&f!==this._rootDiv;){if(f===a)return;f=f.parentNode}c.onMouseOut(b,e)}}},_handleScroll:function(){this._lastScrollTime=(new Date).getTime();var e=this._getScroll(!1),a=this._hScroll,b=this._vScroll;if(a!==e.x||b!==e.y)this._hScroll=e.x,this._vScroll=e.y,this._commitIME(),this._update(b===e.y),this.onScroll({type:"Scroll",oldValue:{x:a,y:b},newValue:e})},_handleSelectStart:function(e){var a=this._contextMenuOpen;this._contextMenuOpen=
!1;if(a)this._checkSelectionChange=!0;else if(this._ignoreSelect)return e&&e.preventDefault&&e.preventDefault(),!1},_getModelOffset:function(e,a){if(e){var b;b="DIV"===e.tagName?e:e.parentNode.parentNode;return!b._line?0:b._line.getModelOffset(e,a)}},_updateSelectionFromDOM:function(){if(!h.isIOS&&!h.isAndroid&&!this._checkSelectionChange)return!1;var e=this._getWindow().getSelection(),a=this._getModelOffset(e.anchorNode,e.anchorOffset),b=this._getModelOffset(e.focusNode,e.focusOffset),c=this._getSelections()[0];
if(void 0===a||void 0===b||c.start===a&&c.end===b)return!1;if(this._checkSelectionChange){var c=this._getLineNext(),f=this._getLinePrevious();if(e.anchorNode===c.firstChild.firstChild&&0===e.anchorOffset&&e.focusNode===f.firstChild.firstChild&&0===e.focusOffset)return!1;if(e.anchorNode===c.firstChild.firstChild&&0===e.anchorOffset&&e.focusNode===f.lastChild.firstChild||e.anchorNode===this._clientDiv&&e.focusNode===this._clientDiv)a=0,b=this.getModel().getCharCount()}this._setSelection(new g(a,b),
!1,!1);this._checkSelectionChange=!1;return!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){this._selPollTimer&&(this._getWindow().clearTimeout(this._selPollTimer),this._selPollTimer=null)},_pollSelectionChange:function(e){var a=this,b=this._getWindow();this._cancelPollSelectionChange();this._selPollTimer=b.setTimeout(function(){a._selPollTimer=null;a._clientDiv&&!a._updateSelectionFromDOM()&&
e&&a._pollSelectionChange(e)},100)},_handleSelectionChange:function(){-1===this._imeOffset&&(h.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(e){if(!this._ignoreEvent(e)&&-1===this._imeOffset){var a=this._getWindow().getSelection();if(a.anchorNode!==this._anchorNode||a.focusNode!==this._focusNode||a.anchorOffset!==this._anchorOffset||a.focusOffset!==this._focusOffset){for(var b=a.anchorNode;b&&void 0===b.lineIndex;)b=b.parentNode;if(b){var c=this._model,
g=b.lineIndex,f=c.getLine(g),k=f,p=0,c=c.getLineStart(g);0<a.rangeCount&&(a.getRangeAt(0).deleteContents(),g=b.ownerDocument.createTextNode(e.data),a.getRangeAt(0).insertNode(g),p=this._getDOMText(b,g),k=p.text,p=p.offset,g.parentNode.removeChild(g));b.lineRemoved=!0;for(b=0;f.charCodeAt(b)===k.charCodeAt(b)&&b<p;)b++;a=f.length-1;for(g=k.length-f.length;f.charCodeAt(a)===k.charCodeAt(a+g)&&a+g>=p+e.data.length;)a--;a++;f=k.substring(b,a+g);b+=c;a+=c;k=this._getSelections();p=k[0].start-b;c=k[0].end-
a;k[0].start=b;k[0].end=a;for(b=1;b<k.length;b++)k[b].start-=p,k[b].end-=c;this._modifyContent({text:f,selection:k,_ignoreDOMSelection:!0},!0)}}else this._doContent(e.data);e.preventDefault()}},_handleTouchStart:function(e){if(this.isListening("TouchStart")){var a=this._createTouchEvent("TouchStart",e);this.onTouchStart(a);if(a.defaultPrevented){e.preventDefault();return}if(this._noScroll)return}this._commitIME();a=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display=
"none",a.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var b=e.touches;if(1===b.length){var b=b[0],c=b.clientX,g=b.clientY;this._touchStartX=c;this._touchStartY=g;if(h.isAndroid&&(g<b.pageY-a.pageYOffset||c<b.pageX-a.pageXOffset))c=b.pageX-a.pageXOffset,g=b.pageY-a.pageYOffset;a=this.convert({x:c,y:g},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(a.x,a.y);this._touchStartTime=e.timeStamp;this._touching=!0}},_handleTouchMove:function(e){if(this.isListening("TouchMove")){var a=
this._createTouchEvent("TouchMove",e);this.onTouchMove(a);if(a.defaultPrevented){e.preventDefault();return}if(this._noScroll)return}a=e.touches;if(1===a.length){a=a[0];this._touchCurrentX=a.clientX;this._touchCurrentY=a.clientY;if(!this._touchScrollTimer&&200>e.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display="block");var b=this,c=this._getWindow();this._touchScrollTimer=c.setInterval(function(){var e=0,a=0;if(b._touching)e=b._touchStartX-
b._touchCurrentX,a=b._touchStartY-b._touchCurrentY,b._touchSpeedX=e/10,b._touchSpeedY=a/10,b._touchStartX=b._touchCurrentX,b._touchStartY=b._touchCurrentY;else{if(0.1>Math.abs(b._touchSpeedX)&&0.1>Math.abs(b._touchSpeedY)){b._vScrollDiv.style.display="none";b._hScrollDiv.style.display="none";c.clearInterval(b._touchScrollTimer);b._touchScrollTimer=null;return}e=10*b._touchSpeedX;a=10*b._touchSpeedY;b._touchSpeedX*=0.95;b._touchSpeedY*=0.95}b._scrollView(e,a)},10)}this._touchScrollTimer&&e.preventDefault()}},
_handleTouchEnd:function(e){if(this.isListening("TouchEnd")){var a=this._createTouchEvent("TouchEnd",e);this.onTouchEnd(a);if(a.defaultPrevented){e.preventDefault();return}if(this._noScroll)return}0===e.touches.length&&(this._touching=!1)},_doAction:function(e){var a,b,c=this._keyModes;for(b=c.length-1;0<=b;b--)if(a=c[b],"function"===typeof a.match&&(a=a.match(e),void 0!==a))return this.invokeAction(a);return!1},_doMove:function(e,a){var b=this._model,c=a.getCaret(),g=b.getLineAtOffset(c);e.count||
(e.count=1);for(;0!==e.count;){var f=b.getLineStart(g);if(0>e.count&&c===f)if(0<g)"character"===e.unit&&e.count++,g--,a.extend(b.getLineEnd(g));else break;else if(0<e.count&&c===b.getLineEnd(g))if(g+1<b.getLineCount())"character"===e.unit&&e.count--,g++,a.extend(b.getLineStart(g));else break;else{var k=!1;e.expandTab&&("character"===e.unit&&0===(c-f)%this._tabSize)&&(f=b.getText(f,c),k=!/[^ ]/.test(f));k?(a.extend(c-this._tabSize),e.count+=0>e.count?1:-1):(f=this._getLine(g),a.extend(f.getNextOffset(c,
e)),f.destroy())}c=a.getCaret()}return a},_doBackspace:function(a){var b=this,c=this._getSelections();c.forEach(function(c){c.isEmpty()&&(a.count||(a.count=1),a.count*=-1,a.expandTab=b._expandTab,b._doMove(a,c))});this._modifyContent({text:"",selection:c},!0);return!0},_doCase:function(a){var b=this,c=this._getSelections(),g=[];c.forEach(function(c){b._doMove(a,c);c=b.getText(c.start,c.end);switch(a.type){case "lower":c=c.toLowerCase();break;case "capitalize":c=c.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});
break;case "reverse":for(var f="",k=0;k<c.length;k++)var p=c[k],n=p.toLowerCase(),p=n!==p?n:p.toUpperCase(),f=f+p;c=f;break;default:c=c.toUpperCase()}g.push(c)});return this._modifyContent({text:g,selection:c,_ignoreDOMSelection:!0},!0)},_doContent:function(a){var b=this,c=this._getSelections();c.forEach(function(a){if(b._overwriteMode&&a.isEmpty()){var e=b._model,c=e.getLineAtOffset(a.end);a.end<e.getLineEnd(c)&&(e=b._getLine(c),a.extend(e.getNextOffset(a.getCaret(),{unit:"character",count:1})),
e.destroy())}});return this._modifyContent({text:a,selection:c,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var b=this.getSelectionText();return b?this._setClipboardText(b,a):!0},_doCursorNext:function(a){var b=this,c=this._getSelections();c.forEach(function(c){!c.isEmpty()&&!a.select?c.start=c.end:b._doMove(a,c);a.select||c.collapse()});this._setSelection(c,!0);return!0},_doCursorPrevious:function(a){var b=this,c=this._getSelections();c.forEach(function(c){!c.isEmpty()&&!a.select?c.end=c.start:
(a.count||(a.count=1),a.count*=-1,b._doMove(a,c));a.select||c.collapse()});this._setSelection(c,!0);return!0},_doCut:function(a){var b=this.getSelectionText();return b?(this._doContent(""),this._setClipboardText(b,a)):!0},_doDelete:function(a){var b=this,c=this._getSelections();c.forEach(function(c){c.isEmpty()&&b._doMove(a,c)});this._modifyContent({text:"",selection:c},!0);return!0},_doEnd:function(a){var b=this._model,c=this,g=this._getSelections();g.forEach(function(g){if(a.ctrl)g.extend(b.getCharCount());
else{var f=g.getCaret(),k=b.getLineAtOffset(f);if(c._wrapMode){var p=c._getLine(k),f=p.getLineIndex(f),f=f===p.getLineCount()-1?b.getLineEnd(k):p.getLineStart(f+1)-1;p.destroy()}else a.count&&0<a.count&&(k=Math.min(k+a.count-1,b.getLineCount()-1)),f=b.getLineEnd(k);g.extend(f)}a.select||g.collapse()});this._setSelection(g,!0,!0,a.ctrl?function(){}:null);return!0},_doEnter:function(a){if(this._singleMode)return!0;var b=this._model,c=this._getSelections();this._doContent(b.getLineDelimiter());a&&a.noCursor&&
(c.forEach(function(a){a.end=a.start}),this._setSelection(c,!0));return!0},_doEscape:function(){var a=this._getSelections();1<a.length&&this._setSelection(a[0],!0);return!0},_doHome:function(a){var b=this._model,c=this,g=this._getSelections();g.forEach(function(g){if(a.ctrl)g.extend(0);else{var f=g.getCaret(),k=b.getLineAtOffset(f);c._wrapMode?(k=c._getLine(k),f=k.getLineIndex(f),f=k.getLineStart(f),k.destroy()):f=b.getLineStart(k);g.extend(f)}a.select||g.collapse()});this._setSelection(g,!0,!0,a.ctrl?
function(){}:null);return!0},_doLineDown:function(a){var b=this._model,c=this,g=this._getSelections();g.forEach(function(g){var f=g.getCaret(),k=b.getLineAtOffset(f),p=c._getLine(k),n=g._columnX,r=1,w=!1;if(-1===n||a.wholeLine||a.select&&h.isIE)n=a.wholeLine?b.getLineEnd(k+1):f,n=g._columnX=p.getBoundingClientRect(n).left;(f=p.getLineIndex(f))<p.getLineCount()-1?r=p.getClientRects(f+1).top+1:(f=b.getLineCount()-1,w=k===f,a.count&&0<a.count?k=Math.min(k+a.count,f):k++);f=!1;if(w){if(a.select||h.isMac||
h.isLinux)g.extend(b.getCharCount()),f=!0}else p.lineIndex!==k&&(p.destroy(),p=c._getLine(k)),g.extend(p.getOffset(n,r)),f=!0;f&&(a.select||g.collapse());p.destroy()});c._setSelection(g,!0,!0,null,0,!1,!0);return!0},_doLineUp:function(a){var b=this._model,c=this,g=this._getSelections();g.forEach(function(g){var f=g.getCaret(),k=b.getLineAtOffset(f),p=c._getLine(k),n=g._columnX,r=!1,w;if(-1===n||a.wholeLine||a.select&&h.isIE)n=a.wholeLine?b.getLineStart(k-1):f,n=g._columnX=p.getBoundingClientRect(n).left;
0<(f=p.getLineIndex(f))?w=p.getClientRects(f-1).top+1:(r=0===k,r||(a.count&&0<a.count?k=Math.max(k-a.count,0):k--,w=c._getLineHeight(k)-1));f=!1;if(r){if(a.select||h.isMac||h.isLinux)g.extend(0),f=!0}else p.lineIndex!==k&&(p.destroy(),p=c._getLine(k)),g.extend(p.getOffset(n,w)),f=!0;f&&(a.select||g.collapse());p.destroy()});c._setSelection(g,!0,!0,null,0,!1,!0);return!0},_doNoop:function(){return!0},_doPageDown:function(a){var b=this,c=this._model,g=this._getSelections(),f=c.getLineCount(),k=this._getScroll(),
p=this._getClientHeight(),n=this._getLineHeight(),r=Math.floor(p/n),w,d,q;g.forEach(function(g){var y=g.getCaret(),m=c.getLineAtOffset(y);if(b._lineHeight){w=g._columnX;var l=b._getBoundsAtOffset(y);if(-1===w||a.select&&h.isIE)w=g._columnX=l.left;y=b._getLineIndex(l.top+p);d=b._getLine(y);var m=b._getLinePixel(y),y=d.getOffset(w,l.top+p-m),A=d.getBoundingClientRect(y);d.destroy();g.extend(y);a.select||g.collapse();q=void 0!==q?Math.min(q,A.top+m-l.top):A.top+m-l.top}else if(m<f-1){l=Math.min(f-m-
1,r);l=Math.max(1,l);w=g._columnX;if(-1===w||a.select&&h.isIE)d=b._getLine(m),w=g._columnX=d.getBoundingClientRect(y).left,d.destroy();d=b._getLine(m+l);g.extend(d.getOffset(w,0));d.destroy();a.select||g.collapse();g=f*n;y=k.y+l*n;y+p>g&&(y=g-p);q=void 0!==q?Math.min(q,y-k.y):y-k.y}});this._setSelection(g,!0,!0,function(){},q,!1,!0);return!0},_doPageUp:function(a){var b=this,c=this._model,g=this._getSelections(),f=this._getScroll(),k=this._getClientHeight(),p=this._getLineHeight(),n=Math.floor(k/
p),r,w,d;g.forEach(function(g){var q=g.getCaret(),y=c.getLineAtOffset(q);if(b._lineHeight){r=g._columnX;y=b._getBoundsAtOffset(q);if(-1===r||a.select&&h.isIE)r=g._columnX=y.left;q=b._getLineIndex(y.bottom-k);w=b._getLine(q);var l=b._getLinePixel(q),q=w.getOffset(r,y.bottom-k-l),m=w.getBoundingClientRect(q);w.destroy();g.extend(q);a.select||g.collapse();d=void 0!==d?Math.max(d,m.top+l-y.top):m.top+l-y.top}else if(0<y){l=Math.max(1,Math.min(y,n));r=g._columnX;if(-1===r||a.select&&h.isIE)w=b._getLine(y),
r=g._columnX=w.getBoundingClientRect(q).left,w.destroy();w=b._getLine(y-l);g.extend(w.getOffset(r,b._getLineHeight(y-l)-1));w.destroy();a.select||g.collapse();g=Math.max(0,f.y-l*p);d=void 0!==d?Math.max(d,g-f.y):g-f.y}});this._setSelection(g,!0,!0,function(){},d,!1,!0);return!0},_doPaste:function(a){var b=this;return null!==this._getClipboardText(a,function(a){if(a.length){h.isLinux&&2===b._lastMouseButton&&(new Date).getTime()-b._lastMouseTime<=b._clickTime&&b._setSelectionTo(b._lastMouseX,b._lastMouseY,
!0);var e=b._getSelections(),c=b._singleMode?"":b._model.getLineDelimiter();b._doContent(1<e.length&&e.length===a.length?a:a.join(c))}})},_doScroll:function(a){var b=a.type,c=this._model,g=c.getLineCount();a=this._getClientHeight();var f=this._getLineHeight(),g=this._lineHeight?this._scrollHeight:g*f,k=this._getScroll().y,p;switch(b){case "textStart":p=0;break;case "textEnd":p=g-a;break;case "pageDown":p=k+a;break;case "pageUp":p=k-a;break;case "lineDown":p=k+f;break;case "lineUp":p=k-f;break;case "centerLine":b=
this._getSelections()[0],p=c.getLineAtOffset(b.start),c=(c.getLineAtOffset(b.end)-p+1)*f,p=p*f-a/2+c/2}void 0!==p&&(p=Math.min(Math.max(0,p),g-a),this._scrollViewAnimated(0,p-k,function(){}));return!0},_doSelectAll:function(){this._setSelection(new g(0,this._model.getCharCount()),!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var a="\t",b=this._getSelections();if(this._expandTab){var a=[],c=this._model,g=this._tabSize;b.forEach(function(b){b=b.getCaret();var f=c.getLineAtOffset(b),
f=c.getLineStart(f);a.push(Array(g-(b-f)%g+1).join(" "))})}return this._modifyContent({text:a,selection:b,_ignoreDOMSelection:!0},!0)}},_doShiftTab:function(){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var a=
this._model,b=this._getSelections(),c=g.editing(b,"down"===this._autoScrollDir),f=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),k=c.getCaret(),p=a.getLineCount(),n=a.getLineAtOffset(k),r;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)k=this._autoScrollY/this._getLineHeight(),k=0>k?Math.floor(k):Math.ceil(k),r=Math.max(0,Math.min(p-1,n+k));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)r=this._getLineIndex(f.y),n=this._getLine(n),f.x+=n.getBoundingClientRect(k,
!1).left,n.destroy();this._blockSelection?b=this._getBlockSelections(b,r,f):0===r&&(h.isMac||h.isLinux)?c.extend(0):r===p-1&&(h.isMac||h.isLinux)?c.extend(a.getCharCount()):(n=this._getLine(r),c.extend(n.getOffset(f.x,f.y-this._getLinePixel(r))),n.destroy());this._setSelection(b,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&
!this._calculateLHTimer){var b=this._model.getLineCount(),c=0;if(a){a=0;for(var g=(new Date).getTime(),f=0;c<b&&!(this._lineHeight[c]||(a++,f||(f=c),this._lineHeight[c]=this._calculateLineHeight(c)),c++,100<(new Date).getTime()-g););this.redrawRulers(0,b);this._queueUpdate()}a=this._getWindow();if(c!==b){var k=this;this._calculateLHTimer=a.setTimeout(function(){k._calculateLHTimer=null;k._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=
void 0)}},_calculateLineHeight:function(a){a=this._getLine(a);var b=a.getBoundingClientRect();a.destroy();return Math.max(1,b.bottom-b.top)},_calculateMetrics:function(){var a=this._clientDiv,b=a.ownerDocument,c=h.createElement(b,"div");c.style.lineHeight="normal";var g={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(g);q(g.style,c);c.style.position="fixed";c.style.left="-1000px";var k=h.createElement(b,"span");k.appendChild(b.createTextNode(" "));
c.appendChild(k);var n=h.createElement(b,"span");n.style.fontStyle="italic";n.appendChild(b.createTextNode(" "));c.appendChild(n);var r=h.createElement(b,"span");r.style.fontWeight="bold";r.appendChild(b.createTextNode(" "));c.appendChild(r);g=h.createElement(b,"span");g.style.fontWeight="bold";g.style.fontStyle="italic";g.appendChild(b.createTextNode(" "));c.appendChild(g);a.appendChild(c);var w=c.getBoundingClientRect(),k=k.getBoundingClientRect(),n=n.getBoundingClientRect(),r=r.getBoundingClientRect(),
g=g.getBoundingClientRect(),k=k.bottom-k.top,n=n.bottom-n.top,r=r.bottom-r.top,d=g.bottom-g.top,y=0,g=0>=w.bottom-w.top,w=Math.max(1,w.bottom-w.top);n>k&&(y=1);r>n&&(y=2);d>r&&(y=3);var l;0!==y&&(l={style:{}},0!==(y&1)&&(l.style.fontStyle="italic"),0!==(y&2)&&(l.style.fontWeight="bold"));k=p(c);a.removeChild(c);y=f(this._viewDiv);c=h.createElement(b,"div");c.style.position="fixed";c.style.left="-1000px";c.style.paddingLeft=y.left+"px";c.style.paddingTop=y.top+"px";c.style.paddingRight=y.right+"px";
c.style.paddingBottom=y.bottom+"px";c.style.width="100px";c.style.height="100px";y=h.createElement(b,"div");y.style.width="100%";y.style.height="100%";c.appendChild(y);a.appendChild(c);n=c.getBoundingClientRect();r=y.getBoundingClientRect();d=0;!this._singleMode&&!this._noScroll&&(c.style.overflow="hidden",y.style.height="200px",d=c.clientWidth,c.style.overflow="scroll",d-=c.clientWidth);a.removeChild(c);var y={left:r.left-n.left,top:r.top-n.top,right:n.right-r.right,bottom:n.bottom-r.bottom},m=0,
A=r=0;if(!g){c=h.createElement(b,"div");c.style.position="fixed";c.style.left="-1000px";a.appendChild(c);c.innerHTML=Array(2).join("a");n=c.getBoundingClientRect();A=Math.ceil(n.right-n.left);if(this._wrapOffset||this._marginOffset)c.innerHTML=Array(this._wrapOffset+1+(h.isWebkit?0:1)).join(" "),n=c.getBoundingClientRect(),m=Math.ceil(n.right-n.left),c.innerHTML=Array(this._marginOffset+1).join(" "),r=c.getBoundingClientRect(),r=Math.ceil(r.right-r.left);a.removeChild(c)}return{lineHeight:w,largestFontStyle:l,
lineTrim:k,viewPadding:y,scrollWidth:d,wrapWidth:m,marginWidth:r,charWidth:A,invalid:g}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(a){var b=this._getSelections();b.forEach(function(b){"next"===a?b.start=b.end:b.end=b.start});this._setSelection(b,!0);return!0},_commitIME:function(a){if(-1!==this._imeOffset){var b=this._model,c=b.getLineAtOffset(this._imeOffset),g=b.getLineStart(c),f=this._getLineNode(c);if(!a){this._scrollDiv.focus();
this._clientDiv.focus();var k=this._getDOMText(f).text,b=b.getLine(c),g=this._imeOffset-g,b=g+k.length-b.length;g!==b&&(a=k.substring(g,b))}this._imeOffset=-1;a&&(!this._doContent(a)&&!h.isWebkit)&&(f.lineRemoved=!0,this._queueUpdate())}},_createActions:function(){this.addKeyMode(new v.DefaultKeyMode(this));var e=this;this._actions={noop:{defaultHandler:function(){return e._doNoop()}},lineUp:{defaultHandler:function(b){return e._doLineUp(a(b,{select:!1}))},actionDescription:{name:t.lineUp}},lineDown:{defaultHandler:function(b){return e._doLineDown(a(b,
{select:!1}))},actionDescription:{name:t.lineDown}},lineStart:{defaultHandler:function(b){return e._doHome(a(b,{select:!1,ctrl:!1}))},actionDescription:{name:t.lineStart}},lineEnd:{defaultHandler:function(b){return e._doEnd(a(b,{select:!1,ctrl:!1}))},actionDescription:{name:t.lineEnd}},charPrevious:{defaultHandler:function(b){return e._doCursorPrevious(a(b,{select:!1,unit:"character"}))},actionDescription:{name:t.charPrevious}},charNext:{defaultHandler:function(b){return e._doCursorNext(a(b,{select:!1,
unit:"character"}))},actionDescription:{name:t.charNext}},pageUp:{defaultHandler:function(b){return e._doPageUp(a(b,{select:!1}))},actionDescription:{name:t.pageUp}},pageDown:{defaultHandler:function(b){return e._doPageDown(a(b,{select:!1}))},actionDescription:{name:t.pageDown}},scrollPageUp:{defaultHandler:function(b){return e._doScroll(a(b,{type:"pageUp"}))},actionDescription:{name:t.scrollPageUp}},scrollPageDown:{defaultHandler:function(b){return e._doScroll(a(b,{type:"pageDown"}))},actionDescription:{name:t.scrollPageDown}},
scrollLineUp:{defaultHandler:function(b){return e._doScroll(a(b,{type:"lineUp"}))},actionDescription:{name:t.scrollLineUp}},scrollLineDown:{defaultHandler:function(b){return e._doScroll(a(b,{type:"lineDown"}))},actionDescription:{name:t.scrollLineDown}},wordPrevious:{defaultHandler:function(b){return e._doCursorPrevious(a(b,{select:!1,unit:"word"}))},actionDescription:{name:t.wordPrevious}},wordNext:{defaultHandler:function(b){return e._doCursorNext(a(b,{select:!1,unit:"word"}))},actionDescription:{name:t.wordNext}},
textStart:{defaultHandler:function(b){return e._doHome(a(b,{select:!1,ctrl:!0}))},actionDescription:{name:t.textStart}},textEnd:{defaultHandler:function(b){return e._doEnd(a(b,{select:!1,ctrl:!0}))},actionDescription:{name:t.textEnd}},scrollTextStart:{defaultHandler:function(b){return e._doScroll(a(b,{type:"textStart"}))},actionDescription:{name:t.scrollTextStart}},scrollTextEnd:{defaultHandler:function(b){return e._doScroll(a(b,{type:"textEnd"}))},actionDescription:{name:t.scrollTextEnd}},centerLine:{defaultHandler:function(b){return e._doScroll(a(b,
{type:"centerLine"}))},actionDescription:{name:t.centerLine}},selectLineUp:{defaultHandler:function(b){return e._doLineUp(a(b,{select:!0}))},actionDescription:{name:t.selectLineUp}},selectLineDown:{defaultHandler:function(b){return e._doLineDown(a(b,{select:!0}))},actionDescription:{name:t.selectLineDown}},selectWholeLineUp:{defaultHandler:function(b){return e._doLineUp(a(b,{select:!0,wholeLine:!0}))},actionDescription:{name:t.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(b){return e._doLineDown(a(b,
{select:!0,wholeLine:!0}))},actionDescription:{name:t.selectWholeLineDown}},selectLineStart:{defaultHandler:function(b){return e._doHome(a(b,{select:!0,ctrl:!1}))},actionDescription:{name:t.selectLineStart}},selectLineEnd:{defaultHandler:function(b){return e._doEnd(a(b,{select:!0,ctrl:!1}))},actionDescription:{name:t.selectLineEnd}},selectCharPrevious:{defaultHandler:function(b){return e._doCursorPrevious(a(b,{select:!0,unit:"character"}))},actionDescription:{name:t.selectCharPrevious}},selectCharNext:{defaultHandler:function(b){return e._doCursorNext(a(b,
{select:!0,unit:"character"}))},actionDescription:{name:t.selectCharNext}},selectPageUp:{defaultHandler:function(b){return e._doPageUp(a(b,{select:!0}))},actionDescription:{name:t.selectPageUp}},selectPageDown:{defaultHandler:function(b){return e._doPageDown(a(b,{select:!0}))},actionDescription:{name:t.selectPageDown}},selectWordPrevious:{defaultHandler:function(b){return e._doCursorPrevious(a(b,{select:!0,unit:"word"}))},actionDescription:{name:t.selectWordPrevious}},selectWordNext:{defaultHandler:function(b){return e._doCursorNext(a(b,
{select:!0,unit:"word"}))},actionDescription:{name:t.selectWordNext}},selectTextStart:{defaultHandler:function(b){return e._doHome(a(b,{select:!0,ctrl:!0}))},actionDescription:{name:t.selectTextStart}},selectTextEnd:{defaultHandler:function(b){return e._doEnd(a(b,{select:!0,ctrl:!0}))},actionDescription:{name:t.selectTextEnd}},deletePrevious:{defaultHandler:function(b){return e._doBackspace(a(b,{unit:"character"}))},actionDescription:{name:t.deletePrevious}},deleteNext:{defaultHandler:function(b){return e._doDelete(a(b,
{unit:"character"}))},actionDescription:{name:t.deleteNext}},deleteWordPrevious:{defaultHandler:function(b){return e._doBackspace(a(b,{unit:"word"}))},actionDescription:{name:t.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(b){return e._doDelete(a(b,{unit:"word"}))},actionDescription:{name:t.deleteWordNext}},deleteLineStart:{defaultHandler:function(b){return e._doBackspace(a(b,{unit:"line"}))},actionDescription:{name:t.deleteLineStart}},deleteLineEnd:{defaultHandler:function(b){return e._doDelete(a(b,
{unit:"line"}))},actionDescription:{name:t.deleteLineEnd}},tab:{defaultHandler:function(b){return e._doTab(a(b,{}))},actionDescription:{name:t.tab}},shiftTab:{defaultHandler:function(b){return e._doShiftTab(a(b,{}))},actionDescription:{name:t.shiftTab}},enter:{defaultHandler:function(b){return e._doEnter(a(b,{}))},actionDescription:{name:t.enter}},enterNoCursor:{defaultHandler:function(b){return e._doEnter(a(b,{noCursor:!0}))},actionDescription:{name:t.enterNoCursor}},escape:{defaultHandler:function(b){return e._doEscape(a(b,
{}))},actionDescription:{name:t.escape}},selectAll:{defaultHandler:function(b){return e._doSelectAll(a(b,{}))},actionDescription:{name:t.selectAll}},copy:{defaultHandler:function(b){return e._doCopy(a(b,{}))},actionDescription:{name:t.copy}},cut:{defaultHandler:function(b){return e._doCut(a(b,{}))},actionDescription:{name:t.cut}},paste:{defaultHandler:function(b){return e._doPaste(a(b,{}))},actionDescription:{name:t.paste}},uppercase:{defaultHandler:function(b){return e._doCase(a(b,{type:"upper"}))},
actionDescription:{name:t.uppercase}},lowercase:{defaultHandler:function(b){return e._doCase(a(b,{type:"lower"}))},actionDescription:{name:t.lowercase}},capitalize:{defaultHandler:function(b){return e._doCase(a(b,{unit:"word",type:"capitalize"}))},actionDescription:{name:t.capitalize}},reversecase:{defaultHandler:function(b){return e._doCase(a(b,{type:"reverse"}))},actionDescription:{name:t.reversecase}},toggleOverwriteMode:{defaultHandler:function(b){return e._doOverwriteMode(a(b,{}))},actionDescription:{name:t.toggleOverwriteMode}},
toggleTabMode:{defaultHandler:function(b){return e._doTabMode(a(b,{}))},actionDescription:{name:t.toggleTabMode}},toggleWrapMode:{defaultHandler:function(b){return e._doWrapMode(a(b,{}))},actionDescription:{name:t.toggleWrapMode}}}},_createRulerParent:function(a,b){var c=h.createElement(a,"div");c.className=b;c.tabIndex=-1;c.style.overflow="hidden";c.style.MozUserSelect="none";c.style.WebkitUserSelect="none";c.style.position="absolute";c.style.top="0px";c.style.bottom="0px";c.style.cursor="default";
c.style.display="none";c.setAttribute("aria-hidden","true");this._rootDiv.appendChild(c);return c},_createRuler:function(a,b){if(this._clientDiv){var c=this._getRulerParent(a);if(c){if(c!==this._marginDiv||this._marginOffset)c.style.display="block";c.rulerWidth=void 0;var g=h.createElement(c.ownerDocument,"div");g._ruler=a;a.node=g;g.rulerChanged=!0;g.style.position="relative";g.style.cssFloat="left";g.style.styleFloat="left";g.style.outline="none";if(void 0===b||0>b||b>=c.children.length)c.appendChild(g);
else{for(var f=c.firstChild;f&&0<b--;)f=f.nextSibling;c.insertBefore(g,f)}}}},_createSelectionDiv:function(){var a=h.createElement(this._parent.ownerDocument,"div");a.className="textviewSelection";a.style.position="absolute";a.style.borderWidth="0px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.width="0px";a.style.height="0px";a.style.zIndex="0";return a},_createView:function(){function a(){k._rootDiv&&(k.update(!0),k._metrics.invalid&&k._getWindow().setTimeout(function(){a()},
100))}if(!this._clientDiv){for(var b=this._parent;b.hasChildNodes();)b.removeChild(b.lastChild);var c=b.ownerDocument,g=h.createElement(c,"div");this._rootDiv=g;g.tabIndex=-1;g.style.position="relative";g.style.overflow="hidden";g.style.width="100%";g.style.height="100%";g.style.overflow="hidden";g.style.WebkitTextSizeAdjust="100%";g.setAttribute("role","application");b.appendChild(g);this._leftDiv=this._createRulerParent(c,"textviewLeftRuler");b=h.createElement(c,"div");b.className="textviewScroll";
this._viewDiv=b;b.tabIndex=-1;b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.borderWidth="0px";b.style.margin="0px";b.style.outline="none";b.style.background="transparent";g.appendChild(b);var f=this._createRulerParent(c,"textviewRightRuler");this._rightDiv=f;f.style.right="0px";this._innerRightDiv=f=this._createRulerParent(c,"textviewInnerRightRuler");f.style.zIndex="1";this._scrollDiv=f=h.createElement(c,"div");f.style.margin="0px";f.style.borderWidth="0px";f.style.padding=
"0px";b.appendChild(f);(this._marginDiv=this._createRulerParent(c,"textviewMarginRuler")).style.zIndex="4";!h.isIE&&!h.isIOS&&(this._clipDiv=b=h.createElement(c,"div"),b.style.position="absolute",b.style.overflow="hidden",b.style.margin="0px",b.style.borderWidth="0px",b.style.padding="0px",b.style.background="transparent",g.appendChild(b),this._clipScrollDiv=f=h.createElement(c,"div"),f.style.position="absolute",f.style.height="1px",f.style.top="-1000px",f.style.background="transparent",b.appendChild(f));
b=h.createElement(c,"div");b.className="textviewContent";this._clientDiv=b;b.tabIndex=0;b.style.position="absolute";b.style.borderWidth="0px";b.style.margin="0px";b.style.padding="0px";b.style.outline="none";b.style.zIndex="1";b.style.WebkitUserSelect="text";b.setAttribute("spellcheck","false");if(h.isIOS||h.isAndroid)b.style.WebkitTapHighlightColor="transparent";(this._clipDiv||g).appendChild(b);this._setFullSelection(this._fullSelection,!0);if(h.isIOS||h.isAndroid)this._vScrollDiv=f=h.createElement(c,
"div"),f.style.position="absolute",f.style.borderWidth="1px",f.style.borderColor="white",f.style.borderStyle="solid",f.style.borderRadius="4px",f.style.backgroundColor="black",f.style.opacity="0.5",f.style.margin="0px",f.style.padding="0px",f.style.outline="none",f.style.zIndex="3",f.style.width="8px",f.style.display="none",g.appendChild(f),this._hScrollDiv=f=h.createElement(c,"div"),f.style.position="absolute",f.style.borderWidth="1px",f.style.borderColor="white",f.style.borderStyle="solid",f.style.borderRadius=
"4px",f.style.backgroundColor="black",f.style.opacity="0.5",f.style.margin="0px",f.style.padding="0px",f.style.outline="none",f.style.zIndex="3",f.style.height="8px",f.style.display="none",g.appendChild(f);h.isFirefox&&!b.setCapture&&(this._overlayDiv=f=h.createElement(c,"div"),f.style.position=b.style.position,f.style.borderWidth=b.style.borderWidth,f.style.margin=b.style.margin,f.style.padding=b.style.padding,f.style.cursor="text",f.style.zIndex="2",(this._clipDiv||g).appendChild(f));b.contentEditable=
"true";b.setAttribute("role","textbox");b.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,!0);this._hookEvents();b=this._rulers;for(f=0;f<b.length;f++)this._createRuler(b[f]);this._update();var k=this;n(c,g,"textview",a)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},
scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},noScroll:{value:!1,update:this._setNoScroll},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},
wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},undoStack:{value:null,update:this._setUndoStack},theme:{value:l.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(a){var b=this._getRulerParent(a);if(b)for(var c=b.firstChild;c;){if(c._ruler===a){c._ruler=void 0;b.removeChild(c);if(0===b.children.length&&(b!==this._marginDiv||!this._marginOffset))b.style.display=
"none";b.rulerWidth=void 0;break}c=c.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),this._updateTimer=null);this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=null);this._cursorTimer&&(a.clearInterval(this._cursorTimer),this._cursorTimer=null);
this._imeTimeout&&(a.clearInterval(this._imeTimeout),this._imeTimeout=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._innerRightDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._domSelection=null}},_doAutoScroll:function(a,b,c){this._autoScrollDir=a;this._autoScrollX=b;this._autoScrollY=c;this._autoScrollTimerID||
this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var b=this._hasFocus;this._ignoreFocus=!0;b&&a.blur();a.contentEditable=!1;a.contentEditable=!0;b&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,b){var c=this._model;c.getBaseModel&&(a=c.mapOffset(a),b=c.mapOffset(b),c=c.getBaseModel());return c.getText(a,b)},
_getBottomIndex:function(a){var b=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=b.getBoundingClientRect();var c=this._clientDiv.getBoundingClientRect();a.bottom>c.bottom&&(b=this._getLinePrevious(b)||b)}return b.lineIndex},_getBlockSelections:function(a,b,c){var f=this._model;a=a.filter(function(a){return!a._editing});var k=f.getLineAtOffset(this._blockSelection.getAnchor()),p;b>k?p=b:(p=k,k=b);for(b=k;b<=p;b++){var n=this._getLine(b),k=n.getOffset(c.x,1),r=n.getOffset(this._blockSelection._docX,
1);n.destroy();k===r&&k===f.getLineEnd(b)||(n=k<r,k=new g(n?k:r,n?r:k,n),k._editing=!0,a.push(k))}return a},_getBoundsAtOffset:function(a){var b=this._getLine(this._model.getLineAtOffset(a));a=b.getBoundingClientRect(a);var c=this._getLinePixel(b.lineIndex);a.top+=c;a.bottom+=c;b.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getInnerRightWidth:function(){var a=this._innerRightDiv.rulerWidth;void 0===a&&(a=
this._innerRightDiv.getBoundingClientRect(),this._innerRightDiv.rulerWidth=a=a.right-a.left);return a},_getClientWidth:function(){var a=this._getViewPadding(),b=this._getInnerRightWidth();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right-b)},_getClipboardText:function(a,b){function g(a){var e=[];c(a,function(a){e.push(a)},null);b&&b(e);return e}var f=this._getWindow(),k=f.clipboardData;!k&&a&&(k=a.clipboardData);if(k)return g(k.getData(h.isIE?"Text":"text/plain"));if(h.isFirefox){this._ignoreFocus=
!0;var p=this._clipboardDiv,k=this._rootDiv.ownerDocument;p||(this._clipboardDiv=p=h.createElement(k,"div"),p.style.position="fixed",p.style.whiteSpace="pre",p.style.left="-1000px",this._rootDiv.appendChild(p));p.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";p.firstChild.focus();var n=this,r=function(){var a=n._getTextFromElement(p);p.innerHTML="";return g(a)},w=!1;this._ignorePaste=!0;if(!h.isLinux||2!==this._lastMouseButton)try{w=k.execCommand("paste",!1,null)}catch(d){w=1<p.childNodes.length||
p.firstChild&&0<p.firstChild.childNodes.length}this._ignorePaste=!1;if(!w){if(a)return f.setTimeout(function(){n.focus();r();n._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;return r()}return""},_getDOMText:function(a,b){return a._line.getText(b)},_getTextFromElement:function(a){var b=a.ownerDocument,c=b.defaultView;if(!c.getSelection)return a.innerText||a.textContent;b=b.createRange();b.selectNode(a);a=c.getSelection();var c=[],g;for(g=0;g<a.rangeCount;g++)c.push(a.getRangeAt(g));
this._ignoreSelect=!0;a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(g=0;g<c.length;g++)a.addRange(c[g]);this._ignoreSelect=!1;return b},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var b=this._getLineNode(a);return b&&!b.lineChanged&&!b.lineRemoved?b._line:new y(this,a)},_getLineHeight:function(a,b){if(void 0!==a&&this._lineHeight){var c=this._lineHeight[a];if(c)return c;if(b||void 0===b)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},
_getLineNode:function(a){for(var b=this._clientDiv.firstChild;b;){if(a===b.lineIndex)return b;b=b.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&(-1===a.lineIndex||!a._line);)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:this._clientDiv.lastChild;a&&(-1===a.lineIndex||!a._line);)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var b=this._getTopIndex(),
c=-this._topIndexY+this._getScroll().y;if(a>b)for(;b<a;b++)c+=this._getLineHeight(b);else for(b-=1;b>=a;b--)c-=this._getLineHeight(b);return c}return this._getLineHeight()*a},_getLineIndex:function(a,b){var c,g=0,f=this._model.getLineCount();if(this._lineHeight){var g=this._getTopIndex(),k=-this._topIndexY+this._getScroll().y;if(a!==k)if(a<k)for(;a<k&&0<g;)a+=this._getLineHeight(--g);else for(c=this._getLineHeight(g);a-c>=k&&g<f-1;)a-=c,c=this._getLineHeight(++g)}else c=this._getLineHeight(),g=Math.floor(a/
c);return b&&(0===f||0>g||g>f-1)?-1:Math.max(0,Math.min(f-1,g))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "innerRight":return this._innerRightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===a||a)&&this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return(Array.isArray(this._selection)?this._selection[0]:this._selection).clone()},
_getSelections:function(){return(Array.isArray(this._selection)?this._selection:[this._selection]).map(function(a){return a.clone()})},_getTopIndex:function(a){var b=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=b.getBoundingClientRect();var c=this._getViewPadding(),g=this._viewDiv.getBoundingClientRect();a.top<g.top+c.top&&(b=this._getLineNext(b)||b)}return b.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(b){a._onModelChanging(b)},onChanged:function(b){a._onModelChanged(b)}};
this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var b=this._handlers=[],c=this._clientDiv,g=this._viewDiv,f=this._rootDiv,k=this._overlayDiv||c,p=c.ownerDocument,n=this._getWindow(),r=h.isIE?p:n;b.push({target:n,type:"resize",handler:function(b){return a._handleResize(b?
b:n.event)}});b.push({target:c,type:"blur",handler:function(b){return a._handleBlur(b?b:n.event)}});b.push({target:c,type:"focus",handler:function(b){return a._handleFocus(b?b:n.event)}});b.push({target:g,type:"focus",handler:function(){c.focus()}});b.push({target:g,type:"scroll",handler:function(b){return a._handleScroll(b?b:n.event)}});b.push({target:c,type:"textInput",handler:function(b){return a._handleTextInput(b?b:n.event)}});b.push({target:c,type:"keydown",handler:function(b){return a._handleKeyDown(b?
b:n.event)}});b.push({target:c,type:"keypress",handler:function(b){return a._handleKeyPress(b?b:n.event)}});b.push({target:c,type:"keyup",handler:function(b){return a._handleKeyUp(b?b:n.event)}});h.isIE&&b.push({target:p,type:"keyup",handler:function(b){return a._handleDocKeyUp(b?b:n.event)}});b.push({target:c,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:n.event)}});b.push({target:c,type:"copy",handler:function(b){return a._handleCopy(b?b:n.event)}});b.push({target:c,type:"cut",
handler:function(b){return a._handleCut(b?b:n.event)}});b.push({target:c,type:"paste",handler:function(b){return a._handlePaste(b?b:n.event)}});b.push({target:p,type:"selectionchange",handler:function(b){return a._handleSelectionChange(b?b:n.event)}});if(h.isIOS||h.isAndroid)b.push({target:c,type:"touchstart",handler:function(b){return a._handleTouchStart(b?b:n.event)}}),b.push({target:c,type:"touchmove",handler:function(b){return a._handleTouchMove(b?b:n.event)}}),b.push({target:c,type:"touchend",
handler:function(b){return a._handleTouchEnd(b?b:n.event)}});else{b.push({target:c,type:"selectstart",handler:function(b){return a._handleSelectStart(b?b:n.event)}});b.push({target:c,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:n.event)}});b.push({target:c,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:n.event)}});b.push({target:c,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:n.event)}});b.push({target:r,type:"mouseup",handler:function(b){return a._handleMouseUp(b?
b:n.event)}});b.push({target:r,type:"mousemove",handler:function(b){return a._handleMouseMove(b?b:n.event)}});b.push({target:f,type:"mousedown",handler:function(b){return a._handleRootMouseDown(b?b:n.event)}});b.push({target:f,type:"mouseup",handler:function(b){return a._handleRootMouseUp(b?b:n.event)}});b.push({target:k,type:"dragstart",handler:function(b){return a._handleDragStart(b?b:n.event)}});b.push({target:k,type:"drag",handler:function(b){return a._handleDrag(b?b:n.event)}});b.push({target:k,
type:"dragend",handler:function(b){return a._handleDragEnd(b?b:n.event)}});b.push({target:k,type:"dragenter",handler:function(b){return a._handleDragEnter(b?b:n.event)}});b.push({target:k,type:"dragover",handler:function(b){return a._handleDragOver(b?b:n.event)}});b.push({target:k,type:"dragleave",handler:function(b){return a._handleDragLeave(b?b:n.event)}});b.push({target:k,type:"drop",handler:function(b){return a._handleDrop(b?b:n.event)}});b.push({target:this._clientDiv,type:26<h.isFirefox?"wheel":
h.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:n.event)}});this._clipDiv&&b.push({target:this._clipDiv,type:26<h.isFirefox?"wheel":h.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:n.event)}});if(h.isFirefox&&(!h.isWindows||15<=h.isFirefox))(g=n.MutationObserver||n.MozMutationObserver)?(this._mutationObserver=new g(function(b){a._handleDataModified(b)}),this._mutationObserver.observe(c,{subtree:!0,characterData:!0})):
b.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(b){return a._handleDataModified(b?b:n.event)}});if(h.isFirefox&&(!h.isWindows||15<=h.isFirefox)||h.isIE||h.isWebkit)b.push({target:this._clientDiv,type:"compositionstart",handler:function(b){return a._handleCompositionStart(b?b:n.event)}}),b.push({target:this._clientDiv,type:"compositionend",handler:function(b){return a._handleCompositionEnd(b?b:n.event)}}),b.push({target:this._clientDiv,type:"compositionupdate",handler:function(b){return a._handleCompositionUpdate(b?
b:n.event)}});this._overlayDiv&&(b.push({target:this._overlayDiv,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:n.event)}}),b.push({target:this._overlayDiv,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:n.event)}}),b.push({target:this._overlayDiv,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:n.event)}}),b.push({target:this._overlayDiv,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:n.event)}}));this._isW3CEvents||b.push({target:this._clientDiv,
type:"dblclick",handler:function(b){return a._handleDblclick(b?b:n.event)}})}this._hookRulerEvents(this._leftDiv,b);this._hookRulerEvents(this._rightDiv,b);this._hookRulerEvents(this._innerRightDiv,b);this._hookRulerEvents(this._marginDiv,b);for(g=0;g<b.length;g++)f=b[g],C(f.target,f.type,f.handler,f.capture)},_hookRulerEvents:function(a,b){if(a){var c=this,g=this._getWindow();h.isIE&&b.push({target:a,type:"selectstart",handler:function(){return!1}});b.push({target:a,type:26<h.isFirefox?"wheel":h.isFirefox?
"DOMMouseScroll":"mousewheel",handler:function(a){return c._handleMouseWheel(a?a:g.event)}});b.push({target:a,type:"click",handler:function(a){c._handleRulerEvent(a?a:g.event)}});b.push({target:a,type:"dblclick",handler:function(a){c._handleRulerEvent(a?a:g.event)}});b.push({target:a,type:"mousemove",handler:function(a){c._handleRulerEvent(a?a:g.event)}});b.push({target:a,type:"mouseover",handler:function(a){c._handleRulerEvent(a?a:g.event)}});b.push({target:a,type:"mouseout",handler:function(a){c._handleRulerEvent(a?
a:g.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;a=a.parentNode}return!1},_init:function(a){var b=a.parent;"string"===typeof b&&(b=(a.document||document).getElementById(b));if(!b)throw Error("no parent");a.parent=b;a.model=a.model||new x.TextModel;var c=this._defaultOptions(),f;for(f in c)c.hasOwnProperty(f)&&(this["_"+f]=void 0!==a[f]?
a[f]:c[f].value);this._keyModes=[];this._rulers=[];this._selection=[new g(0,0,!1)];this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=-1;this._isRangeRects=(!h.isIE||9<=h.isIE)&&"function"===typeof b.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=b.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=
this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_checkOverlayScroll:function(){if(h.isMac&&h.isWebkit&&!this._metrics.invalid&&0===this._metrics.scrollWidth){var a=this._viewDiv,b=this._isOverOverlayScroll();a.style.pointerEvents=b.vertical||b.horizontal?
"":"none"}},_isOverOverlayScroll:function(){if(!(200>(new Date).getTime()-this._lastScrollTime))return{};var a=this._viewDiv.getBoundingClientRect(),b=this._lastMouseMoveX,c=this._lastMouseMoveY;return{vertical:a.top<=c&&c<a.bottom&&a.right-15<=b&&b<a.right,horizontal:a.bottom-15<=c&&c<a.bottom&&a.left<=b&&b<a.right}},_startUndo:function(){if(this._undoStack){var a=this;this._compoundChange=this._undoStack.startCompoundChange({end:function(){a._compoundChange=null}})}},_endUndo:function(){this._undoStack&&
this._undoStack.endCompoundChange()},_modifyContent:function(a,b,c,f){if(this._readonly&&!a._code)return!1;a.type="Verify";var k=a.start=a.selection[0].start,p=a.end=a.selection[0].end;this.onVerify(a);k!==a.start&&(a.selection[0].start=a.start);p!==a.end&&(a.selection[0].end=a.end);if(null===a.text||void 0===a.text)return!1;1<a.selection.length&&this.setRedraw(!1);(k=this._compoundChange)?g.compare(this._getSelections(),k.owner.selection)||(this._endUndo(),1<a.selection.length&&this._startUndo()):
1<a.selection.length&&this._startUndo();var n=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0);var r=0,w=0;a.selection.forEach(function(c){c.start+=r;c.end+=r;var g=Array.isArray(a.text)?a.text[w]:a.text;n.setText(g,c.start,c.end);r+=c.start-c.end+g.length;c.setCaret(b?c.start+g.length:c.start);w++})}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}this._setSelection(a.selection,c,!0,f);if(k=this._compoundChange)k.owner.selection=a.selection;1<a.selection.length&&this.setRedraw(!0);
this.onModify({type:"Modify"});return!0},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var b=a.start,c=a.addedCharCount,g=a.removedCharCount,f=a.addedLineCount,k=a.removedLineCount,p=this._getSelections();p.forEach(function(a){a.end>b&&(a.end>b&&a.start<b+g?a.setCaret(b+c):(a.start+=c-g,a.end+=c-g))});this._setSelection(p,!1,!1);for(var p=this._model.getLineAtOffset(b),n=this._getLineNext();n;){var r=n.lineIndex;p<=r&&r<=p+k&&(p===r&&!n.modelChangedEvent&&
!n.lineRemoved?(n.modelChangedEvent=a,n.lineChanged=!0):(n.lineRemoved=!0,n.lineChanged=!1,n.modelChangedEvent=null));r>p+k&&(n.lineIndex=r+f-k,n._line.lineIndex=n.lineIndex);n=this._getLineNext(n)}this._lineHeight&&(a=[p,k].concat(Array(f)),Array.prototype.splice.apply(this._lineHeight,a));!this._wrapMode&&(p<=this._maxLineIndex&&this._maxLineIndex<=p+k)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type="ModelChanging";
this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_rangesToSelections:function(a){var b=[],c=this._model.getCharCount();a.forEach(function(a){var e;if(a instanceof g)e=a.clone();else{e=a.start;a=a.end;var f=e>a;if(f){var k=e;e=a;a=k}e=Math.max(0,Math.min(e,c));a=Math.max(0,Math.min(a,c));e=new g(e,a,f)}b.push(e)});return b},_resetLineHeight:function(a,
b){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==b)for(var c=a;c<b;c++)this._lineHeight[c]=void 0;else c=this._model.getLineCount(),this._lineHeight=Array(c);this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();
this._setSelection(new g(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(a=a.firstChild;a;)a.lineRemoved=!0,a=a.nextSibling;13>h.isFirefox&&this._fixCaret()}},_scrollViewAnimated:function(a,b,c){var g=this._getWindow();if(c&&this._scrollAnimation){var f=this;this._animation=new D({window:g,duration:this._scrollAnimation,curve:[b,0],onAnimate:function(a){a=b-Math.floor(a);f._scrollView(0,a);b-=a},onEnd:function(){f._animation=null;
f._scrollView(a,b);c&&g.setTimeout(c,0)}});this._animation.play()}else this._scrollView(a,b),c&&g.setTimeout(c,0)},_scrollView:function(a,b){this._ensureCaretVisible=!1;var c=this._viewDiv;a&&(c.scrollLeft+=a);b&&(c.scrollTop+=b)},_setClipboardText:function(a,b){var g,f=this._getWindow(),k=f.clipboardData;!k&&b&&(k=b.clipboardData);if(k&&(g=[],c(a,function(a){g.push(a)},function(){g.push(h.platformDelimiter)}),k.setData(h.isIE?"Text":"text/plain",g.join(""))||21<h.isFirefox))return!0;var p=this._parent.ownerDocument,
n=h.createElement(p,"pre");n.style.position="fixed";n.style.left="-1000px";c(a,function(a){n.appendChild(p.createTextNode(a))},function(){n.appendChild(h.createElement(p,"br"))});n.appendChild(p.createTextNode(" "));this._clientDiv.appendChild(n);k=p.createRange();k.setStart(n.firstChild,0);k.setEndBefore(n.lastChild);var r=f.getSelection();0<r.rangeCount&&r.removeAllRanges();r.addRange(k);var w=this,k=function(){n&&n.parentNode===w._clientDiv&&w._clientDiv.removeChild(n);w._updateDOMSelection()},
r=!1;this._ignoreCopy=!0;try{r=p.execCommand("copy",!1,null)}catch(d){}this._ignoreCopy=!1;if(!r&&b)return f.setTimeout(k,0),!1;k();return!0},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;h.isIE&&a&&(this._hadFocus=this._hasFocus);var b=this._clientDiv;b.contentEditable=!a;this._hadFocus&&
!a&&b.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;)a._line.updateLinks(),a=this._getLineNext(a);this._updateDOMSelection()}},_setSelection:function(a,b,c,f,k,p,n){if(a){void 0===c&&(c=!0);var r=this._getSelections();a=Array.isArray(a)?a:p?r.concat([a]):[a];this._selection=g.merge(a);n||a.forEach(function(a){a._columnX=-1});!1!==b&&this._showCaret(!1,f,b,k);c&&this._updateDOMSelection();g.compare(r,a)||(b={type:"Selection",oldValue:g.convert(r),
newValue:g.convert(a)},this.onSelection(b))}},_setSelectionTo:function(a,b,c,f,k,p){var n=this._model,r=this._getSelections(),w=this.convert({x:a,y:b},"page","document");b=this._getLineIndex(w.y);a=this._getLine(b);var d=a.getOffset(w.x,w.y-this._getLinePixel(b));if(p&&!f&&g.contains(r,d))return this._dragOffset=d,a.destroy(),!1;this._blockSelection?r=this._getBlockSelections(r,b,w):(c?f?(c=r[r.length-1],c._editing=!0):(c=new g(0,0),c._editing=!0,k?r.push(c):r=[c],c._docX=w.x):c=g.editing(r),1===
this._clickCount?(c.extend(d),f||c.collapse()):(0===(this._clickCount&1)?this._doubleClickSelection?d>=this._doubleClickSelection.start?(f=this._doubleClickSelection.start,n=a.getNextOffset(d,{unit:"wordend",count:1})):(f=a.getNextOffset(d,{unit:"word",count:-1}),n=this._doubleClickSelection.end):(f=a.getNextOffset(d,{unit:"word",count:-1}),n=a.getNextOffset(f,{unit:"wordend",count:1})):this._doubleClickSelection?(k=n.getLineAtOffset(this._doubleClickSelection.start),b>=k?(f=n.getLineStart(k),n=n.getLineEnd(b)):
(f=n.getLineStart(b),n=n.getLineEnd(k))):(f=n.getLineStart(b),n=n.getLineEnd(b)),c.setCaret(f),c.extend(n)));this._setSelection(r,!0,!0,null,!1);a.destroy();return!0},_setFullSelection:function(a,b){this._fullSelection=a;h.isWebkit&&(this._fullSelection=!0);this._domSelection||(this._domSelection=[],this._cursorVisible=!0);b||this._updateDOMSelection()},_setBlockCursor:function(a){this._blockCursorVisible=a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},
_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=this._viewDiv,b=h.createElement(a.ownerDocument,"div");b.className="textviewBlockCursor";this._cursorDiv=b;b.tabIndex=-1;b.style.zIndex="2";b.style.color="transparent";b.style.position="absolute";b.style.pointerEvents="none";b.innerHTML="\x26nbsp;";a.appendChild(b);this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=
null)},_setMarginOffset:function(a,b){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";b||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(a,b){this._wrapOffset=a;b||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,b){this._singleMode=a;this._updateOverflow();this._updateStyle(b)},_setNoScroll:function(a,
b){this._noScroll=a;this._updateOverflow();this._updateStyle(b)},_setTabSize:function(a,b){this._tabSize=a;this._customTabSize=void 0;var c=this._clientDiv;h.isOpera?c&&(c.style.OTabSize=this._tabSize+""):537.1<=h.isWebkit?c&&(c.style.tabSize=this._tabSize+""):4<=h.isFirefox?c&&(c.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);b||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",
this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,b){this._themeClass=a;var c="textview",g=this._theme.getThemeClass();g&&(c+=" "+g);this._themeClass&&g!==this._themeClass&&(c+=" "+this._themeClass);this._rootDiv.className=c;this._updateStyle(b)},_setUndoStack:function(a){this._undoStack=a},_setWrapMode:function(a,b){this._wrapMode=a&&this._wrappable;var c=this._clientDiv;
this._wrapMode?(c.style.whiteSpace="pre-wrap",c.style.wordWrap="break-word"):(c.style.whiteSpace="pre",c.style.wordWrap="normal");this._updateOverflow();b||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,b,c,f){if(this._clientDiv&&!(0<this._redrawCount)&&!this._ignoreDOMSelection&&-1===this._imeOffset){var k=this._model,n=this._getSelections(),p=g.editing(n,"down"===this._autoScrollDir),r=this._getScroll(),n=p.getCaret(),w=p.start,d=p.end,q=k.getLineAtOffset(w),
h=k.getLineAtOffset(d),y=Math.max(Math.max(w,k.getLineStart(h)),d-1),k=this._getClientWidth(),l=this._getClientHeight(),m=k/4,A=this._getBoundsAtOffset(n===w?w:y),s=A.left,C=A.right,t=A.top,z=A.bottom,v=0,D="object"===typeof c;if((a||D)&&!p.isEmpty())A=this._getBoundsAtOffset(n===d?w:y),v=(A.bottom>z?A.bottom:z)-(A.top<t?A.top:t),a&&(A.top===t?n===w?C=s+Math.min(A.right-s,k):s=C-Math.min(C-A.left,k):n===w?z=t+Math.min(A.bottom-t,l):t=z-Math.min(z-A.top,l));a=0;s<r.x&&(a=Math.min(s-r.x,-m));C>r.x+
k&&(a=Math.max(C-r.x-k,m));p=0;t<r.y?p=t-r.y:z>r.y+l&&(p=z-r.y-l);f&&(0<f?0<p&&(p=Math.max(p,f)):0>p&&(p=Math.min(p,f)));f=D&&"always"===c.scrollPolicy;if(0!==a||0!==p||f)return D?(f=0<p,0===p&&(p=t-r.y),r=c.viewAnchor,t=c.selectionAnchor,c=Math.min(Math.max(0,c.viewAnchorOffset||0)),p="top"===r?p+Math.floor(f?(1-c)*l:-c*l):"bottom"===r?p+Math.floor(f?c*l:-(1-c)*l):"center"===r?p+Math.floor(f?l/2+c*l:l/2-(1-c)*l):p+Math.floor(f?c*l:-c*l),q!==h&&("top"===t&&n!==w?p+=Math.floor(-v):"bottom"===t&&n!==
d?p+=Math.floor(v):"center"===t&&(p+=Math.floor(v/2)))):0!==p&&"number"===typeof c&&(0>c&&(c=0),1<c&&(c=1),p+=Math.floor(0<p?c*l:-c*l)),this._scrollViewAnimated(a,p,b),l!==this._getClientHeight()||k!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0;b&&b();return!1}},_startIME:function(){if(-1===this._imeOffset){for(var a=!1,b=this._getSelections(),c=0;c<b.length&&!a;c++)a=!b[c].isEmpty();a&&this._modifyContent({text:"",selection:b},!0);this._imeOffset=b[0].start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",
this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var b=this._handlers[a];z(b.target,b.type,b.handler)}this._handlers=null;this._mutationObserver&&this._mutationObserver.disconnect()},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&-1===this._imeOffset&&this._clientDiv){var a=
this._getSelections(),b=this._domSelection,c;if(b.length<a.length)for(c=b.length;c<a.length;c++)b.push(new w(this));else b.length>a.length&&b.splice(a.length).forEach(function(a){a.destroy()});for(c=0;c<b.length;c++)b[c].setPrimary(0===c),b[c].setSelection(a[c]);var a=this._getWindow(),g=this;1<b.length?this._cursorTimer||(this._cursorTimer=a.setInterval(function(){g._cursorVisible=!g._cursorVisible;g._domSelection.forEach(function(a){a.update()})},500)):this._cursorTimer&&(a.clearInterval(this._cursorTimer),
this._cursorTimer=null)}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var b=this._clientDiv,c=this._viewDiv;if(b){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var g=this._model,f=this._getScroll(!1),k=this._getViewPadding(),p=g.getLineCount(),n=this._getLineHeight(),r=!1,w=!1,d=!1,q=this._metrics.scrollWidth;this._wrapMode&&(b.style.width=(this._metrics.wrapWidth||
this._getClientWidth())+"px");var l,m,A,s,C=0,t=0,z;if(this._lineHeight){for(;t<p;){z=this._getLineHeight(t);if(C+z>f.y)break;C+=z;t++}l=t;m=Math.max(0,l-1);A=g=f.y-C;0<l&&(g+=this._getLineHeight(l-1))}else s=Math.max(0,f.y)/n,l=Math.floor(s),m=Math.max(0,l-1),g=Math.round((s-m)*n),A=Math.round((s-l)*n);this._topIndexY=A;s=this._rootDiv;var v=s.clientWidth,D=s.clientHeight;if(a){n=0;this._leftDiv&&(l=this._leftDiv.getBoundingClientRect(),n=l.right-l.left);l=this._getClientWidth();s=this._getClientHeight();
w=l;this._wrapMode?this._metrics.wrapWidth&&(w=this._metrics.wrapWidth):w=Math.max(this._maxLineWidth,w);for(;t<p;)z=this._getLineHeight(t,!1),C+=z,t++;p=C}else{s=this._getClientHeight();A=Math.min(l+Math.floor((s+A)/n),p-1);var f=Math.min(A+1,p-1),x;for(z=b.firstChild;z;){x=z.lineIndex;var F=z.nextSibling;if(!(m<=x&&x<=f)||z.lineRemoved||-1===z.lineIndex)this._mouseWheelLine===z?(z.style.display="none",z.lineIndex=-1):b.removeChild(z);z=F}z=this._getLineNext();var F=c.ownerDocument,H=F.createDocumentFragment();
for(x=m;x<=f;x++)!z||z.lineIndex>x?(new y(this,x)).create(H,null):(H.firstChild&&(b.insertBefore(H,z),H=F.createDocumentFragment()),z&&z.lineChanged&&(z=(new y(this,x)).create(H,z),z.lineChanged=!1),z=this._getLineNext(z));H.firstChild&&b.insertBefore(H,z);h.isWebkit&&!this._wrapMode&&(b.style.width="0x7fffffffpx");z=this._getLineNext();x=s+g;for(H=!1;z;)m=z.lineWidth,void 0===m&&(F=z._line.getBoundingClientRect(),m=z.lineWidth=Math.ceil(F.right-F.left),F=F.bottom-F.top,this._lineHeight?this._lineHeight[z.lineIndex]=
F:0!==n&&(0!==F&&Math.ceil(n)!==Math.ceil(F))&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[z.lineIndex]=F)),this._lineHeight&&!H&&(x-=this._lineHeight[z.lineIndex],0>x&&(A=z.lineIndex,H=!0)),this._wrapMode||(m>=this._maxLineWidth&&(this._maxLineWidth=m,this._maxLineIndex=z.lineIndex),this._checkMaxLineIndex===z.lineIndex&&(this._checkMaxLineIndex=-1)),z.lineIndex===l&&(this._topChild=z),z.lineIndex===A&&(this._bottomChild=z),z=this._getLineNext(z);-1!==this._checkMaxLineIndex&&
(x=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=x&&x<p&&(n=new y(this,x),F=n.getBoundingClientRect(),m=F.right-F.left,m>=this._maxLineWidth&&(this._maxLineWidth=m,this._maxLineIndex=x),n.destroy()));for(;t<p;)z=this._getLineHeight(t,t<=A),C+=z,t++;p=C;this._updateRuler(this._leftDiv,l,f,D);this._updateRuler(this._rightDiv,l,f,D);this._updateRuler(this._innerRightDiv,l,f,D);this._updateRuler(this._marginDiv,l,f,D);n=0;this._leftDiv&&(l=this._leftDiv.getBoundingClientRect(),n=l.right-l.left);
C=0;this._rightDiv&&(f=this._rightDiv.getBoundingClientRect(),C=f.right-f.left);c.style.left=n+"px";c.style.right=C+"px";f=this._scrollDiv;f.style.height=p+(h.isWebkit?0:k.bottom)+"px";l=this._getClientWidth();!this._singleMode&&(!this._wrapMode&&!this._noScroll)&&(t=r=s,(A="scroll"===c.style.overflowX)?r+=q:t-=q,m=z=l,(x="scroll"===c.style.overflowY)?z+=q:m-=q,s=r,l=z,p>s&&(d=!0,l=m),this._maxLineWidth>l&&(w=!0,s=t,p>s&&(d=!0,l=m)),A!==w&&(c.style.overflowX=w?"scroll":"hidden"),x!==d&&(c.style.overflowY=
d?"scroll":"hidden"),r=A!==w||x!==d);d=l;this._wrapMode?this._metrics.wrapWidth&&(d=this._metrics.wrapWidth):d=Math.max(this._maxLineWidth+this._getInnerRightWidth(),d);w=d;if((!h.isIE||9<=h.isIE)&&this._maxLineWidth>l)d+=k.right+k.left;f.style.width=d+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=d+"px");f=this._getScroll(!1);if(d=this._innerRightDiv)d.style.right=C+("scroll"===c.style.overflowY?this._metrics.scrollWidth:0)+"px",d.style.bottom=("scroll"===c.style.overflowX?q:0)+"px"}this._scrollHeight=
p;this._vScrollDiv&&(d=s-8,C=Math.max(15,Math.ceil(Math.min(1,d/(p+k.top+k.bottom))*d)),this._vScrollDiv.style.left=n+l-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,f.y*d/p))+"px",this._vScrollDiv.style.height=C+"px");!this._wrapMode&&this._hScrollDiv&&(d=l-8,C=Math.max(15,Math.ceil(Math.min(1,d/(this._maxLineWidth+k.left+k.right))*d)),this._hScrollDiv.style.left=n+Math.floor(Math.max(0,Math.floor(f.x*d/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=s-9+"px",this._hScrollDiv.style.width=
C+"px");t=f.x;C=this._clipDiv;d=this._overlayDiv;if(A=this._marginDiv)A.style.left=-t+n+this._metrics.marginWidth+k.left+"px",A.style.bottom=("scroll"===c.style.overflowX?q:0)+"px";C?(C.scrollLeft=t,C.scrollTop=0,c=n+k.left,q=k.top,a=l,n=s,t=0,A=-g,0===f.x&&(c-=k.left,a+=k.left,t=k.left),f.x+l===w&&(a+=k.right),0===f.y&&(q-=k.top,n+=k.top,A+=k.top),f.y+s===p&&(n+=k.bottom),C.style.left=c+"px",C.style.top=q+"px",C.style.right=v-a-c+"px",C.style.bottom=D-n-q+"px",b.style.left=t+"px",b.style.top=A+"px",
b.style.width=w+"px",b.style.height=s+g+"px",d&&(d.style.left=b.style.left,d.style.top=b.style.top,d.style.width=b.style.width,d.style.height=b.style.height)):(c=t,q=g,v=t+l,D=g+s,0===c&&(c-=k.left),0===q&&(q-=k.top),v===w&&(v+=k.right),f.y+s===p&&(D+=k.bottom),b.style.clip="rect("+q+"px,"+v+"px,"+D+"px,"+c+"px)",b.style.left=-t+n+k.left+"px",b.style.width=(this._wrapMode||h.isWebkit?w:l+t)+"px",a||(b.style.top=-g+k.top+"px",b.style.height=s+g+"px"),d&&(d.style.clip=b.style.clip,d.style.left=b.style.left,
d.style.width=b.style.width,a||(d.style.top=b.style.top,d.style.height=b.style.height)));this._updateDOMSelection();r&&(b=this._ensureCaretVisible,this._ensureCaretVisible=!1,b&&this._showCaret(),this._queueUpdate())}}},_updateOverflow:function(){var a=this._viewDiv;this._noScroll?a.style.overflow="hidden":this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,b,c,g){if(a)for(var f=this._parent.ownerDocument,k=this._getLineHeight(),
p=this._getViewPadding(),n=a.firstChild;n;){var r=n._ruler,w=r.getOverview();n.rulerChanged&&(q(r.getRulerStyle(),n),a.rulerWidth=void 0);if("fixed"!==w){var d=k;"page"===w&&(d+=this._topIndexY);n.style.top=-d+"px";n.style.height=g+d+"px";var y,l=n.firstChild;l?(y=l,l=l.nextSibling):(y=h.createElement(f,"div"),y.style.visibility="hidden",n.appendChild(y));var m;if(n.rulerChanged&&y){d=-1;if(m=r.getWidestAnnotation())q(m.style,y),m.html&&(y.innerHTML=m.html);y.lineIndex=d;y.style.height=k+p.top+"px"}var A,
s;if("page"===w){for(r=r.getAnnotations(b,c+1);l;)d=l.lineIndex,m=l.nextSibling,(!(b<=d&&d<=c)||l.lineChanged)&&n.removeChild(l),l=m;l=n.firstChild.nextSibling;s=f.createDocumentFragment();for(d=b;d<=c;d++)if(!l||l.lineIndex>d){A=h.createElement(f,"div");if(m=r[d])q(m.style,A),m.html&&(A.innerHTML=m.html),A.annotation=m;A.lineIndex=d;A.style.height=this._getLineHeight(d)+"px";s.appendChild(A)}else s.firstChild&&(n.insertBefore(s,l),s=f.createDocumentFragment()),l&&(l=l.nextSibling);s.firstChild&&
n.insertBefore(s,l)}else{m=this._getClientHeight();d=this._model.getLineCount();l=m+p.top+p.bottom-2*this._metrics.scrollWidth;k*d<l?(w=k,y=p.top):(w=l/d,y=this._metrics.scrollWidth);if(n.rulerChanged){for(m=n.childNodes.length;1<m;)n.removeChild(n.lastChild),m--;r=r.getAnnotations(0,d);s=f.createDocumentFragment();for(var C in r)d=C>>>0,0>d||(A=h.createElement(f,"div"),m=r[C],q(m.style,A),A.style.position="absolute",A.style.top=y+k+Math.floor(d*w)+"px",m.html&&(A.innerHTML=m.html),A.annotation=m,
A.lineIndex=d,s.appendChild(A));n.appendChild(s)}else if(n._oldTrackHeight!==l)for(A=n.firstChild?n.firstChild.nextSibling:null;A;)A.style.top=this._metrics.scrollWidth+k+Math.floor(A.lineIndex*w)+"px",A=A.nextSibling;n._oldTrackHeight=l}}n.rulerChanged=!1;n=n.nextSibling}},_updateStyleSheet:function(){var a="";h.isWebkit&&0<this._metrics.scrollWidth&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");if(a){var b=this._clientDiv.ownerDocument,c=b.getElementById("_textviewStyle");
if(c)c.removeChild(c.firstChild),c.appendChild(b.createTextNode(a));else{c=h.createElement(b,"style");c.id="_textviewStyle";var g=b.getElementsByTagName("head")[0]||b.documentElement;c.appendChild(b.createTextNode(a));g.insertBefore(c,g.firstChild)}}},_updateStyle:function(a,b){!a&&h.isIE&&(this._rootDiv.style.lineHeight="normal");b=this._metrics=b||this._calculateMetrics();this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight());this._rootDiv.style.lineHeight=h.isIE?b.lineHeight-
(b.lineTrim.top+b.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();if(h.isMac&&h.isWebkit){var c=this._viewDiv;!b.invalid&&0===b.scrollWidth?(c.style.pointerEvents="none",c.style.zIndex="2"):(c.style.pointerEvents="",c.style.zIndex="")}a||(this.redraw(),this._resetLineWidth())}};d.EventTarget.addMixin(A.prototype);return{TextView:A}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(t,x){function v(d){this._model=d;this._projections=[];var l=this;this._listener={onChanged:function(d){l._onChanged(d)},onChanging:function(d){l._onChanging(d)}};d.addEventListener("postChanged",this._listener.onChanged);d.addEventListener("preChanging",this._listener.onChanging)}v.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),
this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(d){if(d){var l=this._model,m=this._projections;d._lineIndex=l.getLineAtOffset(d.start);d._lineCount=l.getLineAtOffset(d.end)-d._lineIndex;var h=d.text;h||(h="");d._model="string"===typeof h?new t.TextModel(h,l.getLineDelimiter()):h;var l=this.mapOffset(d.start,!0),h=d.end-d.start,s=d._lineCount,q=d._model.getCharCount(),b=d._model.getLineCount()-1,a={type:"Changing",text:d._model.getText(),
start:l,removedCharCount:h,addedCharCount:q,removedLineCount:s,addedLineCount:b};this.onChanging(a);a=this._binarySearch(m,d.start);m.splice(a,0,d);this.onChanged({type:"Changed",start:l,removedCharCount:h,addedCharCount:q,removedLineCount:s,addedLineCount:b})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(d,l){var m=this._projections,h=0,s,q;if(l){for(s=0;s<m.length;s++){q=m[s];if(q.start>d)break;if(q.end>d)return-1;h+=
q._model.getCharCount()-(q.end-q.start)}return d+h}for(s=0;s<m.length;s++){q=m[s];if(q.start>d-h)break;var b=q._model.getCharCount();if(q.start+b>d-h)return-1;h+=b-(q.end-q.start)}return d-h},removeProjection:function(d){this._removeProjection(d)},_removeProjection:function(d,l){var m,h=0;for(m=0;m<this._projections.length;m++){var s=this._projections[m];if(s===d){d=s;break}h+=s._model.getCharCount()-(s.end-s.start)}if(m<this._projections.length){var s=this._model,h=d.start+h,q=d.end-d.start,b=d._lineCount,
a=d._model.getCharCount(),k=d._model.getLineCount()-1;l||(s={type:"Changing",text:s.getText(d.start,d.end),start:h,removedCharCount:a,addedCharCount:q,removedLineCount:k,addedLineCount:b},this.onChanging(s));this._projections.splice(m,1);if(!l)this.onChanged({type:"Changed",start:h,removedCharCount:a,addedCharCount:q,removedLineCount:k,addedLineCount:b})}},_binarySearch:function(d,l){for(var m=d.length,h=-1,s;1<m-h;)s=Math.floor((m+h)/2),l<=d[s].start?m=s:h=s;return m},getCharCount:function(){for(var d=
this._model.getCharCount(),l=this._projections,m=0;m<l.length;m++)var h=l[m],d=d+(h._model.getCharCount()-(h.end-h.start));return d},getLine:function(d,l){if(0>d)return null;var m=this._model,h=this._projections,s=0,q=[],b=0,a,k,c;for(a=0;a<h.length;a++){c=h[a];if(c._lineIndex>=d-s)break;k=c._model.getLineCount()-1;if(c._lineIndex+k>=d-s){b=d-(c._lineIndex+s);if(b<k)return c._model.getLine(b,l);q.push(c._model.getLine(k))}b=c.end;s+=k-c._lineCount}for(b=Math.max(b,m.getLineStart(d-s));a<h.length;a++){c=
h[a];if(c._lineIndex>d-s)break;q.push(m.getText(b,c.start));k=c._model.getLineCount()-1;if(c._lineIndex+k>d-s)return q.push(c._model.getLine(0,l)),q.join("");q.push(c._model.getText());b=c.end;s+=k-c._lineCount}h=m.getLineEnd(d-s,l);b<h&&q.push(m.getText(b,h));return q.join("")},getLineAtOffset:function(d){for(var l=this._model,m=this._projections,h=0,s=0,q=0;q<m.length;q++){var b=m[q];if(b.start>d-h)break;var a=b._model.getCharCount();if(b.start+a>d-h){m=d-(b.start+h);s+=b._model.getLineAtOffset(m);
h+=m;break}s+=b._model.getLineCount()-1-b._lineCount;h+=a-(b.end-b.start)}return l.getLineAtOffset(d-h)+s},getLineCount:function(){for(var d=this._projections,l=this._model.getLineCount(),m=0;m<d.length;m++)var h=d[m],l=l+(h._model.getLineCount()-1-h._lineCount);return l},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(d,l){if(0>d)return-1;for(var m=this._model,h=this._projections,s=0,q=0,b=0;b<h.length;b++){var a=h[b];if(a._lineIndex>d-s)break;var k=a._model.getLineCount()-
1;if(a._lineIndex+k>d-s)return a._model.getLineEnd(d-(a._lineIndex+s),l)+a.start+q;q+=a._model.getCharCount()-(a.end-a.start);s+=k-a._lineCount}return m.getLineEnd(d-s,l)+q},getLineStart:function(d){if(0>d)return-1;for(var l=this._model,m=this._projections,h=0,s=0,q=0;q<m.length;q++){var b=m[q];if(b._lineIndex>=d-h)break;var a=b._model.getLineCount()-1;if(b._lineIndex+a>=d-h)return b._model.getLineStart(d-(b._lineIndex+h))+b.start+s;s+=b._model.getCharCount()-(b.end-b.start);h+=a-b._lineCount}return l.getLineStart(d-
h)+s},getText:function(d,l){void 0===d&&(d=0);var m=this._model,h=this._projections,s=0,q=[],b,a,k;for(b=0;b<h.length;b++){a=h[b];if(a.start>d-s)break;k=a._model.getCharCount();if(a.start+k>d-s){if(void 0!==l&&a.start+k>l-s)return a._model.getText(d-(a.start+s),l-(a.start+s));q.push(a._model.getText(d-(a.start+s)));d=a.end+s+k-(a.end-a.start)}s+=k-(a.end-a.start)}var c=d-s;if(void 0!==l){for(;b<h.length;b++){a=h[b];if(a.start>l-s)break;q.push(m.getText(c,a.start));k=a._model.getCharCount();if(a.start+
k>l-s)return q.push(a._model.getText(0,l-(a.start+s))),q.join("");q.push(a._model.getText());c=a.end;s+=k-(a.end-a.start)}q.push(m.getText(c,l-s))}else{for(;b<h.length;b++)a=h[b],q.push(m.getText(c,a.start)),q.push(a._model.getText()),c=a.end;q.push(m.getText(c))}return q.join("")},_onChanged:function(d){d=this._change;var l=d.baseStart,m=d.baseEnd,h,s,q=this._projections;for(h=0;h<q.length&&!(s=q[h],s.end>l);h++);var b=h;for(h=0;h<q.length&&!(s=q[h],s.start>=m);h++);var a=h,k=this._model,l=d.baseText.length-
(m-l);for(h=a;h<q.length;h++)s=q[h],s.start+=l,s.end+=l,s._lineIndex=k.getLineAtOffset(s.start);s=q.splice(b,a-b);for(h=0;h<s.length;h++)s[h].annotation&&s[h].annotation._expand();this.onChanged({type:"Changed",start:d.start,removedCharCount:d.removedCharCount,addedCharCount:d.addedCharCount,removedLineCount:d.removedLineCount,addedLineCount:d.addedLineCount});this._change=void 0},_onChanging:function(d){var l=!!this._change,m=this._change||{},h=d.start,s=h+d.removedCharCount;m.baseStart=h;m.baseEnd=
s;m.baseText=d.text;m.addedLineCount=d.addedLineCount;if(!l){this._change=m;m.text=d.text;var q=this._projections,b,a,k;d=function(c){for(b=a=0;a<q.length;a++){k=q[a];if(k.start>c)break;if(k.end>c)return-1;b+=k._model.getCharCount()-(k.end-k.start)}return c+b};m.start=d(h);-1===m.start&&(m.text=this._model.getText(k.start,h)+m.text,m.addedLineCount+=this._model.getLineAtOffset(h)-this._model.getLineAtOffset(k.start),m.start=k.start+b);m.end=d(s);-1===m.end&&(m.text+=this._model.getText(s,k.end),m.addedLineCount+=
this._model.getLineAtOffset(k.end)-this._model.getLineAtOffset(s),m.end=k.start+b)}m.addedCharCount=m.text.length;m.removedCharCount=m.end-m.start;m.removedLineCount=this.getLineAtOffset(m.end)-this.getLineAtOffset(m.start);this.onChanging({type:"Changing",text:m.text,start:m.start,removedCharCount:m.removedCharCount,addedCharCount:m.addedCharCount,removedLineCount:m.removedLineCount,addedLineCount:m.addedLineCount})},onChanging:function(d){return this.dispatchEvent(d)},onChanged:function(d){return this.dispatchEvent(d)},
setLineDelimiter:function(d){this._model.setLineDelimiter(d)},setText:function(d,l,m){function h(c){for(q=b=0;b<s.length;b++){a=s[b];if(a.start>c-q)break;var k=a._model.getCharCount();if(a.start+k>c-q)return-1;q+=k-(a.end-a.start)}return c-q}this._change={text:d||"",start:l||0,end:void 0===m?this.getCharCount():m};var s=this._projections,q,b,a,k,c;d=h(this._change.start);-1===d&&(k={projection:a,start:this._change.start-(a.start+q)},d=a.end);l=h(this._change.end);-1===l&&(c={projection:a,end:this._change.end-
(a.start+q)},l=a.start);k&&c&&k.projection===c.projection?a._model.setText(this._change.text,k.start,c.end):(this._model.setText(this._change.text,d,l),k&&(a=k.projection,a._model.setText("",k.start)),c&&(a=c.projection,a._model.setText("",0,c.end),a.start=a.end,a._lineCount=0));this._change=void 0}};x.EventTarget.addMixin(v.prototype);return{ProjectionTextModel:v}});
(function(t,x){"function"===typeof define&&define.amd?define("orion/Deferred",x):"object"===typeof exports?module.exports=x():(t.orion=t.orion||{},t.orion.Deferred=x())})(this,function(){function t(){for(var d;d=l.shift();)d();m=!1}function x(d){l.push(d);m||(m=!0,h())}function v(d){return function(q){d(q)}}function d(){function h(){for(var a;a=f.shift();){var b=a.deferred,p="fulfilled"===c?"resolve":"reject";a=a[p];if("function"===typeof a)try{var r=a(k),d=r&&("object"===typeof r||"function"===typeof r)&&
r.then;if("function"===typeof d)if(r===b.promise)b.reject(new TypeError);else{var q=r.cancel;"function"===typeof q?b._parentCancel=q.bind(r):delete b._parentCancel;d.call(r,v(b.resolve),v(b.reject),v(b.progress))}else b.resolve(r)}catch(l){b.reject(l)}else b[p](k)}}function q(a){delete p._parentCancel;c="rejected";k=a;f.length&&x(h)}function b(a){function g(a){return function(b){(!c||"assumed"===c)&&a(b)}}delete p._parentCancel;try{var w=a&&("object"===typeof a||"function"===typeof a)&&a.then;if("function"===
typeof w)if(a===p)q(new TypeError);else{c="assumed";var r=a&&a.cancel;if("function"!==typeof r){var y=new d;a=y.promise;try{w(y.resolve,y.reject,y.progress)}catch(l){y.reject(l)}r=a.cancel;w=a.then}k=a;w.call(a,g(b),g(q));p._parentCancel=r.bind(a)}else c="fulfilled",k=a,f.length&&x(h)}catch(m){g(q)(m)}}function a(){var a=p._parentCancel;a?(delete p._parentCancel,a()):c||(a=Error("Cancel"),a.name="Cancel",q(a))}var k,c,f=[],p=this;this.resolve=function(a){c||b(a);return p};this.reject=function(a){c||
q(a);return p};this.progress=function(a){c||f.forEach(function(b){if(b.progress)try{b.progress(a)}catch(c){}});return p.promise};this.cancel=function(){p._parentCancel?setTimeout(a,0):a();return p};this.then=function(a,b,k){var r=new d;r._parentCancel=p.promise.cancel;f.push({resolve:a,reject:b,progress:k,deferred:r});("fulfilled"===c||"rejected"===c)&&x(h);return r.promise};this.promise={then:p.then,cancel:p.cancel}}var l=[],m=!1,h=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var d=
process.nextTick;return function(){d(t)}}if("function"===typeof MutationObserver){var q=document.createElement("div");(new MutationObserver(t)).observe(q,{attributes:!0});return function(){q.setAttribute("class","_tick")}}return function(){setTimeout(t,0)}}();d.all=function(h,q){function b(a,b){f||(c[a]=b,0===--k&&p.resolve(c))}function a(a,c){if(!f){if(q)try{b(a,q(c));return}catch(k){c=k}p.reject(c)}}var k=h.length,c=[],f=!1,p=new d;p.then(void 0,function(){f=!0;h.forEach(function(a){a.cancel&&a.cancel()})});
0===k?p.resolve(c):h.forEach(function(c,g){c.then(b.bind(void 0,g),a.bind(void 0,g))});return p.promise};d.when=function(h,q,b,a){var k;h&&"function"===typeof h.then||(k=new d,k.resolve(h),h=k.promise);return h.then(q,b,a)};return d});
define("orion/webui/littlelib",["orion/util"],function(t){function x(a,b){b||(b=document);return b.querySelectorAll(a)}function v(a){var b=a.tabIndex;0===b&&t.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[a.nodeName.toLowerCase()]&&!a.attributes.tabIndex&&(b=-1);return b}function d(a){if(0<=v(a))return a;if(a.hasChildNodes())for(var b=0;b<a.childNodes.length;b++){var c=d(a.childNodes[b]);if(c)return c}return null}function l(a){if(0<=
v(a))return a;if(a.hasChildNodes())for(var b=a.childNodes.length-1;0<=b;b--){var c=l(a.childNodes[b]);if(c)return c}return null}function m(a,b){if(3===a.nodeType){var c=h.exec(a.nodeValue);c&&1<c.length&&b(a,c)}if(a.hasChildNodes())for(c=0;c<a.childNodes.length;c++)m(a.childNodes[c],b)}var h=/\$\{([^\}]+)\}/,s=null,q={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46},b=Object.create(null);Object.keys(q).forEach(function(a){b[q[a]]=
a});return{$:function(a,b){b||(b=document);return b.querySelector(a)},$$:x,$$array:function(a,b){return Array.prototype.slice.call(x(a,b))},node:function(a){var b=a;"string"===typeof a&&(b=document.getElementById(a));return b},contains:function(a,b){if(!a||!b)return!1;if(a===b)return!0;var c=a.compareDocumentPosition(b);return Boolean(c&16)},bounds:function(a){a=a.getBoundingClientRect();var b=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),c=Math.max(document.documentElement.scrollTop,
document.body.scrollTop);return{left:a.left+b,top:a.top+c,width:a.width,height:a.height}},empty:function(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)},firstTabbable:d,lastTabbable:l,stop:function(a){window.document.all&&(a.keyCode=0);a.preventDefault&&(a.preventDefault(),a.stopPropagation())},processTextNodes:function(a,b){m(a,function(a,f){a.parentNode.replaceChild(document.createTextNode(b[f[1]]||f[1]),a)})},processDOMNodes:function(a,b){m(a,function(a,f){var p=b[f[1]];if(p){var n=document.createRange(),
g=f.index;n.setStart(a,g);n.setEnd(a,g+f[0].length);n.deleteContents();n.insertNode(p)}})},addAutoDismiss:function(a,b){function c(a){s.forEach(function(b){var c=!1,g=b.excludeNodes.some(function(b){return document.body.contains(b)?(c=!0,b.contains(a.target)):!1});if(c&&!g)try{b.dismiss(a)}catch(k){"undefined"!==typeof console&&console&&console.error(k&&k.message)}});s=s.filter(function(a){return a.excludeNodes.some(function(a){return document.body.contains(a)})})}null===s&&(s=[],document.addEventListener("click",
c,!0),t.isIOS&&document.addEventListener("touchend",function(a){function b(){a.target.removeEventListener("click",b)}0===a.touches.length&&a.target.addEventListener("click",b)},!1));s.push({excludeNodes:a,dismiss:b})},setFramesEnabled:function(a){for(var b=document.getElementsByTagName("iframe"),c=0;c<b.length;c++)b[c].parentNode.style.pointerEvents=a?"":"none"},getOffsetParent:function(a){a=a.parentNode;for(var b=document.documentElement;a&&a!==b;){var c=window.getComputedStyle(a,null);if(!c)break;
c=c.getPropertyValue("overflow-y");if("auto"===c||"scroll"===c)break;a=a.parentNode}return a},removeAutoDismiss:function(a){s=s.filter(function(b){return a!==b.dismiss})},keyName:function(a){return b[a]||null},KEY:q,createNodes:function(a,b){var c=b,f=null;void 0===c&&(c=document.createElement("div"));c.innerHTML=a;return f=1<c.children.length?c.children:c.firstChild}}});
define("orion/editor/tooltip","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/projectionTextModel orion/Deferred orion/editor/util orion/webui/littlelib orion/util".split(" "),function(t,x,v,d,l,m,h){function s(d){this._view=d;d=d.getOptions("parent");this._create(d?d.ownerDocument:document)}s.getTooltip=function(d){d._tooltip||(d._tooltip=new s(d));return d._tooltip};s.prototype={_create:function(d){if(!this._tooltipDiv){var b=this._tooltipDiv=h.createElement(d,"div");b.tabIndex=
0;b.className="textviewTooltip";b.setAttribute("aria-live","assertive");b.setAttribute("aria-atomic","true");this._tooltipDiv.style.visibility="hidden";d.body.appendChild(b);var a=this;l.addEventListener(d,"mousedown",this._mouseDownHandler=function(k){a.isVisible()&&(l.contains(b,k.target||k.srcElement)||a._locked||a.hide())},!0);l.addEventListener(d,"mousemove",this._mouseMoveHandler=function(b){a.isVisible()&&(!a._locked&&!a._hasFocus())&&(a._isInRect(a._outerArea,b.clientX,b.clientY)||a.hide())},
!0);l.addEventListener(b,"focus",function(b){a._locked||a._tooltipDiv.classList.add("textViewTooltipOnFocus")},!1);l.addEventListener(b,"blur",function(b){a._tooltipDiv.classList.remove("textViewTooltipOnFocus")},!1);l.addEventListener(b,"mouseenter",function(b){a._locked||a._tooltipDiv.classList.add("textViewTooltipOnHover")},!1);l.addEventListener(b,"mouseleave",function(b){a._hasFocus()||a._tooltipDiv.classList.remove("textViewTooltipOnHover")},!1);l.addEventListener(b,"keydown",function(b){27===
b.keyCode&&(a._locked||a.hide())},!1);this._view.addEventListener("Destroy",function(){a.destroy()})}},destroy:function(){if(this._tooltipDiv){this.hide();var d=this._tooltipDiv.parentNode;d&&d.removeChild(this._tooltipDiv);d=this._tooltipDiv.ownerDocument;l.removeEventListener(d,"mousedown",this._mouseDownHandler,!0);l.removeEventListener(d,"mousemove",this._mouseMoveHandler,!0);this._tooltipDiv=null}},show:function(d,b,a){this._locked=b;this._giveFocus=a;this._processInfo(d.getTooltipInfo())},update:function(d){d&&
this._processInfo(d.getTooltipInfo(),!0)},onHover:function(d,b,a){d&&!this._isInRect(this._anchorArea,b,a)&&(!this._isInRect(this._tooltipArea,b,a)&&!this._locked&&!this._hasFocus())&&this._processInfo(d.getTooltipInfo())},hide:function(){this.isVisible()&&(this.hover&&this.hover.clearQuickFixes(),this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipDiv.removeChild(this._tooltipContents),this._tooltipContents=
null),this._tooltipDiv.classList.remove("textviewTooltipCodeProjection"),this._tooltipDiv.classList.remove("textviewTooltipOnHover"),this._tooltipDiv.classList.remove("textviewTooltipOnFocus"),this._tooltipDiv.style.visibility="hidden",this._tooltipDiv.style.left="",this._tooltipDiv.style.right="",this._tooltipDiv.style.top="",this._tooltipDiv.style.bottom="",this._tooltipDiv.style.width="auto",this._tooltipDiv.style.maxWidth="",this._tooltipDiv.style.height="auto",this._tooltipDiv.style.maxHeight=
"",this._tooltipDiv.style.overflowX="",this._tooltipDiv.style.overflowY="",this._outerArea=this._tooltipArea=this._anchorArea=this._locked=this._giveFocus=void 0,this._hoverPromises&&this._hoverPromises.forEach(function(d){d.resolved||d.cancel()}),this._tipRect=this._hoverPromises=void 0)},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},_processInfo:function(q,b){if(this._tooltipDiv){var a;b&&this._tooltipContents?(this._tooltipContents.innerHTML="",a=
this._tooltipContents):a=h.createElement(this._tooltipDiv.ownerDocument,"div");if(q){if(q.contents&&this._renderImmediateInfo(a,q.contents,q.context))return this._showContents(a,q,b),!0;if(this.hover&&q.context&&(this._hoverPromises=this.hover.computeHoverInfo(q.context))){var k=this;this._hoverPromises.slice(0).forEach(function(c){d.when(c,function(f){if(k._hoverPromises){var p=k._hoverPromises.indexOf(c);0<=p&&k._hoverPromises.splice(p,1)}f&&k._renderPluginContent(a,f)&&(f.offsetStart&&(q.context.offsetStart=
f.offsetStart),f.offsetEnd&&(q.context.offsetEnd=f.offsetEnd),f.allowFullWidth&&(q.allowFullWidth=f.allowFullWidth),k._showContents(a,q,b))},function(a){console&&(a&&"Cancel"!==a.name)&&(console.log("Error computing hover tooltip"),console.log(a&&a.stack))})});return!0}}}},_showContents:function(d,b,a){if(a){if(this._tooltipArea&&b.tooltipArea&&(this._tooltipArea.left!==b.tooltipArea.left||this._tooltipArea.top!==b.tooltipArea.top||this._tooltipArea.width!==b.tooltipArea.width||this._tooltipArea.height!==
b.tooltipArea.height))this._outerArea=this._tooltipArea=this._anchorArea=null}else this.hide();this._tooltipContents=d;this._tooltipDiv.appendChild(d);this._anchorArea||(this._anchorArea=this._computeAnchorArea(b));this._tooltipArea||(this._tooltipArea=this._computeTooltipArea(b,this._anchorArea,this._tooltipDiv));this._outerArea||(this._outerArea=this._computeOuterArea(this._anchorArea,this._tooltipArea));this._tooltipDiv.style.visibility="visible";this._giveFocus&&(this._setInitialFocus(this._tooltipDiv),
this._giveFocus=void 0)},_computeAnchorArea:function(d){if(d.anchorArea&&d.anchorArea.top&&d.anchorArea.left&&d.anchorArea.height&&d.anchorArea.width)return d.anchorArea;if(d.context){if(d.context.offsetStart&&d.context.offsetEnd)return this._computeRectangleFromOffset(d.context.offsetStart,d.context.offsetEnd);if(0<=d.context.offset){var b=this._view.getNextOffset(d.context.offset,{unit:"word",count:-1});d=this._view.getNextOffset(d.context.offset,{unit:"word",count:0});return this._computeRectangleFromOffset(b,
d)}}return{top:0,left:0,height:0,width:0}},_computeTooltipArea:function(d,b,a){var k=a.ownerDocument.documentElement;if(d.tooltipArea&&d.tooltipArea.top&&d.tooltipArea.left&&d.tooltipArea.height&&d.tooltipArea.width)return a.style.overflowY="auto",a.style.resize="none",a.style.top=d.tooltipArea.top+"px",a.style.left=d.tooltipArea.left+"px",a.style.height=d.tooltipArea.height-16+"px",a.style.width=d.tooltipArea.width-16+"px",d.tooltipArea;var c=a.getBoundingClientRect(),c={width:c.width,height:c.height},
f=d.position?d.position:"below",p=(this._view._rootDiv?this._view._rootDiv:k).getBoundingClientRect(),k=p.left,n=p.top,g=p.width,p=p.height,w=g;if(!d.allowFullWidth){var w=Math.min(g/2,600),r=Math.min(p/2,400);c.width=Math.min(c.width,w);c.height=Math.min(c.height,r)}41>c.height&&c.width>w-16&&(c.height=56);var w=p-(b.top+b.height-n),h=b.top-n,r=g-(b.left+b.width-k);"above"===f&&c.height>h&&c.height<=w?f="below":"below"===f&&(c.height>w&&c.height<=h)&&(f="above");h=d.tooltipOffsetX?d.tooltipOffsetX:
0;d=d.tooltipOffsetY?d.tooltipOffsetY:0;switch(f){case "left":c.top=c.height+d>w+b.height?p+n-c.height:b.top+d;c.top=Math.max(c.top,n);c.left=Math.max(b.left-c.width+h,k);break;case "right":c.top=c.height+d>w+b.height?p+n-c.height:b.top+d;c.top=Math.max(c.top,n);c.left=Math.max(b.left+b.width+h,k);break;case "above":c.left=c.width+h>r+b.width?g+k-c.width:b.left+h;c.left=Math.max(c.left,k);c.top=Math.max(b.top-c.height+d,n);break;case "below":c.left=c.width+h>r+b.width?g+k-c.width:b.left+h,c.left=
Math.max(c.left,k),c.top=Math.max(b.top+b.height+d,n)}c.maxWidth=Math.min(g+k-c.left,g);c.maxHeight=Math.min(p+n-c.top,p);a.style.maxWidth=c.maxWidth-16+"px";a.style.maxHeight=c.maxHeight-16+"px";a.style.width=c.width-16+"px";a.style.height=c.height-16+"px";a.style.left=c.left+"px";a.style.top=c.top+"px";return c},_computeOuterArea:function(d,b){var a=Math.min(d.left,b.left),k=Math.min(d.top,b.top),c=Math.max(d.left+d.width,b.left+b.width),f=Math.max(d.top+d.height,b.top+b.height);return{left:a,top:k,
width:c-a,height:f-k}},_hasFocus:function(){var d=this._tooltipDiv;return!d?!1:l.contains(d,d.ownerDocument.activeElement)},_isNode:function(d){return"object"===typeof Node?d instanceof Node:d&&"object"===typeof d&&"number"===typeof d.nodeType&&"string"===typeof d.nodeName},_setInitialFocus:function(d){var b=m.$("button",d);if(b)b.focus();else if(b=m.$("a",d)){b.focus();var a=this;b.addEventListener("click",function(){a.hide()})}else(d=m.firstTabbable(d))&&d.focus()},_isInRect:function(d,b,a){if(!d)return!1;
a=a>=d.top&&a<=d.top+d.height;return b>=d.left&&b<=d.left+d.width&&a},mapOffset:function(d,b){var a=this._view.getModel();a.getBaseModel&&(d=a.mapOffset(d,b));return d},_computeRectangleFromOffset:function(d,b){d=this.mapOffset(d);b=this.mapOffset(b);var a=this._view,k=a.getLineAtOffset(d),c=a.getLineAtOffset(b);k!==c&&(b=a.getModel().getLineEnd(k));k=a.getLineHeight(k);c=a.getLocationAtOffset(d);a=a.getLocationAtOffset(b);a={x:c.x,y:c.y,width:a.x-c.x,height:k};a=this._view.convert(a,"document","page");
return{left:a.x,top:a.y,width:a.width,height:a.height}},_renderPluginContent:function(d,b){var a=this._tooltipDiv.ownerDocument;if("string"!==typeof b&&"undefined"===typeof b.content)return!1;var k=h.createElement(a,"div");if(b.title){var c=h.createElement(a,"div");c.innerHTML=this.hover.renderMarkDown?this.hover.renderMarkDown(b.title):b.title;k.appendChild(c)}c=h.createElement(a,"div");if("string"===typeof b)c.appendChild(a.createTextNode(b));else switch(b.type){case "delegatedUI":case "html":b.content&&
(a=a.createElement("iframe"),a.id="HtmlHover",a.name="HTML Hover",a.type="text/html",a.sandbox="allow-scripts allow-same-origin allow-forms",a.style.border="none",a.style.width="100%",a.style.height="100%",this._tooltipDiv.style.paddingBottom="5px",a.srcdoc=b.content,b.width&&(a.style.width=b.width),b.height&&(a.style.height=b.height),k.style.height="100%",d.style.height="100%",k.appendChild(a));break;case "markdown":this.hover.renderMarkDown&&(c.innerHTML=this.hover.renderMarkDown(b.content));break;
default:c.appendChild(a.createTextNode(b.content))}k.appendChild(c);d.appendChild(k);return!0},_renderImmediateInfo:function(d,b,a){if(b instanceof Array&&(b=this._getAnnotationContents(b,a),!b))return!1;if("string"===typeof b)return d.innerHTML=b,!0;if(this._isNode(b))return d.appendChild(b),!0;if(b instanceof v.ProjectionTextModel){var k=this._view;a=k.getOptions();a.wrapMode=!1;a.parent=d;var c=a.themeClass;c?((c=c.replace("tooltipTheme",""))&&(c=" "+c),c="tooltipTheme"+c):c="tooltipTheme";a.themeClass=
c;a=this._contentsView=new x.TextView(a);a.addEventListener("LineStyle",function(a){k.onLineStyle(a)});a.setModel(b);this._tooltipDiv.appendChild(d);this._tooltipDiv.classList.add("textviewTooltipCodeProjection");b=a.computeSize();d.style.width=b.width+8+"px";d.style.height=b.height+8+"px";a.resize();this._tooltipDiv.removeChild(d);return!0}return!1},_getAnnotationContents:function(d,b){function a(a,c){var f=a.title,p=h.createElement(g,"div");p.className="tooltipRow";if(a.html){var e=h.createElement(g,
"div");e.className="tooltipImage";e.innerHTML=a.html;e.lastChild&&l.addEventListener(e.lastChild,"click",function(){var b=a.start,c=a.end;r.getBaseModel&&(b=r.mapOffset(b,!0),c=r.mapOffset(c,!0));w.setSelection(b,c,1/3,function(){k.hide()})},!1);p.appendChild(e)}f||(f=y.getLineStart(y.getLineAtOffset(a.start)),e=y.getLineEnd(y.getLineAtOffset(a.end),!0),f=y.getText(f,e));"function"===typeof f&&(f=a.title());"string"===typeof f&&(e=h.createElement(g,"span"),e.className="tooltipTitle",e.appendChild(g.createTextNode(f)),
f=e);p.appendChild(f);c&&k.hover.renderQuickFixes(a,p);b&&(b.offsetStart=a.start,b.offsetEnd=a.end);return p}var k=this,c=k.hover?!0:!1;c&&(b&&b.source&&0<=b.source.indexOf("ruler"))&&(c=!1);for(var f,p=[],n=0;n<d.length;n++)f=d[n],""!==f.title&&!f.groupAnnotation&&(!c||f.title)&&p.push(f);d=p;if(0===d.length)return null;var g=this._tooltipDiv.ownerDocument,w=this._view,r=w.getModel(),y=r.getBaseModel?r.getBaseModel():r;if(1===d.length&&"orion.annotation.folding"===d[0].type)return c=new v.ProjectionTextModel(y),
f=y.getLineStart(y.getLineAtOffset(d[0].start)),p=y.getCharCount(),d[0].end!==p&&c.addProjection({start:d[0].end,end:p}),0<f&&c.addProjection({start:0,end:f}),c;if(1===d.length){if((f=a(d[0],c))&&f.firstChild)(c=f.firstChild.className)&&(c+=" "),f.firstChild.className=c+"single";return f}p=h.createElement(g,"div");f=h.createElement(g,"em");f.appendChild(g.createTextNode(t.multipleAnnotations));p.appendChild(f);for(n=0;n<d.length;n++)(f=a(d[n],c))&&p.appendChild(f);return p}};return{Tooltip:s}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(t,x){function v(){}function d(a,b,c){this.start=a;this.end=b;this._projectionModel=c;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function l(a,b){var c=a.lastIndexOf("."),c=a.substring(c+1),f={title:t[c],style:{styleClass:"annotation "+c},html:"\x3cdiv class\x3d'annotationHTML "+c+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+c}};b?f.lineStyle=
{styleClass:"annotationLine "+c}:f.rangeStyle={styleClass:"annotationRange "+c};v.registerType(a,f)}function m(){}function h(a,b,c,f,p){var n;void 0===f&&(f=-1);void 0===p&&(p=a.length);for(;1<p-f;)if(n=Math.floor((p+f)/2),b<=a[n].start)p=n;else if(c&&b<a[n].end){p=n;break}else f=n;return p}function s(a){this._annotations=[];var b=this;this._listener={onChanged:function(a){b._onChanged(a)}};this.setTextModel(a)}function q(a,b){this._view=a;this._annotationModel=b;var c=this;this._listener={onDestroy:function(a){c._onDestroy(a)},
onLineStyle:function(a){c._onLineStyle(a)},onChanged:function(a){c._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",this._listener.onLineStyle);b.addEventListener("Changed",this._listener.onChanged)}d.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},
_collapse:function(){if(!this.expanded)return!1;this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_collapseImpl:function(a){if(this._collapse()){a&&this._forEachOverlaping(function(a){a.expanded||
(a._expandImpl(!1),a._recollapse=!0)});a=this._projectionModel;var b=a.getBaseModel();this._projection={annotation:this,start:b.getLineStart(b.getLineAtOffset(this.start)+1),end:b.getLineEnd(b.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},_expandImpl:function(a){this._expand()&&(this._projectionModel._removeProjection(this._projection,!this._annotationModel),a&&this._forEachOverlaping(function(a){a._recollapse&&(a._collapseImpl(!1),a._recollapse=!1)}))},_forEachOverlaping:function(a){if(this._annotationModel)for(var b=
this._annotationModel.getAnnotations(this.start,this.end);b.hasNext();){var c=b.next();c!==this&&c.type===v.ANNOTATION_FOLDING&&a.call(this,c)}},collapse:function(){this._recollapse=!1;this._collapseImpl(!0)},expand:function(){this._recollapse=!1;this._expandImpl(!0)}};v.ANNOTATION_ERROR="orion.annotation.error";v.ANNOTATION_WARNING="orion.annotation.warning";v.ANNOTATION_TASK="orion.annotation.task";v.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";v.ANNOTATION_BOOKMARK="orion.annotation.bookmark";
v.ANNOTATION_FOLDING="orion.annotation.folding";v.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";v.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";v.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";v.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";v.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";v.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";v.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";v.ANNOTATION_SELECTED_LINKED_GROUP=
"orion.annotation.selectedLinkedGroup";v.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";v.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";v.ANNOTATION_BLAME="orion.annotation.blame";v.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";v.ANNOTATION_DIFF_ADDED="orion.annotation.diffAdded";v.ANNOTATION_DIFF_DELETED="orion.annotation.diffDeleted";v.ANNOTATION_DIFF_MODIFIED="orion.annotation.diffModified";var b={};v.registerType=function(a,k){var c=k;"function"!==typeof c&&
(c=function(a,b,c){this.start=a;this.end=b;void 0!==c&&(this.title=c)},c.prototype=k);c.prototype.type=a;b[a]=c;return a};v.createAnnotation=function(a,b,c,f){return new (this.getType(a))(b,c,f)};v.getType=function(a){return b[a]};l(v.ANNOTATION_ERROR);l(v.ANNOTATION_WARNING);l(v.ANNOTATION_TASK);l(v.ANNOTATION_BREAKPOINT);l(v.ANNOTATION_BOOKMARK);l(v.ANNOTATION_CURRENT_BRACKET);l(v.ANNOTATION_MATCHING_BRACKET);l(v.ANNOTATION_CURRENT_SEARCH);l(v.ANNOTATION_MATCHING_SEARCH);l(v.ANNOTATION_READ_OCCURRENCE);
l(v.ANNOTATION_WRITE_OCCURRENCE);l(v.ANNOTATION_SELECTED_LINKED_GROUP);l(v.ANNOTATION_CURRENT_LINKED_GROUP);l(v.ANNOTATION_LINKED_GROUP);l(v.ANNOTATION_CURRENT_LINE,!0);l(v.ANNOTATION_BLAME,!0);l(v.ANNOTATION_CURRENT_BLAME,!0);l(v.ANNOTATION_DIFF_ADDED);l(v.ANNOTATION_DIFF_DELETED);l(v.ANNOTATION_DIFF_MODIFIED);v.registerType(v.ANNOTATION_FOLDING,d);m.addMixin=function(a){var b=m.prototype,c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};m.prototype={addAnnotationType:function(a,b){this._annotationTypes||
(this._annotationTypes=[]);var c=b-1;void 0==b||!(0<=c&&c<this._annotationTypes.length)?this._annotationTypes.push(a):this._annotationTypes.splice(c,0,a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===a)return b+1;return 0},getAnnotationsByType:function(a,b,c){a=a.getAnnotations(b,c);for(c=[];a.hasNext();)b=a.next(),0!==this.getAnnotationTypePriority(b.type)&&c.push(b);var f=this;c.sort(function(a,b){return f.getAnnotationTypePriority(a.type)-
f.getAnnotationTypePriority(b.type)});return c},isAnnotationTypeVisible:function(a){return 0!==this.getAnnotationTypePriority(a)},removeAnnotationType:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===a){this._annotationTypes.splice(b,1);break}}};s.prototype={addAnnotation:function(a){if(a){var b=this._annotations,c=h(b,a.start);b.splice(c,0,a);a._annotationModel=this;this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},
getTextModel:function(){return this._model},getAnnotations:function(a,b){var c=this._annotations,f,p=0,n;n=void 0===a&&void 0===b?function(){return p<c.length?c[p++]:null}:function(){for(;p<c.length;){var g=c[p++];if(a===g.start||(a>g.start?a<g.end:g.start<b))return g;if(g.start>=b)break}return null};f=n();return{next:function(){var a=f;a&&(f=n());return a},hasNext:function(){return null!==f}}},modifyAnnotation:function(a){if(a&&!(0>this._getAnnotationIndex(a)))this.onChanged({type:"Changed",added:[],
removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var b=this._annotations,c,f;if(a){c=[];for(f=b.length-1;0<=f;f--){var p=b[f];p.type===a&&(b.splice(f,1),c.splice(0,0,p),p._annotationModel=null)}}else c=b;this.onChanged({type:"Changed",removed:c,added:[],changed:[]})},removeAnnotation:function(a){if(a){var b=this._getAnnotationIndex(a);0>b||(a._annotationModel=null,a={type:"Changed",removed:this._annotations.splice(b,1),added:[],changed:[]},
this.onChanged(a))}},replaceAnnotations:function(a,b){var c=this._annotations,f,p,n,g=[];if(a)for(f=a.length-1;0<=f;f--)n=a[f],p=this._getAnnotationIndex(n),0>p||(n._annotationModel=null,c.splice(p,1),g.splice(0,0,n));b||(b=[]);for(f=0;f<b.length;f++)n=b[f],p=h(c,n.start),n._annotationModel=this,c.splice(p,0,n);this.onChanged({type:"Changed",removed:g,added:b,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",
this._listener.onChanged)},_getAnnotationIndex:function(a){for(var b=this._annotations,c=h(b,a.start);c<b.length&&b[c].start===a.start;){if(b[c]===a)return c;c++}return-1},_onChanged:function(a){var b=a.start,c=a.addedCharCount,f=a.removedCharCount,p=this._annotations,n=b+f;if(0<p.length){a={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:a};c-=f;for(f=0;f<p.length;f++){var g=p[f];g.start>=n?(g._oldStart=g.start,g._oldEnd=g.end,g.start+=c,g.end+=c,a.changed.push(g)):g.end<=b||
(g.start<b&&n<g.end?(g._oldStart=g.start,g._oldEnd=g.end,g.end+=c,a.changed.push(g)):(p.splice(f,1),a.removed.push(g),g._annotationModel=null,g.expand&&g.expand(),f--))}if(0<a.added.length||0<a.removed.length||0<a.changed.length)this.onChanged(a)}}};x.EventTarget.addMixin(s.prototype);q.prototype={destroy:function(){var a=this._view;a&&(a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);(a=this._annotationModel)&&
a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass=a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+(" "+b.styleClass):b.styleClass;var c;b.tagName&&!a.tagName&&(a.tagName=b.tagName);if(b.style)for(c in a.style||(a.style={}),b.style)a.style[c]||(a.style[c]=b.style[c]);if(b.attributes)for(c in a.attributes||(a.attributes={}),b.attributes)a.attributes[c]||(a.attributes[c]=b.attributes[c])}return a},_mergeStyleRanges:function(a,
b){a||(a=[]);for(var c,f=h(a,b.start,!0);f<a.length&&b;f++){var p=a[f];if(b.end<=p.start)break;if(!(b.start>=p.end)){c=this._mergeStyle({},p.style);c=this._mergeStyle(c,b.style);var n=[];n.push(f,1);b.start<p.start&&n.push({start:b.start,end:p.start,style:b.style});b.start>p.start&&n.push({start:p.start,end:b.start,style:p.style});n.push({start:Math.max(p.start,b.start),end:Math.min(p.end,b.end),style:c});b.end<p.end&&n.push({start:b.end,end:p.end,style:p.style});b=b.end>p.end?{start:p.end,end:b.end,
style:b.style}:null;Array.prototype.splice.apply(a,n)}}b&&(c=this._mergeStyle({},b.style),a.splice(f,0,{start:b.start,end:b.end,style:c}));return a},_onAnnotationModelChanged:function(a){function b(a,c){n.getBaseModel&&(a=n.mapOffset(a,!0),c=n.mapOffset(c,!0));-1!==a&&-1!==c&&f.redrawRange(a,c)}function c(a,c){for(var f=0;f<a.length;f++)if(p.isAnnotationTypeVisible(a[f].type)){var n=a[f];b(n.start,n.end);c&&(void 0!==n._oldStart&&n._oldEnd)&&b(n._oldStart,n._oldEnd)}}var f=this._view;if(f){var p=
this,n=f.getModel();c(a.added);c(a.removed);c(a.changed,!0)}},_onDestroy:function(a){this.destroy()},_onLineStyle:function(a){var b=this._annotationModel,c=a.textView.getModel(),f=b.getTextModel(),p=a.lineStart,n=a.lineStart+a.lineText.length;f!==c&&(p=c.mapOffset(p),n=c.mapOffset(n));for(b=b.getAnnotations(p,n);b.hasNext();)if(p=b.next(),this.isAnnotationTypeVisible(p.type)){if(p.rangeStyle){var n=p.start,g=p.end;f!==c&&(n=c.mapOffset(n,!0),g=c.mapOffset(g,!0));a.ranges=this._mergeStyleRanges(a.ranges,
{start:n,end:g,style:p.rangeStyle})}p.lineStyle&&(a.style=this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,p.lineStyle))}}};m.addMixin(q.prototype);return{FoldingAnnotation:d,AnnotationType:v,AnnotationTypeList:m,AnnotationModel:s,AnnotationStyler:q}});
define("orion/objects",[],function(){function t(t){for(var v=Object.prototype.hasOwnProperty,d=1,l=arguments.length;d<l;d++){var m=arguments[d],h;for(h in m)v.call(m,h)&&(t[h]=m[h])}return t}return{clone:function(x){if(Array.isArray(x))return Array.prototype.slice.call(x);var v=Object.create(Object.getPrototypeOf(x));t(v,x);return v},mixin:t,toArray:function(t){return Array.isArray(t)?t:[t]}}});
define("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(t,x,v,d,l,m){function h(b){b=b||{};this._domNode=b.domNode;this._model=b.model;this._undoStack=b.undoStack;this._statusReporter=b.statusReporter;this._title=null;var a=this;this._listener={onChanged:function(b){a.onChanged(b)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}
function s(b){b=b||{};h.call(this,b);this._textViewFactory=b.textViewFactory;this._undoStackFactory=b.undoStackFactory;this._textDNDFactory=b.textDNDFactory;this._annotationFactory=b.annotationFactory;this._zoomRulerFactory=b.zoomRulerFactory;this._foldingRulerFactory=b.foldingRulerFactory;this._lineNumberRulerFactory=b.lineNumberRulerFactory;this._contentAssistFactory=b.contentAssistFactory;this._keyBindingFactory=b.keyBindingFactory;this._hoverFactory=b.hoverFactory;this._contentAssist=this._foldingRuler=
this._zoomRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null}var q=d.AnnotationType;h.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(b,a){return this.getModel().getText(b,
a)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},install:function(){this.installed=!0},isDirty:function(){return this._undoStack?!this._undoStack.isClean():this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},onDirtyChanged:function(b){return this.dispatchEvent(b)},onInputChanged:function(b){return this.dispatchEvent(b)},onChanged:function(b){this.checkDirty()},reportStatus:function(b,a,k){this._statusReporter&&this._statusReporter(b,
a,k)},resize:function(){},setDirty:function(b){this._dirty!==b&&(this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"}))},_setModelText:function(b){this._model&&this._model.setText(b)},setInput:function(b,a,k,c){this._title=b;c||(a?this.reportStatus(a,"error"):null!==k&&void 0!==k&&("string"===typeof k&&this._setModelText(k),this._undoStack&&this._undoStack.reset()));this.checkDirty();this.onInputChanged({type:"InputChanged",title:b,message:a,contents:k,contentsSaved:c})},setText:function(b,a,k){this.getModel().setText(b,
a,k)},uninstall:function(){this.installed=!1}};x.EventTarget.addMixin(h.prototype);s.prototype=new h;l.mixin(s.prototype,{destroy:function(){h.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._hoverFactory=this._zoomRulerFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},
getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getTooltip:function(){return v.Tooltip.getTooltip(this._textView)},getZoomRuler:function(){return this._zoomRuler},getModel:function(){if(!this._textView)return null;var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},
getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(b,a){if(this._annotationRulerVisible!==b||a)if(this._annotationRulerVisible=b,
this._annotationRuler){var k=this._textView;b?k.addRuler(this._annotationRuler,0):k.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(b,a){if(this._foldingRulerVisible!==b||a)if(this._foldingRulerVisible=b,this._foldingRuler){var k=this._textView;k.getModel().getBaseModel&&(b?k.addRuler(this._foldingRuler):k.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(b,a){if(this._lineNumberRulerVisible!==b||a)if(this._lineNumberRulerVisible=b,this._lineNumberRuler){var k=
this._textView;b?k.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):k.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(b,a){if(this._overviewRulerVisible!==b||a)if(this._overviewRulerVisible=b,this._overviewRuler){var k=this._textView;b?k.addRuler(this._overviewRuler):k.removeRuler(this._overviewRuler)}},setZoomRulerVisible:function(b,a){if(this._zoomRulerVisible!==b||a)if(this._zoomRulerVisible=b,this._zoomRuler){var k=this._textView;b?k.addRuler(this._zoomRuler):
k.removeRuler(this._zoomRuler)}},mapOffset:function(b,a){var k=this._textView.getModel();k.getBaseModel&&(b=k.mapOffset(b,a));return b},getLineAtOffset:function(b){return this.getModel().getLineAtOffset(this.mapOffset(b))},getLineStart:function(b){return this.getModel().getLineStart(b)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var b=this._textView,a=b.getSelection(),b=b.getModel();b.getBaseModel&&(a.start=b.mapOffset(a.start),a.end=
b.mapOffset(a.end));return a},getSelections:function(){var b=this._textView,a=b.getModel(),b=b.getSelections();b.forEach(function(b){a.getBaseModel&&(b.start=a.mapOffset(b.start),b.end=a.mapOffset(b.end))});return b},_expandOffset:function(b){var a=this._textView.getModel(),k=this._annotationModel;if(k&&a.getBaseModel)for(b=k.getAnnotations(b,b+1);b.hasNext();)a=b.next(),a.type===q.ANNOTATION_FOLDING&&a.expand&&a.expand()},setCaretOffset:function(b,a,k){var c=this._textView,f=c.getModel();f.getBaseModel&&
(this._expandOffset(b),b=f.mapOffset(b,!0));c.setCaretOffset(b,a,k)},setText:function(b,a,k,c,f){var p=this._textView,n=p.getModel();n.getBaseModel&&(void 0!==a&&(this._expandOffset(a),a=n.mapOffset(a,!0)),void 0!==k&&(this._expandOffset(k),k=n.mapOffset(k,!0)));p.setText(b,a,k,c,f)},setSelection:function(b,a,k,c){var f=this._textView,p=f.getModel();p.getBaseModel&&(this._expandOffset(b),this._expandOffset(a),b=p.mapOffset(b,!0),a=p.mapOffset(a,!0));f.setSelection(b,a,k,c)},setSelections:function(b,
a,k){var c=this,f=this._textView,p=f.getModel();b.forEach(function(a){var b=a.start,f=a.end;p.getBaseModel&&(c._expandOffset(b),c._expandOffset(f),b=p.mapOffset(b,!0),f=p.mapOffset(f,!0));a.start=b;a.end=f});f.setSelections(b,a,k)},moveSelection:function(b,a,k,c){var f=this._textView;this.setSelection(b,a||b,1/3,function(){(void 0===c||c)&&f.focus();k&&k()})},_getTooltipInfo:function(b,a){var k=this._textView,c=this.getAnnotationModel();if(!c)return null;var f=this._annotationStyler;if(!f||!k.isValidTextPosition(b,
a))return null;k=k.getOffsetAtLocation(b,a);if(-1===k)return null;for(var k=this.mapOffset(k),c=f.getAnnotationsByType(c,k,k+1),f=[],p=0;p<c.length;p++)c[p].rangeStyle&&f.push(c[p]);return{contents:f,position:"below",context:{source:"editor",offset:k}}},_highlightCurrentLine:function(b,a){function k(a){var b={};return a&&a.some(function(a){if(a&&a.isEmpty())b[n.getLineAtOffset(a.start).toString()]=!0;else return!0;return!1})?{}:b}function c(a,b){for(var c in a)if(!b[c])return!0;return!1}var f=this._annotationModel;
if(f){var p=this._textView;if(!p.getOptions("singleMode")){a=Array.isArray(a)?a:[a];b=Array.isArray(b)?b:[b];var n=p.getModel(),p=k(a),g=k(b);if(c(p,g)||c(g,p)){var p=this._currentLineAnnotations,d=[],r;for(r in g){var h=r>>0,g=n.getLineStart(h),h=n.getLineEnd(h);n.getBaseModel&&(g=n.mapOffset(g),h=n.mapOffset(h));g=q.createAnnotation(q.ANNOTATION_CURRENT_LINE,g,h);d.push(g)}this._currentLineAnnotations=d;f.replaceAnnotations(p,d)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=
this._textViewFactory();this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this._textView.setOptions({undoStack:this._undoStack}),this.checkDirty());this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());var b=v.Tooltip.getTooltip(this._textView);this._hoverFactory&&(this._hover=this._hoverFactory.createHover(this),
b.hover=this._hover);var a=this,k=this._textView,c=this;this._listener={onModelChanged:function(a){c.checkDirty()},onMouseOver:function(a){c._listener.onMouseMove(a)},onMouseDown:function(a){c._listener.mouseDown=!0},onMouseUp:function(a){c._listener.mouseDown=!1},onMouseMove:function(a){b&&!c._listener.mouseDown&&!(a.event.clientX===c._listener.lastMouseX&&a.event.clientY===c._listener.lastMouseY)&&(c._listener.lastMouseX=a.event.clientX,c._listener.lastMouseY=a.event.clientY,c._hoverTimeout&&(window.clearTimeout(c._hoverTimeout),
c._hoverTimeout=null),c._hoverTimeout=window.setTimeout(function(){c._hoverTimeout=null;if(c._listener)b.onHover({y:a.y,x:a.x,getTooltipInfo:function(){return c._getTooltipInfo(this.x,this.y)}},a.x,a.y)},175))},onMouseOut:function(a){c._hoverTimeout&&(window.clearTimeout(c._hoverTimeout),c._hoverTimeout=null)},onScroll:function(a){b&&b.hide()},onSelection:function(a){b&&b.hide();c._updateCursorStatus();c._highlightCurrentLine(a.newValue,a.oldValue)}};k.addEventListener("ModelChanged",this._listener.onModelChanged);
k.addEventListener("Selection",this._listener.onSelection);k.addEventListener("MouseOver",this._listener.onMouseOver);k.addEventListener("MouseOut",this._listener.onMouseOut);k.addEventListener("MouseDown",this._listener.onMouseDown);k.addEventListener("MouseUp",this._listener.onMouseUp);k.addEventListener("MouseMove",this._listener.onMouseMove);k.addEventListener("Scroll",this._listener.onScroll);if(this._keyBindingFactory){var f;if(f="function"===typeof this._keyBindingFactory?this._keyBindingFactory(this,
this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(a,this._undoStack,this._contentAssist))this._textActions=f.textActions,this._linkedMode=f.linkedMode,this._sourceCodeActions=f.sourceCodeActions}f=function(b,c){if(void 0!==b&&-1!==b){for(var f=this.getView().getModel(),p=this.getAnnotationModel(),n=a.mapOffset(f.getLineStart(b)),f=a.mapOffset(f.getLineEnd(b)),k=p.getAnnotations(n,f),d=null;k.hasNext();){var h=k.next();if(h.type===q.ANNOTATION_BOOKMARK){d=
h;break}}d?p.removeAnnotation(d):(d=q.createAnnotation(q.ANNOTATION_BOOKMARK,n,f,a.getText(n,f)),p.addAnnotation(d))}};if(this._annotationFactory){var p=k.getModel();p.getBaseModel&&(p=p.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(p))if(p=this._annotationStyler=this._annotationFactory.createAnnotationStyler(k,this._annotationModel))p.addAnnotationType(q.ANNOTATION_CURRENT_SEARCH),p.addAnnotationType(q.ANNOTATION_MATCHING_SEARCH),p.addAnnotationType(q.ANNOTATION_ERROR),
p.addAnnotationType(q.ANNOTATION_WARNING),p.addAnnotationType(q.ANNOTATION_MATCHING_BRACKET),p.addAnnotationType(q.ANNOTATION_CURRENT_BRACKET),p.addAnnotationType(q.ANNOTATION_CURRENT_LINE),p.addAnnotationType(q.ANNOTATION_READ_OCCURRENCE),p.addAnnotationType(q.ANNOTATION_WRITE_OCCURRENCE),p.addAnnotationType(q.ANNOTATION_SELECTED_LINKED_GROUP),p.addAnnotationType(q.ANNOTATION_CURRENT_LINKED_GROUP),p.addAnnotationType(q.ANNOTATION_LINKED_GROUP),p.addAnnotationType("orion.annotation.highlightError");
var p=this._annotationFactory.createAnnotationRulers(this._annotationModel),n=this._annotationRuler=p.annotationRuler;n&&(n.onDblClick=f,n.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),n.addAnnotationType(q.ANNOTATION_ERROR),n.addAnnotationType(q.ANNOTATION_WARNING),n.addAnnotationType(q.ANNOTATION_TASK),n.addAnnotationType(q.ANNOTATION_BOOKMARK),n.addAnnotationType(q.ANNOTATION_DIFF_ADDED),n.addAnnotationType(q.ANNOTATION_DIFF_DELETED),n.addAnnotationType(q.ANNOTATION_DIFF_MODIFIED));
this.setAnnotationRulerVisible(this._annotationRulerVisible||void 0===this._annotationRulerVisible,!0);if(n=this._overviewRuler=p.overviewRuler)n.addAnnotationType(q.ANNOTATION_CURRENT_SEARCH),n.addAnnotationType(q.ANNOTATION_MATCHING_SEARCH),n.addAnnotationType(q.ANNOTATION_READ_OCCURRENCE),n.addAnnotationType(q.ANNOTATION_WRITE_OCCURRENCE),n.addAnnotationType(q.ANNOTATION_CURRENT_BLAME),n.addAnnotationType(q.ANNOTATION_ERROR),n.addAnnotationType(q.ANNOTATION_WARNING),n.addAnnotationType(q.ANNOTATION_TASK),
n.addAnnotationType(q.ANNOTATION_BOOKMARK),n.addAnnotationType(q.ANNOTATION_MATCHING_BRACKET),n.addAnnotationType(q.ANNOTATION_CURRENT_BRACKET),n.addAnnotationType(q.ANNOTATION_CURRENT_LINE),n.addAnnotationType(q.ANNOTATION_DIFF_ADDED),n.addAnnotationType(q.ANNOTATION_DIFF_DELETED),n.addAnnotationType(q.ANNOTATION_DIFF_MODIFIED);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._zoomRulerFactory&&(this._zoomRuler=this._zoomRulerFactory.createZoomRuler(this._annotationModel),
this.setZoomRulerVisible(this._zoomRulerVisible,!0));this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(q.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(q.ANNOTATION_BLAME),this._lineNumberRuler.addAnnotationType(q.ANNOTATION_DIFF_ADDED),this._lineNumberRuler.addAnnotationType(q.ANNOTATION_DIFF_MODIFIED),this._lineNumberRuler.addAnnotationType(q.ANNOTATION_DIFF_DELETED),
this._lineNumberRuler.onDblClick=f,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(q.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",textView:k});h.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},
uninstall:function(){var b=this._textView;b&&(b.destroy(),this._annotationModel&&this._annotationModel.setTextModel(null),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._zoomRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotations=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._zoomRulerVisible=this._lineNumberRulerVisible=
this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:b}),h.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var b=this.getKeyModes(),a=0;a<b.length;a++){var k=b[a];if(k.isActive()&&k.isStatusActive&&k.isStatusActive())return}b=this.getModel();a=this.getSelections();1<a.length?b=m.formatMessage(t.multiSelections,a.length):(a=a[0].getCaret(),k=b.getLineAtOffset(a),b=b.getLineStart(k),b=m.formatMessage(t.lineColumn,k+1,a-b+1));this.reportStatus(b)},
showAnnotations:function(b,a,k,c){var f=this._annotationModel;if(f){for(var p=[],n=[],g=f.getTextModel(),d=f.getAnnotations(),r;d.hasNext();)r=d.next(),-1!==a.indexOf(r.type)&&r.creatorID===this&&p.push(r);if(b)for(a=0;a<b.length;a++)if(r=b[a]){if(k)r=k(r);else{var h;r.lineStart&&r.lineEnd?(d=g.getLineStart(r.lineStart),h=g.getLineCount()===r.lineEnd?g.getLineEnd(r.lineEnd-1):g.getLineStart(r.lineEnd)):"number"===typeof r.line?(h=g.getLineStart(r.line-1),d=h+r.start-1,h=h+r.end-1):(d=r.start,h=r.end);
var l=c(r);if(!l)continue;r=q.createAnnotation(l,d,h,r.description)}r.id=b[a].id;b[a].data&&(r.data=b[a].data);r.creatorID=this;n.push(r)}f.replaceAnnotations(p,n)}},showProblems:function(b){this.showAnnotations(b,[q.ANNOTATION_ERROR,q.ANNOTATION_WARNING,q.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return q.ANNOTATION_ERROR;case "warning":return q.ANNOTATION_WARNING;case "task":return q.ANNOTATION_TASK}return null})},showOccurrences:function(b){this.showAnnotations(b,[q.ANNOTATION_READ_OCCURRENCE,
q.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?q.ANNOTATION_READ_OCCURRENCE:q.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(b){var a=this._blameRGB,k=this.getTextView().getOptions("parent").ownerDocument;if(!a){var c=m.createElement(k,"div");c.className="annotation blame";k.body.appendChild(c);var f=(k.defaultView||k.parentWindow).getComputedStyle(c).getPropertyValue("background-color");c.parentNode.removeChild(c);var c=f.indexOf("("),p=f.indexOf(")"),f=f.substring(c+1,p);
this._blameRGB=a=f.split(",").slice(0,3)}var n=function(){var a=d.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=l.mixin({},a.style);a.style.style=l.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},g=function(){var a=m.createElement(k,"div");a.className="tooltipTitle";var b=this.blame.Message.indexOf("\n");-1===b&&(b=this.blame.Message.length);var c=m.createElement(k,
"a");c.href=this.blame.CommitLink;c.appendChild(k.createTextNode(this.blame.Message.substring(0,b)));a.appendChild(c);a.appendChild(m.createElement(k,"br"));a.appendChild(k.createTextNode(m.formatMessage(t.committerOnTime,this.blame.AuthorName,this.blame.Time)));return a},w=this.getModel();this.showAnnotations(b,[q.ANNOTATION_BLAME,q.ANNOTATION_CURRENT_BLAME],function(b){var c=w.getLineStart(b.Start-1),f=w.getLineEnd(b.End-1,!0),c=d.AnnotationType.createAnnotation(q.ANNOTATION_BLAME,c,f,g),f=a.slice(0);
f.push(b.Shade);c.style=l.mixin({},c.style);c.style.style=l.mixin({},c.style.style);c.style.style.backgroundColor="rgba("+f.join()+")";c.groupId=b.Name;c.groupType=q.ANNOTATION_CURRENT_BLAME;c.createGroupAnnotation=n;c.html='\x3cimg class\x3d"annotationHTML blame" src\x3d"'+b.AuthorImage+'"/\x3e';c.blame=b;return c})},showDiffAnnotations:function(b){this.showAnnotations(b,[q.ANNOTATION_DIFF_ADDED,q.ANNOTATION_DIFF_MODIFIED,q.ANNOTATION_DIFF_DELETED],null,function(a){return"added"===a.type?q.ANNOTATION_DIFF_ADDED:
"modified"===a.type?q.ANNOTATION_DIFF_MODIFIED:q.ANNOTATION_DIFF_DELETED})},showSelection:function(b,a,k,c,f){return"number"===typeof b?("number"!==typeof a&&(a=b),this.moveSelection(b,a),!0):"number"===typeof k?(b=this.getModel().getLineStart(k-1),"number"===typeof c&&(b+=c),"number"!==typeof f&&(f=0),this.moveSelection(b,b+f),!0):!1},_setModelText:function(b){this._textView&&(this._textView.setText(b),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelections()))},
setInput:function(b,a,k,c,f){h.prototype.setInput.call(this,b,a,k,c);this._textView&&(!c&&!f)&&this._textView.focus()},onGotoLine:function(b,a,k,c){if(this._textView){var f=this.getModel();b=Math.max(0,Math.min(b,f.getLineCount()-1));var p=f.getLineStart(b),n=0;void 0===k&&(k=0);"string"===typeof a?(b=f.getLine(b).indexOf(a),-1!==b&&(n=b,k=n+a.length)):(n=a,a=f.getLineEnd(b)-p,n=Math.min(n,a),k=Math.min(k,a));this.moveSelection(p+n,p+k,c)}}});return{BaseEditor:h,Editor:s}});
define("orion/editor/find","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(t,x,v,d,l,m,h){function s(a){var b=a.getTextView();v.KeyMode.call(this,b);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";b.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));b.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var c=this;this._listener={onVerify:function(a){var b=c.editor,n=b.getModel(),g=b.mapOffset(a.start),b=b.mapOffset(a.end),n=n.getText(g,b);if((n=c._prefix.match(RegExp("^"+l.escape(n),"i")))&&0<n.length)c._prefix+=a.text,c._success=!0,c._status(),c.find(c._forward,!0),a.text=null},onSelection:function(){c._ignoreSelection||c.setActive(!1)}}}function q(a,b,c){if(a){this._editor=a;this._undoStack=b;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var f=this;this._listeners={onEditorFocus:function(a){f._removeCurrentAnnotation(a)}};this.setOptions(c)}}var b={};s.prototype=new v.KeyMode;m.mixin(s.prototype,{createKeyBindings:function(){var a=x.KeyBinding,b=[];b.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});b.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});b.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});b.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});b.push({actionID:"incrementalFind",keyBinding:new a(40)});b.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});b.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return b},find:function(a,b){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var c=this._prefix;if(0===c.length)return!1;var f=this.editor,p=f.getModel(),p=a?this._success?b?this._start:f.getCaretOffset()+
1:0:this._success?b?this._start:f.getCaretOffset():p.getCharCount()-1;(c=f.getModel().find({string:c,start:p,reverse:!a,caseInsensitive:c.toLowerCase()===c}).next())?(b||(this._start=p),this._ignoreSelection=this._success=!0,f.moveSelection(a?c.start:c.end,a?c.end:c.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){this._active!==a&&(this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status())},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return 0===a.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?t.incrementalFindStr:t.incrementalFindStrNotFound:this._success?t.incrementalFindReverseStr:t.incrementalFindReverseStrNotFound;a=h.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
b.IncrementalFind=s;q.prototype={find:function(a,b,c){this.setOptions({reverse:!a});var f=this.getFindString(),p;b&&(f=b.findString||f,p=b.count);a=this.getOptions();this.setOptions(b);b=c?this._startOffset:this.getStartOffset();if((p=this._doFind(f,b,p))&&!c)this._startOffset=p.start;this.setOptions(a);this._hideAfterFind&&this.hide();return p},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=l.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var b=a;if(this._regex){for(var b="",c=!1,f=this._editor.getModel().getLineDelimiter(),p=0;p<a.length;p++){var n=a.substring(p,p+1);if(c){switch(n){case "R":b+=f;break;case "r":b+=
"\r";break;case "n":b+="\n";break;case "t":b+="\t";break;case "\\":b+="\\";break;default:b+="\\"+n}c=!1}else"\\"===n?c=!0:b+=n}c&&(b+="\\")}return b},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var b=this._editor,c=this._processReplaceString(this.getReplaceString()),f=b.getSelection().start;if(b=b.getModel().find({string:a,start:f,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(b.start,b.end,a,c),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var b=this._editor,c=b.getTextView();b.reportStatus(t.replacingAll);var f=this._processReplaceString(this.getReplaceString()),p=this;window.setTimeout(function(){for(var n=0,g=0;;){var d=p._doFind(a,n,null,!0);if(!d)break;g++;1===g&&(c.setRedraw(!1),p.startUndo());p._doReplace(d.start,d.end,a,f);n=p.getStartOffset()}0<
g&&(p.endUndo(),c.setRedraw(!0));0<n?b.reportStatus(h.formatMessage(t.replacedMatches,g)):b.reportStatus(t.nothingReplaced,"error");p._replacingAll=!1},100)}},setOptions:function(a){if(a){if((!0===a.showAll||!1===a.showAll)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var b=this._editor.getAnnotationModel();b&&b.removeAnnotations(d.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===a.caseInsensitive||!1===a.caseInsensitive)this._caseInsensitive=
a.caseInsensitive;if(!0===a.wrap||!1===a.wrap)this._wrap=a.wrap;if(!0===a.wholeWord||!1===a.wholeWord)this._wholeWord=a.wholeWord;if(!0===a.incremental||!1===a.incremental)this._incremental=a.incremental;if(!0===a.regex||!1===a.regex)this._regex=a.regex;if(!0===a.findAfterReplace||!1===a.findAfterReplace)this._findAfterReplace=a.findAfterReplace;if(!0===a.hideAfterFind||!1===a.hideAfterFind)this._hideAfterFind=a.hideAfterFind;if(!0===a.reverse||!1===a.reverse)this._reverse=a.reverse;a.hasOwnProperty("findCallback")&&
(this._findCallback=a.findCallback);a.hasOwnProperty("start")&&(this._start=a.start);a.hasOwnProperty("end")&&(this._end=a.end)}},show:function(a){this._visible=!0;a&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(a));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var b=this;window.setTimeout(function(){b._incremental&&b.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,b,c){return this._editor.getModel().find({string:a,start:b,end:this._end,reverse:this._reverse,wrap:c?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,b,c,f){c=c||1;var p=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var n,g;if(this._regex)try{g=this._find(a,b,f)}catch(w){p.reportStatus(w.message,
"error");return}else g=this._find(a,b,f);for(a=0;a<c&&g.hasNext();a++)n=g.next();if(!this._replacingAll){n?this._editor.reportStatus(""):this._editor.reportStatus(t.notFound,"error");if(this.isVisible()){c=d.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(g=p.getAnnotationModel())g.removeAnnotations(c),n&&g.addAnnotation(d.AnnotationType.createAnnotation(c,n.start,n.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var r=this;this._timer=window.setTimeout(function(){r._markAllOccurrences();
r._timer=null},500)}}this._findCallback?this._findCallback(n):n&&p.moveSelection(n.start,n.end,null,!1)}return n},_doReplace:function(a,b,c,f){var p=this._editor;this._regex&&(f=p.getText(a,b).replace(RegExp(c,this._caseInsensitive?"i":""),f));p.setText(f,a,b);p.setSelection(a,a+f.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var b=d.AnnotationType.ANNOTATION_MATCHING_SEARCH,c=a.getAnnotations(),f=[],p;c.hasNext();){var n=c.next();n.type===b&&f.push(n)}if(this.isVisible()){c=
this.getFindString();c=this._editor.getModel().find({string:c,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(p=[];c.hasNext();)n=c.next(),p.push(d.AnnotationType.createAnnotation(b,n.start,n.end))}a.replaceAnnotations(f,p)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(d.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(d.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(a){(a=
this._editor.getAnnotationModel())&&a.removeAnnotations(d.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};b.Find=q;return b});
define("orion/editor/findUI",["i18n!orion/editor/nls/messages","orion/editor/find","orion/objects","orion/editor/util","orion/util"],function(t,x,v,d,l){function m(d,l,q){x.Find.call(this,d,l,q)}m.prototype=new x.Find;v.mixin(m.prototype,{getFindString:function(){var d=this._findInput;return!d?x.Find.prototype.getFindString.call(this):d.value},getReplaceString:function(){var d=this._replaceInput;return!d?x.Find.prototype.getReplaceString(this):d.value},hide:function(){var d=this.isVisible();x.Find.prototype.hide.call(this);
d&&(this._rootDiv.className="textViewFind")},show:function(d){x.Find.prototype.show.call(this,d);var l=d.findString;d=d.replaceString;var q=this._findInput;q||(this._create(),q=this._findInput);l&&(q.value=l);d&&(this._replaceInput.value=d);var b=this;window.setTimeout(function(){b._rootDiv.className="textViewFind show";q.select();q.focus()},0)},_create:function(){var h=this,m=this._editor.getTextView(),q=m.getOptions("parent").ownerDocument,b=l.createElement(q,"div");b.className="textViewFind";d.addEventListener(b,
"keydown",function(a){h._handleKeyDown(a)});this._rootDiv=b;this._createContents(q,b);m._rootDiv.insertBefore(b,m._rootDiv.firstChild)},_createContents:function(h,m){var q=this,b=l.createElement(h,"input");b.className="textViewFindInput";this._findInput=b;b.type="text";b.placeholder=t.findWith;d.addEventListener(b,"input",function(a){return q._handleInput(a)});m.appendChild(b);b=l.createElement(h,"span");q._createButton(h,b,t.next,function(){q.find(!0)});q._createButton(h,b,t.previous,function(){q.find(!1)});
m.appendChild(b);q._editor.getTextView().getOptions("readonly")||(b=l.createElement(h,"input"),b.className="textViewReplaceInput",this._replaceInput=b,b.type="text",b.placeholder=t.replaceWith,m.appendChild(b),b=l.createElement(h,"span"),q._createButton(h,b,t.replace,function(){q.replace()}),q._createButton(h,b,t.replaceAll,function(){q.replaceAll()}),m.appendChild(b));b=l.createElement(h,"span");q._createButton(h,b,t.regex,function(a){q._toggle("regex",a.target)},this._regex,t.regexTooltip);q._createButton(h,
b,t.caseInsensitive,function(a){q._toggle("caseInsensitive",a.target)},this._caseInsensitive,t.caseInsensitiveTooltip);q._createButton(h,b,t.wholeWord,function(a){q._toggle("wholeWord",a.target)},this._wholeWord,t.wholeWordTooltip);m.appendChild(b);b=q._createButton(h,m,"",function(){q.hide()});b.className="textViewFindCloseButton";b.title=t.closeTooltip},_createButton:function(h,l,q,b,a,k){var c=h.createElement("button");this._checked(a,c);k&&(c.title=k);d.addEventListener(c,"click",function(a){b.call(this,
a)},!1);q&&c.appendChild(h.createTextNode(q));l.appendChild(c);return c},_toggle:function(d,l){var q={};q[d]=!this["_"+d];this.setOptions(q);this._checked(q[d],l)},_checked:function(d,l){l.className="textViewFindButton";d&&(l.className+=" checked")},_handleInput:function(){this._incremental&&this.find(!0,null,!0);return!0},_handleKeyDown:function(d){var m,q=(l.isMac?d.metaKey:d.ctrlKey)&&!d.altKey&&!d.shiftKey;q&&70===d.keyCode&&(m=!0);if((l.isMac?d.metaKey:d.ctrlKey)&&!d.altKey&&75===d.keyCode||
13===d.keyCode)13===d.keyCode?this.find(this._reverse?d.shiftKey:!d.shiftKey):this.find(!d.shiftKey),m=!0;q&&82===d.keyCode&&(this.replace(),m=!0);27===d.keyCode&&(this.hide(),m=!0);return m?(d.stopPropagation&&d.stopPropagation(),d.preventDefault&&d.preventDefault(),d.cancelBubble=!0,!1):!0}});return{FindUI:m}});
define("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/editor/findUI orion/util".split(" "),function(t,x,v,d,l,m,h){function s(a,b,d,n){function g(a,b,c){r.setText(a,b,c);k+=b-c+a.length}var k=0,r=a.editor,h=r.getSelections();!n&&(b||1<h.length)&&a.startUndo();h.forEach(function(a){a.start+=k;a.end+=k;d(a,g)});r.setSelections(h);!n&&(b||1<h.length)&&a.endUndo()}function q(a,b,d){this.editor=a;this.undoStack=
b;this._incrementalFind=new l.IncrementalFind(a);this._find=d?d:new m.FindUI(a,b);this._lastEditLocation=null;this.init()}function b(a,b,d,n){this.editor=a;this.undoStack=b;this.contentAssist=d;this.linkedMode=n;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this));this.init()}var a=v.AnnotationType,k={};q.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&
(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.undo(),--b;return!0}return!1}.bind(this),{name:t.undo});a.setAction("redo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.redo(),--b;return!0}return!1}.bind(this),{name:t.redo});a.setKeyBinding(new x.KeyBinding("f",!0),
"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();this._find.show({findString:this.editor.getText(a.start,a.end)});return!0}return!1}.bind(this),{name:t.find});a.setKeyBinding(new x.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?(this._find.find(!0,a),!0):!1}.bind(this),{name:t.findNext});a.setKeyBinding(new x.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),
!0):!1}.bind(this),{name:t.findPrevious});a.setKeyBinding(new x.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:t.incrementalFind});a.setKeyBinding(new x.KeyBinding("j",!0,!0),"incrementalFindReverse");a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:t.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));
a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:t.unindentLines});a.setKeyBinding(new x.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:t.moveLinesUp});a.setKeyBinding(new x.KeyBinding(40,!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:t.moveLinesDown});a.setKeyBinding(new x.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",
function(){return this.copyLinesUp()}.bind(this),{name:t.copyLinesUp});a.setKeyBinding(new x.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:t.copyLinesDown});a.setKeyBinding(new x.KeyBinding("d",!0,!1,!1),"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:t.deleteLines});a.setKeyBinding(new x.KeyBinding("l",!h.isMac,!1,!1,h.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),
{name:t.gotoLine});a.setKeyBinding(new x.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:t.nextAnnotation});a.setKeyBinding(new x.KeyBinding(188,!0),"previousAnnotation");a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:t.prevAnnotation});a.setKeyBinding(new x.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:t.expand});
a.setKeyBinding(new x.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:t.collapse});a.setKeyBinding(new x.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",function(){return this.expandAnnotations(!0)}.bind(this),{name:t.expandAll});a.setKeyBinding(new x.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:t.collapseAll});a.setKeyBinding(new x.KeyBinding("q",
!h.isMac,!1,!1,h.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:t.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();s(this,!1,function(a,c){var g=b.getLineAtOffset(a.start),d=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),k=b.getLineStart(g),g=b.getLineEnd(d,!0),h=b.getLineCount(),l="",k=b.getText(k,g);d===h-1&&(k=(l=b.getLineDelimiter())+k);c(k,g,g);a.start=g+l.length;a.end=
g+k.length});return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();s(this,!1,function(a,c){var g=b.getLineAtOffset(a.start),d=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),g=b.getLineStart(g),k=b.getLineEnd(d,!0),h=b.getLineCount(),l="",k=b.getText(g,k);d===h-1&&(k+=l=b.getLineDelimiter());c(k,g,g);a.start=g;a.end=g+k.length-l.length});return!0},deleteLines:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;
var d=1;a&&a.count&&(d=a.count);var n=b.getModel();s(this,!1,function(a,b){var c=n.getLineAtOffset(a.start),f=n.getLineStart(c),c=a.start!==a.end||1===d?n.getLineAtOffset(a.end>a.start?a.end-1:a.end):Math.min(c+d-1,n.getLineCount()-1),c=n.getLineEnd(c,!0);b("",f,c);a.start=a.end=f});return!0},expandAnnotation:function(a){var b=this.editor,d=b.getAnnotationModel();if(!d)return!0;var n=b.getModel(),g=b.getCaretOffset(),k=n.getLineAtOffset(g),g=n.getLineStart(k),k=n.getLineEnd(k,!0);n.getBaseModel&&
(g=n.mapOffset(g),k=n.mapOffset(k),n.getBaseModel());for(var r,d=d.getAnnotations(g,k);!r&&d.hasNext();)n=d.next(),n.type===v.AnnotationType.ANNOTATION_FOLDING&&(r=n);r&&a!==r.expanded&&(a?r.expand():(b.setCaretOffset(r.start),r.collapse()));return!0},expandAnnotations:function(a){var b=this.editor,d=b.getTextView(),b=b.getAnnotationModel();if(!b)return!0;var n=b.getAnnotations();for(d.setRedraw(!1);n.hasNext();)b=n.next(),b.type===v.AnnotationType.ANNOTATION_FOLDING&&a!==b.expanded&&(a?b.expand():
b.collapse());d.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var d=a.getModel(),n=0,g=a.getSelections();1<g.length&&this.startUndo();if(g.some(function(k){k.start+=n;k.end+=n;var r=d.getLineAtOffset(k.start),h=d.getLineAtOffset(k.end>k.start?k.end-1:k.end);if(r!==h||1<g.length){var l=[];l.push("");for(var q=r;q<=h;q++)l.push(d.getLine(q,!0));var q=d.getLineStart(r),m=d.getLineEnd(h,!0),s=b.getOptions("tabSize",
"expandTab"),s=s.expandTab?Array(s.tabSize+1).join(" "):"\t",l=l.join(s);a.setText(l,q,m);var e=q===k.start?k.start:k.start+s.length,r=k.end+(h-r+1)*s.length;n+=q-m+l.length;k.start=e;k.end=r}else return!0;return!1}))return!1;a.setSelections(g);1<g.length&&this.endUndo();return!0}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=
prompt(t.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();s(this,!0,function(a,c){var g=b.getLineAtOffset(a.start),d=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),k=b.getLineCount();if(d!==k-1){var g=b.getLineStart(g),h=b.getLineEnd(d,!0),l=b.getLineEnd(d+1,!0)-(h-g),q=0;d!==k-2?d=b.getText(g,h):(k=b.getLineEnd(d),d=b.getText(k,h)+b.getText(g,k),q+=h-k);c("",g,h);c(d,
l,l);a.start=l+q;a.end=l+q+d.length}});return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();s(this,!0,function(a,c){var g=b.getLineAtOffset(a.start);if(0!==g){var d=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),k=b.getLineCount(),h=b.getLineStart(g-1),l=b.getLineStart(g),q=b.getLineEnd(d,!0),m=b.getText(l,q),s=0;d===k-1&&(d=b.getLineEnd(g-1),g=b.getLineEnd(g-1,!0),m+=b.getText(d,g),l=d,s=g-d);c("",l,q);c(m,h,h);a.start=h;a.end=h+
m.length-s}});return!0},nextAnnotation:function(b){function f(b){return!!b.lineStyle||b.type===a.ANNOTATION_MATCHING_BRACKET||b.type===a.ANNOTATION_CURRENT_BRACKET||!g.isAnnotationTypeVisible(b.type)}var p=this.editor,n=p.getAnnotationModel();if(!n)return!0;var g=p.getOverviewRuler()||p.getAnnotationStyler();if(!g)return!0;for(var k=p.getModel(),r=p.getCaretOffset(),h=n.getAnnotations(b?r:0,b?k.getCharCount():r),l=null;h.hasNext();){var q=h.next();if(b){if(q.start<=r)continue}else if(q.start>=r)continue;
if(!f(q)&&(l=q,b))break}if(l){for(var m=[l],h=n.getAnnotations(l.start,l.start);h.hasNext();)q=h.next(),q!==l&&!f(q)&&m.push(q);var s=p.getTextView(),e=k.getLineAtOffset(l.start),u=d.Tooltip.getTooltip(s);if(!u)return p.moveSelection(l.start),!0;p.moveSelection(l.start,l.start,function(){u.setTarget({getTooltipInfo:function(){var a=s.convert({x:s.getLocationAtOffset(l.start).x,y:s.getLocationAtOffset(k.getLineStart(e)).y},"document","page");return{contents:m,x:a.x,y:a.y+Math.floor(1.33*s.getLineHeight(e))}}},
0)})}return!0},unindentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var d=a.getModel();s(this,!1,function(a,c){for(var k=d.getLineAtOffset(a.start),r=d.getLineAtOffset(a.end>a.start?a.end-1:a.end),h=b.getOptions("tabSize"),l=Array(h+1).join(" "),q=[],m=0,s=0,e=k;e<=r;e++){var u=d.getLine(e,!0);if(d.getLineStart(e)!==d.getLineEnd(e))if(0===u.indexOf("\t"))u=u.substring(1),m++;else if(0===u.indexOf(l))u=u.substring(h),m+=h;else return!0;
e===k&&(s=m);q.push(u)}k=d.getLineStart(k);h=d.getLineEnd(r,!0);r=d.getLineStart(r);q=q.join("");c(q,k,h);s=k===a.start?a.start:a.start-s;m=Math.max(s,a.end-m+(a.end===r+1&&a.start!==a.end?1:0));a.start=s;a.end=m});return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};k.TextActions=q;b.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));
a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new x.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:t.trimTrailingWhitespaces});a.setKeyBinding(new x.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",function(){return this.toggleLineComment()}.bind(this),{name:t.toggleLineComment});a.setKeyBinding(new x.KeyBinding(191,!0,!h.isMac,
!1,h.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:t.addBlockComment});a.setKeyBinding(new x.KeyBinding(220,!0,!h.isMac,!1,h.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:t.removeBlockComment});a.setKeyBinding(new x.KeyBinding("[",!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[",
"]")}.bind(this));a.setKeyBinding(new x.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new x.KeyBinding("\x3c",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("\x3c","\x3e")}.bind(this));a.setKeyBinding(new x.KeyBinding("\x3e",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",
function(){return this.skipClosingBracket("\x3e")}.bind(this));a.setKeyBinding(new x.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new x.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new x.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");
a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new x.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new x.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new x.KeyBinding('"',!1,!1,!1,!1,"keypress"),
"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){function a(b,c){if(b.start===b.end){for(var f=n.getLineAtOffset(b.start),d=n.getLine(f,!1),p=n.getLineStart(f),m=0,s=b.start-p,t;m<s&&(32===(t=d.charCodeAt(m))||9===t);)m++;var p=d.substring(0,m),v=d.substring(0,s),x=d.substring(s),G;if(q.smartIndentation&&123===d.charCodeAt(G=
v.trimRight().length-1))return f=s-G-1,x=x.length-x.trimLeft().length,d=125===d.charCodeAt(s+x)?k+p+g+k+p:k+p+g,c(d,b.start-f,b.end+x),b.start=b.end=b.start+k.length+p.length+g.length-f,!0;if(q.autoCompleteComments&&!l.test(v)&&(r.test(v)||h.test(v))){if(m=r.exec(v)){d=k+p+" * ";d=l.test(x)?d+x.substring(0,x.length-2).trim():d+x.trim();if(n.getLineCount()===f+1||!h.test(n.getLine(f+1)))d+=k+p+" */";c(d,b.start,b.end+x.length);b.start=b.end=b.start+k.length+p.length+3;return!0}if(m=h.exec(v))for(f-=
1;0<=f;f--){m=n.getLine(f,!1);if(r.test(m))return l.test(x)||47===d.charCodeAt(s)?(d=k+p+"*"+x,p=b.start+k.length+p.length+1):(d=k+p+"* "+x,p=b.start+k.length+p.length+2),c(d,b.start,b.end+x.length),b.start=b.end=p,!0;if(!h.test(m))break}}else{if(l.test(v)&&32===p.charCodeAt(p.length-1))return d=k+p.substring(0,p.length-1),c(d,b.start,b.end),b.start=b.end=b.start+d.length,!0;if(0<m){for(m=s;m<d.length&&(32===(t=d.charCodeAt(m++))||9===t);)b.end++;d=n.getLineDelimiter()+p;c(d,b.start,b.end);b.start=
b.end=b.start+d.length;return!0}}}return!1}var b=this.editor,d=b.getTextView();if(d.getOptions("readonly")||d.getOptions("singleMode"))return!1;var n=b.getModel(),b=d.getOptions("tabSize","expandTab"),g=b.expandTab?Array(b.tabSize+1).join(" "):"\t",k=n.getLineDelimiter(),r=/^[\s]*\/\*[\*]*[\s]*$/,h=/^[\s]*\*/,l=/\*\/[\s]*$/,q=this;s(this,!0,function(b,g){a(b,g)||(g(k,b.start,b.end),b.start=b.end=b.start+k.length)});return!0},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var b=a.getModel(),d=/\/\*|\*\//g,k=this;s(this,!1,function(a,c){var r=k._findEnclosingComment(b,a.start,a.end);if(!(void 0!==r.commentStart&&void 0!==r.commentEnd)&&(r=b.getText(a.start,a.end),0!==r.length)){var h=r.length,r=r.replace(d,""),l=r.length;c("/*"+r+"*/",a.start,a.end);a.start+=2;a.end+=2+(l-h)}});return!0},autoPairBrackets:function(a,b){if("["===a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&!this.autoPairParentheses||"\x3c"===a&&!this.autoPairAngleBrackets)return!1;
var d=this.editor;if(d.getTextView().getOptions("readonly"))return!1;var k=/^$|[)}\]>]/,g=d.getModel();s(this,!1,function(d,p){var h=d.start===g.getCharCount()?"":g.getText(d.start,d.start+1).trim();d.start===d.end&&k.test(h)?(h=a+b,p(h,d.start,d.start),d.start=d.end=d.start+1):d.start!==d.end?(h=a+g.getText(d.start,d.end)+b,p(h,d.start,d.end),d.start+=1,d.end+=1):(p(a,d.start,d.end),d.start=d.end=d.start+a.length)});return!0},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;var b=
this.editor;if(b.getTextView().getOptions("readonly"))return!1;var d=/^"$|^'$/,k=/\w/,g=/^$|[)}\]>]/,h=b.getModel();s(this,!1,function(b,f){function l(){f(a,b.start,b.end);b.start=b.end=b.start+a.length}var q=0===b.start?"":h.getText(b.start-1,b.start).trim(),m=b.start===h.getCharCount()?"":h.getText(b.start,b.start+1).trim();b.start!==b.end?(q=h.getText(b.start,b.end),d.test(q)?l():(f(a+q+a,b.start,b.end),b.start+=1,b.end+=1)):m===a?b.start=b.end=b.start+1:q===a||d.test(m)||k.test(q)||!g.test(m)?
l():(f(a+a,b.start,b.end),b.start=b.end=b.start+a.length)});return!0},contentAssistProposalApplied:function(a){function b(){return"number"===typeof d.escapePosition?d.escapePosition:a.data.start+d.proposal.length}var d=a.data.proposal;if(d.positions&&0<d.positions.length&&this.linkedMode){for(var k=[],g=0;g<d.positions.length;++g)k[g]={positions:[{offset:d.positions[g].offset,length:d.positions[g].length}]};this.linkedMode.enterLinkedMode({groups:k,escapePosition:b()})}else d.groups&&0<d.groups.length&&
this.linkedMode?this.linkedMode.enterLinkedMode({groups:d.groups,escapePosition:b()}):"number"===typeof d.escapePosition&&this.editor.getTextView().setCaretOffset(d.escapePosition);return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();s(this,!1,function(a,c){if(a.start===a.end){var g=0===a.start?"":b.getText(a.start-1,a.start),d=a.start===b.getCharCount()?"":b.getText(a.start,a.start+1);("("===g&&")"===d||"["===g&&"]"===d||"{"===
g&&"}"===d||"\x3c"===g&&"\x3e"===d||'"'===g&&'"'===d||"'"===g&&"'"===d)&&c("",a.start,a.start+1)}},!0);return!1},_findEnclosingComment:function(a,b,d){var k=a.getLineAtOffset(b),g=a.getLineAtOffset(d),h,r,l,q,m,s;for(h=k;0<=h&&!(r=a.getLine(h),l=h===k?b-a.getLineStart(k):r.length,q=r.lastIndexOf("/*",l),r=r.lastIndexOf("*/",l),r>q);h--)if(-1!==q){m=a.getLineStart(h)+q;break}for(h=g;h<a.getLineCount()&&!(r=a.getLine(h),l=h===g?d-a.getLineStart(g):0,q=r.indexOf("/*",l),r=r.indexOf("*/",l),-1!==q&&q<
r);h++)if(-1!==r){s=a.getLineStart(h)+r;break}return{commentStart:m,commentEnd:s}},lineStart:function(){var a=this.editor.getModel();s(this,!1,function(b){var d=b.getCaret(),k=a.getLineAtOffset(d),g=a.getLineStart(k),k=a.getLine(k),h;for(h=0;h<k.length;h++){var r=k.charCodeAt(h);if(!(32===r||9===r))break}h+=g;d!==h?b.setCaret(h):b.setCaret(g)});return!0},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),d=this;s(this,!1,function(a,
c){var k=b.getText(a.start,a.end),r,h,l;for(l=0;l<k.length;l++)if("/*"===k.substring(l,l+2)){r=a.start+l;break}for(;l<k.length;l++)if("*/"===k.substring(l,l+2)){h=a.start+l;break}void 0!==r&&void 0!==h?(k=b.getText(r+2,h),c(k,r,h+2),a.start=r,a.end=h):(r=d._findEnclosingComment(b,a.start,a.end),void 0===r.commentStart||void 0===r.commentEnd||(k=b.getText(r.commentStart+2,r.commentEnd),c(k,r.commentStart,r.commentEnd+2),a.start-=2,a.end-=2))});return!0},toggleLineComment:function(){var a=this.editor,
b=a.getTextView();if(b.getOptions("readonly"))return!1;var d=this.lineComment||"//",k=a.getModel();b.setRedraw(!1);s(this,!0,function(a,b){for(var c=k.getLineAtOffset(a.start),f=k.getLineAtOffset(a.end>a.start?a.end-1:a.end),h=!0,l=[],q,m=c;m<=f;m++){var e=k.getLine(m,!0);q=e.indexOf(d);l.push(q);if(!h||-1===q)h=!1;else if(0!==q){for(h=0;h<q;h++){var s=e.charCodeAt(h);if(!(32===s||9===s))break}h=h===q}}m=d.length;e=k.getLineStart(c);if(h){for(h=l.length-1;0<=h;h--)q=l[h]+k.getLineStart(c+h),b("",
q,q+m);q=k.getLineStart(f);l=e===a.start?a.start:a.start-m;c=a.end-m*(f-c+1)+(a.end===q+1?m:0)}else{for(h=l.length-1;0<=h;h--)q=k.getLineStart(c+h),b(d,q,q);l=e===a.start?a.start:a.start+m;c=a.end+m*(f-c+1)}a.start=l;a.end=c});b.setRedraw(!0);return!0},trimTrailingWhitespaces:function(){var a=this.editor,b=a.getModel(),d=a.getSelections();a.getTextView().setRedraw(!1);this.startUndo();for(var k=/(\s+$)/,g=b.getLineCount(),h=0;h<g;h++){var r=b.getLine(h);if(r=k.exec(r)){var l=b.getLineStart(h),q=r[0].length,
m=l+r.index;b.setText("",m,m+q);d.forEach(function(a){a.start>m&&(a.start=Math.max(m,a.start-q));a.start!==a.end&&a.end>m&&(a.end=Math.max(m,a.end-q))})}}this.endUndo();a.setSelections(d,!1);a.getTextView().setRedraw(!0)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var d=b.getModel(),k=b.getSelections();return 1===k.length&&k[0].start===k[0].end&&(k[0].start===d.getCharCount()?
"":d.getText(k[0].start,k[0].start+1))===a?(k[0].start=k[0].end=k[0].start+1,b.setSelections(k),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(a){this.autoPairParentheses=a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=
a},setLineComment:function(a){this.lineComment=a},setSmartIndentation:function(a){this.smartIndentation=a}};k.SourceCodeActions=b;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return k});
define("orion/editor/undoStack",[],function(){function t(d,l,m,h,s){this.model=d;this.offset=l;this.text=m;this.previousText=h;this.type=s}function x(d){this.owner=d;this.changes=[]}function v(d,l){this.size=void 0!==l?l:100;this.reset();var m=this;this._listener={onChanging:function(d){m._onChanging(d)},onDestroy:function(d){m._onDestroy(d)}};if(d.getModel){var h=d.getModel();h.getBaseModel&&(h=h.getBaseModel());this.model=h;this.setView(d)}else this.shared=!0,this.model=d;this.model.addEventListener("Changing",
this._listener.onChanging)}t.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(d,l){this._doUndoRedo(this.offset,this.previousText,this.text,d,l);return!0},redo:function(d,l){this._doUndoRedo(this.offset,this.text,this.previousText,d,l);return!0},merge:function(d,l,m,h,s){if(h===this.type){if(1===h&&d===
this.offset+this.text.length)return this.text+=l,!0;if(-1===h&&s===this.offset)return this.offset=d,this.previousText=m+this.previousText,!0;if(-1===h&&d===this.offset)return this.previousText+=m,!0}return!1},_doUndoRedo:function(d,l,m,h,s){this.model.setText(l,d,d+m.length);s&&h&&(m=h.getModel(),m!==this.model&&(d=m.mapOffset(d,!0)),h.setSelection(d,d+l.length))}};x.prototype={getRedoChanges:function(){for(var d=[],l=0;l<this.changes.length;l++)d=d.concat(this.changes[l].getRedoChanges());return d},
getUndoChanges:function(){for(var d=[],l=this.changes.length-1;0<=l;l--)d=d.concat(this.changes[l].getUndoChanges());return d},add:function(d){this.changes.push(d)},end:function(d){d&&(this.endSelection=d.getSelections());(d=this.owner)&&d.end&&d.end()},undo:function(d,l){1<this.changes.length&&d&&d.setRedraw(!1);for(var m=this.changes.length-1;0<=m;m--)this.changes[m].undo(d,!1);l&&d&&d.setSelections(this.startSelection);1<this.changes.length&&d&&d.setRedraw(!0);(m=this.owner)&&m.undo&&m.undo();
return 0<this.changes.length},redo:function(d,l){1<this.changes.length&&d&&d.setRedraw(!1);for(var m=0;m<this.changes.length;m++)this.changes[m].redo(d,!1);l&&d&&d.setSelections(this.endSelection);(1<this.changes.length,d)&&d.setRedraw(!0);(m=this.owner)&&m.redo&&m.redo();return 0<this.changes.length},merge:function(d,l,m,h,s,q){var b=this.changes.length;return 0<b&&this===q?this.changes[b-1].merge(d,l,m,h,s):!1},start:function(d){d&&(this.startSelection=d.getSelections());(d=this.owner)&&d.start&&
d.start()}};v.prototype={destroy:function(){this._onDestroy()},add:function(d){this.compoundChange?this.compoundChange.add(d):(this.stack.splice(this.index,this.stack.length-this.index,d),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=this.stack[this.index-1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<
this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var d=[],l=this.index;l<this.stack.length;l++)d=d.concat(this.stack[l].getRedoChanges());return d},getUndoChanges:function(){this._commitUndo();for(var d=[],l=this.index;0<=l;l--)d=d.concat(this.stack[l].getUndoChanges());return d},
undo:function(){this._commitUndo();var d;d=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;d=this.stack[--this.index]}while(!(d=d.undo(this.view,!0)));this._ignoreUndo=!1;return d},redo:function(){this._commitUndo();var d;d=!1;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;d=this.stack[this.index++]}while(!(d=d.redo(this.view,!0)));this._ignoreUndo=!1;return d},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(d){this.view!==
d&&(this.view&&d.removeEventListener("Destroy",this._listener.onDestroy),(this.view=d)&&d.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(d){this._commitUndo();d=new x(d);this.add(d);this.compoundChange=d;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},_onDestroy:function(d){(!d||!this.shared)&&this.model.removeEventListener("Changing",this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",
this._listener.onDestroy),this.view=null)},_trackUnsavedChanges:function(d){if(this._unsavedChanges){var l=this._unsavedChanges.length,m=d.removedCharCount,h=d.start,s=d.start+m,q=0;0===d.addedCharCount?q=-1:0===m&&(q=1);if(0<l&&q===this._previousChangeType){l=this._unsavedChanges[l-1];if(0===m&&h===l.end+l.text.length){l.text+=d.text;return}if(0===d.addedCharCount&&s===l.start){l.start=h;return}}this._previousChangeType=q;this._unsavedChanges.push({start:h,end:s,text:d.text})}},_onChanging:function(d){this._trackUnsavedChanges(d);
if(!this._ignoreUndo){var l=d.text,m=d.start,h=d.addedCharCount,s=d.removedCharCount;d=m+s;var q=0;0===h&&1===s?q=-1:1===h&&0===s&&(q=1);h=this.stack.length;s=this.model.getText(m,d);(!(0<h&&this.index===h)||!this.stack[h-1].merge(m,l,s,q,d,this.compoundChange))&&this.add(new t(this.model,m,l,s,q))}}};return{UndoStack:v}});
define("orion/editor/rulers","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/annotations orion/editor/tooltip orion/objects orion/editor/util orion/util".split(" "),function(t,x,v,d,l,m,h){function s(a,b,c){this._location=a||"left";this._overview=b||"page";this._rulerStyle=c;this._view=null}function q(a,b,c,g){s.call(this,b,c,g);var d=this;this._listener={onTextModelChanged:function(a){d._onTextModelChanged(a)},onAnnotationModelChanged:function(a){d._onAnnotationModelChanged(a)}};
this.setAnnotationModel(a)}function b(a,b,c,g,d){q.call(this,a,b,"page",c);this._oddStyle=g||{style:{backgroundColor:"white"}};this._evenStyle=d||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function a(a,b,c){q.call(this,a,b,"page",c)}function k(a,b,c){q.call(this,a,b,"document",c)}function c(b,c,d){a.call(this,b,c,d)}s.prototype={getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},
getView:function(){return this._view},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)}};q.prototype=l.mixin(new s,{getAnnotations:function(a,b){var c=this._annotationModel;if(!c)return[];var g=this._view.getModel(),d=g.getLineStart(a),k=g.getLineEnd(b-1),h=g;g.getBaseModel&&(h=g.getBaseModel(),
d=g.mapOffset(d),k=g.mapOffset(k));for(var l=[],c=this.getAnnotationsByType(c,d,k),d=0;d<c.length;d++)for(var k=c[d],q=h.getLineAtOffset(k.start),m=h.getLineAtOffset(Math.max(k.start,k.end-1)),s=q;s<=m;s++){var e=s;if(g!==h){e=h.getLineStart(s);e=g.mapOffset(e,!0);if(-1===e)continue;e=g.getLineAtOffset(e)}if(a<=e&&e<b){var t=this._mergeAnnotation(l[e],k,s-q,m-q+1);t&&(l[e]=t)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var v in l)l[v]._multiple&&(l[v].html+=this._multiAnnotationOverlay.html);
return l},getAnnotationModel:function(){return this._annotationModel},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=
a},onClick:function(a,b){if(void 0!==a){var c=this._view,g=c.getModel(),k=g.getLineStart(a),r=g.getLineEnd(a,!0),h=c.getSelection().start,c=c.getSelection().end,l=this._annotationModel,q,m,s;if(l){g.getBaseModel&&(k=g.mapOffset(k),r=g.mapOffset(r),h=g.mapOffset(h),c=g.mapOffset(c));var e=this;m=(q=this._findNextAnnotation(l,k,r,h,c,function(a){return e.isAnnotationTypeVisible(a)}))?q.start:k;s=q?q.end:k;g.getBaseModel&&(m=g.mapOffset(m,!0),s=g.mapOffset(s,!0));q&&void 0!==q.groupId&&(this._currentClickGroup=
this._currentClickGroup===q.groupId?null:q.groupId,this._setCurrentGroup(a))}this._view.setSelection(s,m,1/3,function(){});(g=d.Tooltip.getTooltip(this._view))&&(q&&"left"===this.getLocation()?g.show({getTooltipInfo:function(){return e._getTooltipInfo([q])}},!1,!1):g.hide())}},onDblClick:function(a,b){},onMouseMove:function(a,b){var c=d.Tooltip.getTooltip(this._view);if(c&&!(c.isVisible()&&this._tooltipLineIndex===a)&&(this._tooltipLineIndex=a,!(b.clientX===this._lastMouseX&&b.clientY===this._lastMouseY))){this._lastMouseX=
b.clientX;this._lastMouseY=b.clientY;this._hoverTimeout&&(window.clearTimeout(this._hoverTimeout),this._hoverTimeout=null);var g=b.target?b.target:b.srcElement;this._curElementBounds=g.getBoundingClientRect();g._ruler&&(this._curElementBounds.top=b.clientY,this._curElementBounds.height=1);var k=this;k._hoverTimeout=window.setTimeout(function(){k._hoverTimeout=null;c.onHover({getTooltipInfo:function(){var a=k._getAnnotationsAtLineIndex(k._tooltipLineIndex),a=k._getTooltipContents(k._tooltipLineIndex,
a);return k._getTooltipInfo(a,b.clientY,{source:"ruler",rulerLocation:k.getLocation()})}},b.clientX,b.clientY)},175)}},onMouseOver:function(a,b){this.onMouseMove(a,b);this._currentClickGroup||this._setCurrentGroup(a)},onMouseOut:function(a,b){this._currentClickGroup||this._setCurrentGroup(-1);this._hoverTimeout&&(window.clearTimeout(this._hoverTimeout),this._hoverTimeout=null)},_findNextAnnotation:function(a,b,c,g,d,k){var h=null,l,q=b;if(0<=g&&0<=d&&g>=b&&g<c)for(var q=g,m=a.getAnnotations(g,d);!l&&
m.hasNext();)if(b=m.next(),!k||k(b.type))b.start===g&&b.end===d&&(l=b);a=a.getAnnotations(q,c);for(var s;a.hasNext();)if(b=a.next(),!k||k(b.type)){h||(h=b);if(!l){h=b;break}if(s&&(l.start!==b.start||l.end!==b.end)){s=!1;h=b;break}l&&l===b&&(s=!0)}s&&(h=null);return h},_getAnnotationsAtLineIndex:function(a){if(void 0!==a){var b=this._view.getModel(),c=this._annotationModel,g=[];c&&(g=b.getLineStart(a),a=b.getLineEnd(a),b.getBaseModel&&(g=b.mapOffset(g),a=b.mapOffset(a)),g=this.getAnnotationsByType(c,
g,a));return g}},_getTooltipInfo:function(a,b,c){if(!a)return null;var g=Object.create(null);g.top=this._curElementBounds.top;g.left=this._curElementBounds.left;g.height=this._curElementBounds.height;g.width=this._curElementBounds.width;"string"===typeof a&&b&&(g.top=b,g.height=1);var d=this.getLocation();b=this.getRulerStyle();var d="left"===d?"right":"left",k=0,h=0,k=this._view._clientDiv.getBoundingClientRect().left-(g.left+g.width),h=g.height;"left"===d&&(k=-25,1===g.height&&(k+=2));0<=b.styleClass.indexOf("folding")&&
(h-=14);return{contents:a,position:d,tooltipOffsetX:k,tooltipOffsetY:h,anchorArea:g,context:c}},_getTooltipContents:function(a,b){return b},_getOnClickTooltipInfo:function(a){var b=this._view,c=Object.create(null);c.top=this._curElementBounds.top;c.left=this._curElementBounds.left;c.height=this._curElementBounds.height;c.width=this._curElementBounds.width;var g="left"===this.getLocation()?"right":"left";a={contents:[a],position:g,anchorArea:c};b=b._clientDiv.getBoundingClientRect();a.offsetX=b.left-
(c.left+c.width);a.offsetY=c.height;"left"===a.position&&(a.offsetX=20);return a},_onAnnotationModelChanged:function(a){function b(a){for(var f=0;f<a.length;f++)if(d.isAnnotationTypeVisible(a[f].type)){h=a[f].start;var k=a[f].end;g.getBaseModel&&(h=g.mapOffset(h,!0),k=g.mapOffset(k,!0));-1!==h&&-1!==k&&c.redrawLines(g.getLineAtOffset(h),g.getLineAtOffset(Math.max(h,k-1))+1,d)}}var c=this._view;if(c){var g=c.getModel(),d=this,k=g.getLineCount();if(a.textModelChangedEvent){var h=a.textModelChangedEvent.start;
g.getBaseModel&&(h=g.mapOffset(h,!0));a=g.getLineAtOffset(h);c.redrawLines(a,k,d)}else b(a.added),b(a.removed),b(a.changed)}},_mergeAnnotation:function(a,b,c,g){a||(a={});0===c&&(a.html&&b.html?(b.html!==a.html&&(!a._multiple&&this._multiAnnotation)&&(a.html=this._multiAnnotation.html),a._multiple=!0):a.html=b.html);a.style=this._mergeStyle(a.style,b.style);return a},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass=a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+(" "+b.styleClass):
b.styleClass;var c;if(b.style)for(c in a.style||(a.style={}),b.style)void 0===a.style[c]&&(a.style[c]=b.style[c]);if(b.attributes)for(c in a.attributes||(a.attributes={}),b.attributes)void 0===a.attributes[c]&&(a.attributes[c]=b.attributes[c])}return a},_setCurrentGroup:function(a){var b=this._annotationModel,c=null,g=b.getTextModel(),d,k=this._currentGroupAnnotation;if(-1!==a){var h=g.getLineStart(a),l=g.getLineEnd(a);g.getBaseModel&&(h=g.mapOffset(h),l=g.mapOffset(l));for(d=b.getAnnotations(h,l);d.hasNext();)if(g=
d.next(),this.isAnnotationTypeVisible(g.type)&&g.start<=h&&g.end>=l&&void 0!==g.groupId){c=g;break}if(k&&c&&k.groupId===c.groupId)return}this._currentGroupAnnotation=null;k&&b.removeAnnotations(k.groupType);if(c&&-1!==a){this._currentGroupAnnotation=c;d=b.getAnnotations();for(a=[];d.hasNext();)g=d.next(),delete g.groupAnnotation,g.groupId===c.groupId&&(g=g.createGroupAnnotation(),a.push(g));b.replaceAnnotations(null,a)}}});v.AnnotationTypeList.addMixin(q.prototype);b.prototype=new q;b.prototype.getAnnotations=
function(a,b){for(var c=q.prototype.getAnnotations.call(this,a,b),g=this._view.getModel(),d=a;d<b;d++){var k=d-this._firstLine&1?this._oddStyle:this._evenStyle,h=d;g.getBaseModel&&(h=g.getLineStart(h),h=g.getBaseModel().getLineAtOffset(g.mapOffset(h)));c[d]||(c[d]={});c[d].html=this._firstLine+h+"";c[d].style||(c[d].style=k)}return c};b.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();return this.getAnnotations(a-1,a)[a-1]};b.prototype.setFirstLine=function(a){this._firstLine=
void 0!==a?a:1};b.prototype._onTextModelChanged=function(a){var b=a.start;a=this._view.getModel();var c=a.getBaseModel?a.getBaseModel().getLineCount():a.getLineCount(),c=(this._firstLine+c-1+"").length;this._numOfDigits!==c&&(this._numOfDigits=c,b=a.getLineAtOffset(b),this._view.redrawLines(b,a.getLineCount(),this))};a.prototype=new q;k.prototype=new q;k.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};k.prototype._getTooltipContents=
function(a,b){if(b&&0===b.length){var c=this._view.getModel(),g=a;c.getBaseModel&&(g=c.getLineStart(g),g=c.getBaseModel().getLineAtOffset(c.mapOffset(g)));return h.formatMessage(t.line,g+1)}return q.prototype._getTooltipContents.call(this,a,b)};k.prototype._mergeAnnotation=function(a,b,c,g){if(0===c)return a||(a={html:"\x26nbsp;",style:{style:{height:3*g+"px"}}},a.style=this._mergeStyle(a.style,b.overviewStyle)),a};c.prototype=new a;c.prototype.onClick=function(a,b){if(void 0!==a){var c=this._annotationModel;
if(c){var g=this._view.getModel(),k=g.getLineStart(a),h=g.getLineEnd(a,!0);g.getBaseModel&&(k=g.mapOffset(k),h=g.mapOffset(h),g=g.getBaseModel());for(var l,c=c.getAnnotations(k,h);!l&&c.hasNext();)h=c.next(),this.isAnnotationTypeVisible(h.type)&&g.getLineAtOffset(h.start)===g.getLineAtOffset(k)&&(l=h);l&&((g=d.Tooltip.getTooltip(this._view))&&g.hide(),l.expanded?l.collapse():l.expand())}}};c.prototype._getTooltipContents=function(b,c){if(c&&0<c.length){var d=this._view.getModel(),g=d.getLineStart(b);
d.getBaseModel&&(g=d.mapOffset(g),d=d.getBaseModel());for(var g=d.getLineAtOffset(g),k=0;k<c.length;k++){var h=c[k];if(this.isAnnotationTypeVisible(h.type)&&d.getLineAtOffset(h.start)===g){if(c[k].expanded)break;return a.prototype._getTooltipContents.call(this,b,[h])}}}return null};c.prototype._onAnnotationModelChanged=function(b){function c(a){for(h=0;h<a.length;h++)if(k.isAnnotationTypeVisible(a[h].type)){var b=a[h].start;g.getBaseModel&&(b=g.mapOffset(b,!0));-1!==b&&(q=Math.min(q,g.getLineAtOffset(b)))}}
if(b.textModelChangedEvent)a.prototype._onAnnotationModelChanged.call(this,b);else{var d=this._view;if(d){var g=d.getModel(),k=this,h,l=g.getLineCount(),q=l;c(b.added);c(b.removed);c(b.changed);b=d.getRulers();for(h=0;h<b.length;h++)d.redrawLines(q,l,b[h])}}};v=function(a,b){s.call(this,a,"fixed",b)};v.prototype=l.mixin(new s,{setView:function(a){this._destroy();s.prototype.setView.call(this,a);this._create()},_create:function(){function a(b){var c=b.themeClass;c?((c=c.replace("textviewZoom",""))&&
(c=" "+c),c="textviewZoom"+c):c="textviewZoom";b.themeClass=c;b.noScroll=!0;b.readonly=!0;return b}function b(){var a=l._metrics.viewPadding,c=l._metrics.viewPadding,g=l.getLineHeight(),d=s.getLineHeight(),e=l.getModel().getLineCount(),g=l._lineHeight?l._scrollHeight:e*g,d=s._lineHeight?s._scrollHeight:e*d,e=d/g,k=l.getClientArea().height+a.top+a.bottom,c=s.getClientArea().height+c.top+c.bottom;return{zoomFactor:e,documentHeight:g,zoomDocumentHeight:d,clientHeight:k,zoomClientHeight:c,scrollWidth:l._metrics.scrollWidth,
windowHeight:k*e,padding:a}}function c(a){a=a||{y:l.getTopPixel()};var g=b();s.setTopPixel(a.y*(g.zoomFactor+(g.windowHeight-g.clientHeight-g.scrollWidth)/g.documentHeight));a=a.y*g.zoomFactor;g=g.clientHeight*g.zoomFactor;u.top=a;u.bottom=a+g;a=s.convert({y:a},"document","page").y;a-=u.node.getBoundingClientRect().top;v.style.top=a+"px";v.style.height=g-e+"px"}function g(a){a.wrapMode&&!a.wrapOffset&&l._metrics.charWidth?(a=h.createElement(t,"div"),a.style.position="fixed",a.style.left="-1000px",
s._clientDiv.appendChild(a),a.innerHTML=Array(Math.ceil(l.getClientArea().width/l._metrics.charWidth)+1).join("a"),a=a.getBoundingClientRect(),a=Math.min(150,Math.ceil(a.right-a.left))+"px"):a="";var b=u.node.style.width;u.node.style.width=a;return b!==a}function d(a,b,c){c||u.top<=a.y&&a.y<=u.bottom?(u.mouseDown=!0,u.delta=b-v.getBoundingClientRect().top+u.node.getBoundingClientRect().top):(a=s.getOffsetAtLocation(a.x,a.y),l.setSelection(a,a,0.5,function(){}))}function k(a){if(u.mouseDown){var c=
b();a=Math.min(c.zoomClientHeight-c.windowHeight,Math.max(0,a-u.delta));l.setTopPixel(a*(c.documentHeight-c.clientHeight)/Math.min(c.zoomDocumentHeight,c.zoomClientHeight-c.windowHeight))}}var l=this.getView();if(l){var q=a(l.getOptions());q.parent=this.node;var s=this._zoomView=new x.TextView(q);s._clientDiv.contentEditable=!1;s.setModel(l.getModel());var t=l.getOptions("parent").ownerDocument,v=this._windowDiv=h.createElement(t,"div");v.className="rulerZoomWindow";this.node.appendChild(v);var e=
parseInt(m.getNodeStyle(v,"border-top-width",0))+parseInt(m.getNodeStyle(v,"border-bottom-width",0)),u=this;l.addEventListener("Scroll",this._scrollListener=function(a){c(a.newValue)});l.addEventListener("Resize",this._resizeListener=function(){g(s.getOptions());c()});l.addEventListener("Redraw",this._redrawListener=function(a){a.ruler||s.redrawLines(a.startLine,a.endLine)});l.addEventListener("Options",this._optionsListener=function(b){b=a(b.options);s.setOptions(b);g(s.getOptions())});s.addEventListener("LineStyle",
this._lineListener=function(a){l.onLineStyle(a)});h.isIOS||h.isAndroid?(v.addEventListener("touchstart",function(a){1===a.touches.length&&(d(a,a.touches[0].clientY,!0),a.preventDefault())}),v.addEventListener("touchend",function(a){0===a.touches.length&&(u.mouseDown=!1)}),v.addEventListener("touchmove",function(a){1===a.touches.length&&k(a.touches[0].clientY)}),s.addEventListener("TouchStart",function(a){1===a.touchCount&&(d(a,a.event.touches[0].clientY),a.preventDefault())})):(v.style.pointerEvents=
"none",s.addEventListener("MouseDown",function(a){var b=a.event;(b.which?0===b.button:1===b.button)&&d(a,b.clientY);a.preventDefault()}),s.addEventListener("MouseUp",function(a){u.mouseDown=!1;a.preventDefault()}),s.addEventListener("MouseMove",function(a){k(a.event.clientY);a.preventDefault()}));(t.defaultView||t.parentWindow).setTimeout(function(){c()},0)}},_destroy:function(){var a=this.getView();a&&(a.removeEventListener("Scroll",this._scrollListener),this._scrollListener=null,a.removeEventListener("Resize",
this._resizeListener),this._resizeListener=null,a.removeEventListener("Redraw",this._redrawListener),this._redrawListener=null,a.removeEventListener("Options",this._optionsListener),this._optionsListener=null);if(a=this._zoomView)a.removeEventListener("LineStyle",this._lineListener),a.setModel(null),a.destroy(),this._zoomView=null}});return{BaseRuler:s,Ruler:q,AnnotationRuler:a,LineNumberRuler:b,OverviewRuler:k,FoldingRuler:c,ZoomRuler:v}});
define("orion/editor/textDND",["orion/util"],function(t){function x(t,d){this._view=t;this._undoStack=d;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var l=this;this._listener={onDragStart:function(d){l._onDragStart(d)},onDragEnd:function(d){l._onDragEnd(d)},onDragEnter:function(d){l._onDragEnter(d)},onDragOver:function(d){l._onDragOver(d)},onDrop:function(d){l._onDrop(d)},onDestroy:function(d){l._onDestroy(d)}};t.addEventListener("DragStart",this._listener.onDragStart);t.addEventListener("DragEnd",
this._listener.onDragEnd);t.addEventListener("DragEnter",this._listener.onDragEnter);t.addEventListener("DragOver",this._listener.onDragOver);t.addEventListener("Drop",this._listener.onDrop);t.addEventListener("Destroy",this._listener.onDestroy)}x.prototype={destroy:function(){var t=this._view;t&&(t.removeEventListener("DragStart",this._listener.onDragStart),t.removeEventListener("DragEnd",this._listener.onDragEnd),t.removeEventListener("DragEnter",this._listener.onDragEnter),t.removeEventListener("DragOver",
this._listener.onDragOver),t.removeEventListener("Drop",this._listener.onDrop),t.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(t){this.destroy()},_onDragStart:function(t){var d=this._view,l=d.getSelectionText();l&&(this._dragSelection=d.getSelections(),t.event.dataTransfer.effectAllowed="copyMove",t.event.dataTransfer.setData("Text",l))},_onDragEnd:function(v){if(this._dragSelection){var d=this._view,l=v.event.dataTransfer.dropEffect;if(!t.isFirefox&&
("none"!==l||this._dropText))l=v.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(v="move"===l)&&d.setText({text:"",selection:this._dragSelection});if(this._dropText){var l=this._dropText,m=this._dropOffset;v&&this._dragSelection.forEach(function(d){m>=d.end?m-=d.end-d.start:m>=d.start&&(m=d.start)});d.setText(l,m,m);d.setSelection(m,m+l.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange();this._dragSelection=
null}},_onDragEnter:function(t){this._onDragOver(t)},_onDragOver:function(v){var d=v.event.dataTransfer.types,l=!this._view.getOptions("readonly");l&&d&&(l=d.contains?d.contains("text/plain")||d.contains("Text"):-1!==d.indexOf("text/plain")||-1!==d.indexOf("Text"));l?t.isFirefox||(this._dropEffect=v.event.dataTransfer.dropEffect=(t.isMac?v.event.altKey:v.event.ctrlKey)?"copy":"move"):v.event.dataTransfer.dropEffect="none"},_onDrop:function(v){var d=this._view,l=v.event.dataTransfer.getData("Text");
l&&(t.isFirefox||(v.event.dataTransfer.dropEffect=this._dropEffect),v=d.getOffsetAtLocation(v.x,v.y),this._dragSelection?(this._dropOffset=v,this._dropText=l):(d.setText(l,v,v),d.setSelection(v,v+l.length)))}};return{TextDND:x}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/objects orion/util".split(" "),function(t,x,v,d,l){function m(d){this._data=d}function h(d,b,a){var k=d.getTextView();v.KeyMode.call(this,k);this.editor=d;this.undoStack=b;this.contentAssist=a;this.linkedModeModel=null;k.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));k.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);
return!0}.bind(this));k.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));k.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(a){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),
this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),d=this.linkedModeModel,k,g;d;)if(k=this._getPositionChanged(d,b,b+a.removedCharCount),g=k.position,void 0===g||g.model!==d)this.exitLinkedMode(!1),d=this.linkedModeModel;else break;if(d){d=0;a=a.addedCharCount-a.removedCharCount;k=k.positions;for(var h,r=0;r<k.length;++r){h=k[r];g=h.position;var l=g.offset<=b&&b<=g.offset+g.length;l&&!h.ansestor?(g.offset+=d,
g.length+=a,d+=a):(g.offset+=d,h.ansestor&&l&&(g.length+=a));h.escape&&(h.model.escapePosition=g.offset)}this._updateAnnotations(k)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=this.editor,d=b.mapOffset(a.start),k=this.editor.mapOffset(a.end),g=this.linkedModeModel,h,r;g;)if(h=this._getPositionChanged(g,d,k),r=h.position,void 0===r||r.model!==g)this.exitLinkedMode(!1),g=this.linkedModeModel;else break;if(g){var l=this._compoundChange;l?l.owner.model===g&&l.owner.group===r.group||
(this.endUndo(),this.startUndo()):this.startUndo();g.selectedGroupIndex=r.group;var l=0,q=a.text.length-(k-d);h=h.positions;for(var m,d=d-r.position.offset,s=k-r.position.offset,t=0;t<h.length;++t)m=h[t],k=m.position,m.oldOffset=k.offset,m.model===g&&m.group===r.group?(k.offset+=l,k.length+=q,l+=q):(k.offset+=l,m.ansestor&&(k.length+=r.count*q)),m.escape&&(m.model.escapePosition=k.offset);this.ignoreVerify=!0;for(t=h.length-1;0<=t;t--)m=h[t],m.model===g&&m.group===r.group&&b.setText(a.text,m.oldOffset+
d,m.oldOffset+s,!1);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(h)}}}.bind(this)}}var s={};m.prototype={chop:function(d,b){return b.substring(d.length)},computeProposals:function(d,b,a){b=a.prefix;d=[];a=(a=this._data.style?this._data.style:null)?a:"emphasis";for(var k=this._data.values,c=0;c<k.length;c++){var f=k[c];"string"===typeof f&&0===f.indexOf(b)?d.push({proposal:this.chop(b,f),description:f,hover:f,style:a}):"object"===typeof f&&f.proposal&&d.push({proposal:this.chop(b,f.proposal),
description:f.description?f.description:f.proposal,hover:f.hover?f.hover:f.proposal,style:a})}b=this._data.title?this._data.title:null;0<d.length&&d.splice(0,0,{proposal:"",description:b?b:"Options",style:"noemphasis_title",unselectable:!0});return d}};h.prototype=new v.KeyMode;l.mixin(h.prototype,{createKeyBindings:function(){var d=x.KeyBinding,b=[];b.push({actionID:"linkedModeEnter",keyBinding:new d(13)});b.push({actionID:"linkedModeCancel",keyBinding:new d(27)});b.push({actionID:"linkedModeNextGroup",
keyBinding:new d(9)});b.push({actionID:"linkedModePreviousGroup",keyBinding:new d(9,!1,!0)});return b},enterLinkedMode:function(d){if(!this.linkedModeModel){var b=this.editor.getTextView();b.addKeyMode(this);b.addEventListener("Verify",this.linkedModeListener.onVerify);b.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(t.linkedModeEntered,null,!0)}this._sortedPositions=
null;this.linkedModeModel&&(d.previousModel=this.linkedModeModel,d.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=d);this.linkedModeModel=d;this.selectLinkedGroup(0)},exitLinkedMode:function(d){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var b=this.linkedModeModel;this.linkedModeModel=b.previousModel;b.parentGroup=b.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);
if(!this.linkedModeModel){var a=this.editor,k=a.getTextView();k.removeKeyMode(this);k.removeEventListener("Verify",this.linkedModeListener.onVerify);k.removeEventListener("ModelChanged",this.linkedModeListener.onModelChanged);k=this.contentAssist;k.removeEventListener("Activating",this.linkedModeListener.onActivating);k.offset=void 0;this.editor.reportStatus(t.linkedModeExited,null,!0);d&&"number"===typeof b.escapePosition&&a.setCaretOffset(b.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var d=
this,b=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:b,group:b.selectedGroupIndex,end:function(){d._compoundChange=null}})}},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(d){var b=this.linkedModeModel;if(b){b.selectedGroupIndex=d;d=b.groups[d];var a=d.positions[0],k=this.editor;k.setSelection(a.offset,a.offset+
a.length);if(b=this.contentAssist)b.offset=void 0,d.data&&"link"===d.data.type&&d.data.values?((this._groupContentAssistProvider=new m(d.data)).getPrefix=function(){var b=k.getSelection();return b.start===b.end&&(b=k.getCaretOffset(),a.offset<=b&&b<=a.offset+a.length)?k.getText(a.offset,b):""},b.offset=a.offset,b.deactivate(),b.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,b.deactivate())}this._updateAnnotations()},_getModelPositions:function(d,b,a){for(var k=
b.groups,c=0;c<k.length;c++)for(var f=k[c].positions,h=0;h<f.length;h++){var n=f[h];a&&(n={offset:n.offset+a,length:n.length});n={index:h,group:c,count:f.length,model:b,position:n};d.push(n);b.nextModel&&b.nextModel.parentGroup===c&&(n.ansestor=!0,this._getModelPositions(d,b.nextModel,(a||0)+f[h].offset-f[0].offset))}},_getSortedPositions:function(d){var b=this._sortedPositions;if(!b){for(b=[];d.previousModel;)d=d.previousModel;for(this._getModelPositions(b,d);d;)"number"===typeof d.escapePosition&&
b.push({escape:!0,model:d,position:{offset:d.escapePosition,length:0}}),d=d.nextModel;b.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=b}return b},_getPositionChanged:function(d,b,a){var k;d=this._getSortedPositions(d);for(var c=d.length-1;0<=c;c--)if(!d[c].escape){var f=d[c].position;if(f.offset<=b&&a<=f.offset+f.length){k=d[c];break}}return{position:k,positions:d}},_updateAnnotations:function(h){var b=this.editor.getAnnotationModel();if(b){for(var a=[],k=[],
c=b.getAnnotations(),f;c.hasNext();)switch(f=c.next(),f.type){case d.AnnotationType.ANNOTATION_LINKED_GROUP:case d.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case d.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(f)}if(c=this.linkedModeModel){h=h||this._getSortedPositions(c);for(var p=0;p<h.length;p++)if(f=h[p],f.model===c&&!f.escape){var n=d.AnnotationType.ANNOTATION_LINKED_GROUP;f.group===c.selectedGroupIndex&&(n=0===f.index?d.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:d.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);
f=f.position;f=d.AnnotationType.createAnnotation(n,f.offset,f.offset+f.length,"");k.push(f)}}b.replaceAnnotations(a,k)}}});s.LinkedMode=h;return s});
define("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode orion/util".split(" "),function(t,x,v,d,l,m,h){function s(){}function q(){}function b(){}function a(){}function k(){}function c(){}function f(){}var p={};s.prototype={createKeyBindings:function(a,b,c,d){d=new t.TextActions(a,b,d);var k=new m.LinkedMode(a,b,c);a=new t.SourceCodeActions(a,b,c,k);return{textActions:d,linkedMode:k,sourceCodeActions:a}}};
p.KeyBindingsFactory=s;q.prototype={createUndoStack:function(a){a=a.getTextView();return new x.UndoStack(a,200)}};p.UndoFactory=q;b.prototype={createLineNumberRuler:function(a){return new v.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};p.LineNumberRulerFactory=b;a.prototype={createFoldingRuler:function(a){return new v.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};p.FoldingRulerFactory=a;k.prototype={createZoomRuler:function(a){return new v.ZoomRuler(h.isIOS||
h.isAndroid?"right":"innerRight",{styleClass:"ruler zoom"})}};p.ZoomRulerFactory=k;c.prototype={createAnnotationModel:function(a){return new d.AnnotationModel(a)},createAnnotationStyler:function(a,b){return new d.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new v.AnnotationRuler(a,"left",{styleClass:"ruler annotations"});a=new v.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};p.AnnotationFactory=c;f.prototype={createTextDND:function(a,
b){return new l.TextDND(a.getTextView(),b)}};p.TextDNDFactory=f;return p});define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(t,x,v,d){return d.mixin({},t,x,v)});
define("orion/editor/contentAssist","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/eventTarget orion/Deferred orion/objects orion/editor/tooltip orion/editor/util orion/util orion/webui/littlelib orion/metrics".split(" "),function(t,x,v,d,l,m,h,s,q,b,a){function k(a){this.textView=a;this.state=p.INACTIVE;this.clearProviders();var b=this;this._textViewListeners={onModelChanging:function(a){(this._latestModelChangingEvent=a)&&this._updateFilterText(a)}.bind(this),
onSelection:function(a){this.isDeactivatingChange(this._latestModelChangingEvent,a)?this.setState(p.INACTIVE):this.isActive()&&(this.state===p.ACTIVE&&this.setState(p.FILTERING),this.filterProposals());this._latestModelChangingEvent=null}.bind(this),onScroll:function(a){this.setState(p.INACTIVE)}.bind(this)};a.setKeyBinding(q.isMac?new x.KeyBinding(" ",!1,!1,!1,!0):new x.KeyBinding(" ",!0),"contentAssist");a.setKeyBinding(q.isMac?new x.KeyBinding(" ",!1,!1,!0,!0):new x.KeyBinding(" ",!0,!1,!0),"contentAssist");
a.setAction("contentAssist",function(){a.getOptions("readonly")||b.activate();return!0},{name:t.contentAssist})}function c(a,b){var c=a.textView;v.KeyMode.call(this,c);this.contentAssist=a;this.widget=b;this.proposals=[];var d=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){d.proposals=a.data.proposals;if(0===d.proposals.length)d.selectedIndex=-1,d.cancel();else{for(d.selectedIndex=0;d.proposals[d.selectedIndex]&&d.proposals[d.selectedIndex].unselectable;)d.selectedIndex++;
if(d.proposals[d.selectedIndex]){if(d.widget){var b=!0;if(a.autoApply){for(a=d.selectedIndex+1;d.proposals[a]&&d.proposals[a].unselectable;)a++;d.proposals[a]||(b=!1,d.contentAssist.apply(d.proposals[d.selectedIndex]))}b&&(d.widget.show(),d.widget.selectNode(d.selectedIndex))}}else d.selectedIndex=-1,d.cancel()}});c.setAction("contentAssistApply",function(){return this.enter()}.bind(this));c.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));c.setAction("contentAssistNextProposal",
function(){return this.lineDown()}.bind(this));c.setAction("contentAssistPreviousProposal",function(){return this.lineUp()}.bind(this));c.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));c.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));c.setAction("contentAssistHome",function(){this.widget&&this.widget.scrollIndex(0,!0);return this.lineDown(0)}.bind(this));c.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-
1)}.bind(this));c.setAction("contentAssistTab",function(){return this.tab()}.bind(this));this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function f(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var c=this.textView.getOptions("parent").ownerDocument;this.parentNode="string"===typeof b?c.getElementById(b):b;if(!this.parentNode){this.parentNode=q.createElement(c,"div");this.parentNode.className=
"contentassist";var d=c.getElementsByTagName("body")[0];if(d)d.appendChild(this.parentNode);else throw Error("parentNode is required");}s.addEventListener(this.parentNode,"scroll",this.onScroll.bind(this));var k=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==k.parentNode&&k.contentAssist.deactivate()}};this.contentAssist.addEventListener("Deactivating",function(a){k.hide()});this.scrollListener=function(a){k.isShowing&&k.position()};s.addEventListener(c,
"scroll",this.scrollListener)}var p={INACTIVE:1,ACTIVE:2,FILTERING:3},n={selected:"selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};k.prototype={apply:function(b){if(!b)return!1;var c=this.textView,d=c.getSelection(),k=this._initialCaretOffset,f=k,h=d=Math.max(d.start,d.end),n=
c.getModel();n.getBaseModel&&(f=n.mapOffset(f),h=n.mapOffset(h),n=n.getBaseModel());b.overwrite&&(k="string"===typeof b.prefix?f-b.prefix.length:this.getPrefixStart(n,f));f={proposal:b,start:f,end:h};this.setState(p.INACTIVE);c.setText("string"===typeof b?b:b.proposal,k,d);if(b.additionalEdits)for(d=0;d<b.additionalEdits.length;d++)k=b.additionalEdits[d],c.setText(k.text,k.offset,k.offset+k.length);this.dispatchEvent({type:"ProposalApplied",data:f});a.logEvent("contentAssist","apply");return!0},activate:function(b,
c){this.state===p.INACTIVE&&(a.logEvent("contentAssist","activate",void 0,c?0:1),this._autoTriggered=c?!0:!1,this.setState(p.ACTIVE,b))},deactivate:function(){this.setState(p.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===p.ACTIVE||this.state===p.FILTERING},isDeactivatingChange:function(a,b){var c=!1;(Array.isArray(b.newValue)?b.newValue:[b.newValue])[0].start<this._initialCaretOffset||!a?c=!0:a&&(c=0<a.removedLineCount||0<a.addedLineCount);return c},
setState:function(a,b){var c;a===p.ACTIVE?(c="Activating",this._mode&&this._mode.setActive(!0)):a===p.INACTIVE&&(c="Deactivating",this._mode&&this._mode.setActive(!1));c&&this.dispatchEvent({type:c,providers:b});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){a===p.INACTIVE?(this._removeTextViewListeners(),this._filterText="",this._initialCaretOffset=-1,this._computedProposals=null):a===p.ACTIVE&&(this._filterText="",this._addTextViewListeners(),this.computeProposals())},
computeProposals:function(){var a=this.textView.getCaretOffset(),b=this.textView.getSelection(),b=Math.min(b.start,b.end);this._initialCaretOffset=Math.min(a,b);this._computedProposals=null;this._computeProposals(this._initialCaretOffset).then(function(a){if(this.isActive()){var b=this._flatten(a);b&&(Array.isArray(b)&&0<b.length)&&(this._computedProposals=a);this.dispatchEvent({type:"ProposalsComputed",data:{proposals:b},autoApply:!this._autoTriggered});this._computedProposals&&this._filterText&&
this.filterProposals(!0)}}.bind(this))},getPrefixStart:function(a,b){for(var c=b;0<c&&/[A-Za-z0-9_]/.test(a.getText(c-1,c));)c--;return c},handleError:function(a){"undefined"!==typeof console&&(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},initialize:function(){this._providers.forEach(function(a){a=a.provider;"function"===typeof a.initialize&&a.initialize()})},_computeProposals:function(a){var b=this._providers,c=this.textView,d=c.getSelection(),k=c.getModel(),
f=a;k.getBaseModel&&(f=k.mapOffset(f),d.start=k.mapOffset(d.start),d.end=k.mapOffset(d.end),k=k.getBaseModel());a=k.getLine(k.getLineAtOffset(f));for(var h=0;h<a.length&&/\s/.test(a.charAt(h));)h++;var h=a.substring(0,h),c=c.getOptions("tabSize","expandTab"),c=c.expandTab?Array(c.tabSize+1).join(" "):"\t",p={line:a,offset:f,prefix:k.getText(this.getPrefixStart(k,f),f),selection:d,delimiter:k.getLineDelimiter(),tab:c,indentation:h},e=this,b=b.map(function(a){a=a.provider;var b;try{var c,d;if(c=a.computeContentAssist){var g=
e.editorContextProvider,h=g.getEditorContext();p=m.mixin(p,g.getOptions());d=c.apply(a,[h,p])}else if(c=a.getProposals||a.computeProposals)d=c.apply(a,[k.getText(),f,p]);b=e.progress?e.progress.progress(d,"Generating content assist proposal"):d}catch(n){return(new l).reject(n)}return l.when(b)});return l.all(b,this.handleError)},filterProposals:function(a){if(this._computedProposals&&(this._latestModelChangingEvent||a)){a=this.textView.getModel();a.getBaseModel&&(a=a.getBaseModel());a=this.getPrefixStart(a,
this._initialCaretOffset);var b=this.textView.getText(a,this._initialCaretOffset),c=b,d=[];this._computedProposals.forEach(function(a){a&&Array.isArray(a)&&(a=a.filter(function(a){if(!a)return!1;c="string"===typeof a.prefix?a.prefix:b;if(n[a.style]===n.hr||n[a.style]===n.noemphasis_title)return!0;var d="";if(a.overwrite){if(a.name)d=a.name;else if(a.proposal)d=a.proposal;else return!1;return 0===d.indexOf(c+this._filterText)}return a.name||a.proposal?(d=!1,a.name&&(d=0===a.name.indexOf(c+this._filterText)),
!d&&a.proposal&&(d=0===a.proposal.indexOf(this._filterText)),d):"string"===typeof a?0===a.indexOf(this._filterText):!1},this),0<a.length&&d.push(a))},this);a=[];d&&(d=this._removeExtraUnselectableElements(d),a=this._flatten(d));this.dispatchEvent({type:"ProposalsComputed",data:{proposals:a},autoApply:!1})}},_removeExtraUnselectableElements:function(a){return a.map(function(a){return a.filter(function(b,c){var d=!0;if(n[b.style]===n.hr)0===c||a.length-1===c?d=!1:n.hr===n[a[c-1].style]&&(d=!1);else if(n[b.style]===
n.noemphasis_title){var g=a[c+1];g?n[g.style]===n.noemphasis_title&&(d=!1):d=!1}return d})})},setEditorContextProvider:function(a){this.editorContextProvider=a},_generateProviderId:function(){this._idcount?this._idcount++:this._idcount=0;return"ContentAssistGeneratedID_"+this._idcount},setAutoTriggerEnabled:function(a){this._autoTriggerEnabled=a;this._updateAutoTriggerListenerState()},setProviders:function(a){var b=this;this.setProviderInfoArray(a.map(function(a){return a.id?a:{provider:a,id:b._generateProviderId()}}))},
setProviderInfoArray:function(a){this.clearProviders();this._providers=a;this._charTriggersInstalled=a.some(function(a){return a.charTriggers});this._updateAutoTriggerListenerState()},getProviders:function(){return this._providers.slice()},clearProviders:function(){this._providers=[];this._charTriggersInstalled=!1;this._updateAutoTriggerListenerState()},setProgress:function(a){this.progress=a},setStyleAccessor:function(a){this._styleAccessor=a},_flatten:function(a){return a.reduce(function(a,b){var c=
a,d=null;b&&Array.isArray(b)&&(d=b.filter(function(a){return a}));if(d&&Array.isArray(d)&&0<d.length){var c=d,g=a,k=d[0].style;k&&(n[k]&&0===n[k].indexOf(n.noemphasis))&&(c=a,g=d);0<c.length&&(d=c[c.length-1].style)&&n.hr!==n[d]&&(c=c.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}));c=c.concat(g)}return c},[])},_triggerListener:function(){var a=this.textView.getCaretOffset(),b=null,c=[];if(this._charTriggersInstalled){var d=this.textView.getText(a-
1,a);this._providers.forEach(function(k){var f=k.charTriggers;if(f&&f.test(d)){var f=!1,h=k.excludedStyles;this._styleAccessor&&h&&(b||(b=this._styleAccessor.getStyles(a-1)),f=b.some(function(a){return h.test(a.style)}));f||c.push(k)}},this);0<c.length&&this.activate(c,!0)}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this));if(this._triggerListenerInstalled){if(!this._autoTriggerEnabled||!this._charTriggersInstalled)this.textView.removeEventListener("Modify",
this._boundTriggerListener),this._triggerListenerInstalled=!1}else this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)},_addTextViewListeners:function(){this._textViewListenersAdded||(this.textView.addEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.addEventListener("Scroll",this._textViewListeners.onScroll),this.textView.addEventListener("Selection",this._textViewListeners.onSelection),
this._textViewListenersAdded=!0)},_removeTextViewListeners:function(){this._textViewListenersAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.removeEventListener("Scroll",this._textViewListeners.onScroll),this.textView.removeEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!1)},_updateFilterText:function(a){var b=a.removedCharCount;b&&(this._filterText=this._filterText.substring(0,
this._filterText.length-b));if(a=a.text)this._filterText=this._filterText.concat(a)}};d.EventTarget.addMixin(k.prototype);c.prototype=new v.KeyMode;m.mixin(c.prototype,{createKeyBindings:function(){var a=x.KeyBinding,c=[];c.push({actionID:"contentAssistApply",keyBinding:new a(13)});c.push({actionID:"contentAssistCancel",keyBinding:new a(27)});c.push({actionID:"contentAssistNextProposal",keyBinding:new a(40)});c.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});c.push({actionID:"contentAssistNextPage",
keyBinding:new a(34)});c.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});c.push({actionID:"contentAssistHome",keyBinding:new a(b.KEY.HOME)});c.push({actionID:"contentAssistEnd",keyBinding:new a(b.KEY.END)});c.push({actionID:"contentAssistTab",keyBinding:new a(9)});return c},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},
setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(a,b){return this.selectNew(a,b,!1)},lineDown:function(a,b){return this.selectNew(a,b,!0)},selectNew:function(a,b,c){if(c){if(void 0===a&&(a=this.selectedIndex+1),a>=this.proposals.length){if(b)return!0;a=0}}else if(void 0===a&&(a=this.selectedIndex-1),0>a){if(b)return!0;a=this.proposals.length-1}for(var d=a;this.proposals[a]&&this.proposals[a].unselectable;){if(c){if(a++,
a>=this.proposals.length){if(b)return!0;a=0}}else if(a--,0>a){if(b)return!0;a=this.proposals.length-1}if(a===d){a=-1;break}}this.selectedIndex=a;this.widget&&this.widget.selectNode(a);this._showTooltip(!0);return!0},_showTooltip:function(a){var b=h.Tooltip.getTooltip(this.contentAssist.textView),c=this,d={getTooltipInfo:function(){var a=c.widget.parentNode.getBoundingClientRect(),b={width:350,height:a.height,top:a.top};a.left+a.width>=document.documentElement.clientWidth?(b.left=a.left-b.width,b.left-=
10):(b.left=a.left+a.width,b.left+=10);return{context:{proposal:c.proposals[c.selectedIndex]},anchorArea:a,tooltipArea:b}}};a?b.update(d):b.show(d,!0,!1)},_hideTooltip:function(){h.Tooltip.getTooltip(this.contentAssist.textView).hide()},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());return 0===a?this.lineDown(a,!0):this.lineUp(a,!0)}return this.lineUp()},pageDown:function(){if(this.widget){var a=
this.widget.getBottomIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this.lineDown(a,!0)}return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}});f.prototype={onClick:function(a){a||(a=window.event);this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},onScroll:function(a){this.previousCloneNode&&
!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(n.selected));this.preserveCloneThroughScroll=!1},createDiv:function(a,b,c){var d=b.ownerDocument,k=q.createElement(d,"div");k.id="contentoption"+c;k.setAttribute("role","option");k.className=n[a.style]?n[a.style]:n.dfault;"hr"===a.style?a=q.createElement(d,"hr"):(a=this._createDisplayNode(k,a,c),k.contentAssistProposalIndex=c);k.appendChild(a);b.appendChild(k)},createAccessible:function(){var a=this._contentAssistMode,
c=this;s.addEventListener(this.parentNode,"keydown",function(d){d||(d=window.event);d.preventDefault&&d.preventDefault();return d.keyCode===b.KEY.ESCAPE?a.cancel():d.keyCode===b.KEY.UP?a.lineUp():d.keyCode===b.KEY.DOWN?a.lineDown():d.keyCode===b.KEY.ENTER?a.enter():d.keyCode===b.KEY.PAGEDOWN?a.pageDown():d.keyCode===b.KEY.PAGEUP?a.pageUp():d.keyCode===b.KEY.HOME?(c.scrollIndex(0,!0),a.lineDown(0)):d.keyCode===b.KEY.END?a.lineUp(a.getProposals().length-1):!1})},_createDisplayNode:function(a,b,c){var d=
a=null;if("string"===typeof b)d=b;else if(b.description&&"string"===typeof b.description)if(b.name&&"string"===typeof b.name){var k=this._createNameNode(b.name);k.contentAssistProposalIndex=c;a=document.createElement("span");a.appendChild(k);b=document.createTextNode(b.description);a.appendChild(b)}else d=b.description;else d=b.proposal;d&&(a=this._createNameNode(d));a.contentAssistProposalIndex=c;return a},_createNameNode:function(a){var b=document.createElement("span");b.classList.add("proposal-name");
b.appendChild(document.createTextNode(a));return b},getProposal:function(a){var b=null;a=a.contentAssistProposalIndex;void 0!==a&&(b=this._contentAssistMode.getProposals()[a]||null);return b},getTopIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++)if(a[b].offsetTop>=this.parentNode.scrollTop)return b;return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++){var c=a[b];if(c.offsetTop+c.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,
b-1)}return a.length-1},scrollIndex:function(a,b){var c=this.parentNode.childNodes[a];c&&(c.scrollIntoView(b),this.preserveCloneThroughScroll=!0)},selectNode:function(a){var b=null;this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null);this._fadeTimer&&(window.clearTimeout(this._fadeTimer),this._fadeTimer=null);this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(n.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode());
if(-1!==a&&(b=this.parentNode.childNodes[a])){b.classList.add(n.selected);this.parentNode.setAttribute("aria-activedescendant",b.id);b.focus();b.offsetTop<this.parentNode.scrollTop?(b.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):b.offsetTop+b.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(b.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var c=(b.firstChild||b).getBoundingClientRect(),d=this.parentNode.clientWidth?this.parentNode.clientWidth:this.parentNode.getBoundingClientRect();
a=window.getComputedStyle(this.parentNode);var k=window.getComputedStyle(b),k=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+parseInt(k.paddingLeft)+parseInt(k.paddingRight);if(c.width>=d-k){k=parseInt(a.top);d=b.cloneNode(!0);d.classList.add("cloneProposal");d.style.top=k+b.offsetTop-this.parentNode.scrollTop+"px";d.style.left=a.left;d.setAttribute("id",d.id+"_clone");c=c.left+c.width-parseInt(document.documentElement.clientWidth);0<c&&(a=parseInt(a.left)-c,0>a&&(a=0),d.style.left=a+"px");var f=
document.createElement("div");f.id="clone_contentassist";f.classList.add("contentassist");f.classList.add("cloneWrapper");f.appendChild(d);f.onclick=this.parentNode.onclick;this.parentNode.parentNode.insertBefore(f,this.parentNode);var h=function(a){a.contentAssistProposalIndex=b.contentAssistProposalIndex;if(a.hasChildNodes())for(var c=0;c<a.childNodes.length;c++)h(a.childNodes[c])};h(f);var p=this;this._hideTimeout=window.setTimeout(function(){p._hideTimeout=null;b.classList.add(n.selected);var a=
1;p._fadeTimer=window.setInterval(function(){!p.previousCloneNode||0.01>=a?(p._removeCloneNode(),window.clearInterval(p._fadeTimer),p._fadeTimer=null):(f.style.opacity=a,f.style.filter="alpha(opacity\x3d"+100*a+")",a-=0.1*a)},50)},1500);b.classList.remove(n.selected);this.previousCloneNode=f}}this.previousSelectedNode=b},setContentAssistMode:function(a){this._contentAssistMode=a},show:function(){var a=this._contentAssistMode.getProposals();if(0===a.length)this.hide();else{this.parentNode.innerHTML=
"";for(var b=0;b<a.length;b++)this.createDiv(a[b],this.parentNode,b);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0;this._contentAssistMode._showTooltip(!1);this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=
!1;this._contentAssistMode._hideTooltip();this.textViewListenerAdded&&(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1);this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var a=this.contentAssist,b=this.textView;if(void 0!==a.offset){var a=a.offset,c=b.getModel();c.getBaseModel&&(a=c.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=b.getLocationAtOffset(a);
a.y+=b.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;c=this.parentNode.ownerDocument;b=c.documentElement.clientWidth;c=c.documentElement.clientHeight-a.y;if(this.parentNode.offsetHeight>c){var d=a.y-this.textView.getLineHeight();this.parentNode.offsetHeight>d?c>d?this.parentNode.style.maxHeight=c+"px":(this.parentNode.style.maxHeight=
d+"px",this.parentNode.style.top="0"):(this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px",this.parentNode.style.maxHeight=d+"px")}else this.parentNode.style.maxHeight=c+"px";a.x+this.parentNode.offsetWidth>b?(a=b-this.parentNode.offsetWidth,0>a&&(a=0),this.parentNode.style.left=a+"px",this.parentNode.style.maxWidth=b-a):this.parentNode.style.maxWidth=b+a.x+"px"},_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode);
this.previousCloneNode=null}};return{ContentAssist:k,ContentAssistMode:c,ContentAssistWidget:f}});
define("orion/editor/textStyler",["orion/editor/annotations","orion/editor/eventTarget","orion/metrics"],function(t,x,v){function d(b,a,d){this._patternManager=new l(b,a);this._contentType=d}function l(b,a){this._unnamedCounter=0;this._patterns=[];this._rootId=a;b.forEach(function(a){this._addRepositoryPatterns(a.repository||{},a.id);this._addPatterns(a.patterns||[],a.id)}.bind(this))}function m(b,a,d,c,f,h,n){this.start=b.start;this.end=b.end;this.contentStart=b.contentStart;this.contentEnd=b.contentEnd;
this.name=a;this.typeId=d;this.styler=c;this.parent=h;n&&n(this);this._subBlocks=c.computeBlocks(f,f.getText(this.contentStart,this.end),this,this.contentStart,null,null,null)}function h(b){this._styler=b}function s(b,a,d){this._highlightCaretLine=this._whitespacesVisible=!1;this._detectTasks=this._foldingEnabled=!0;this._annotationProviders=[];this._view=b;this._annotationModel=a;this._stylerAdapter=d;this._stylerAdapter.setStyler(this);this._accessor=new h(this);this._bracketAnnotations;var c=this;
this._listener={onChanged:function(a){c._onModelChanged(a)},onDestroy:function(a){c._onDestroy(a)},onLineStyle:function(a){c._onLineStyle(a)},onMouseDown:function(a){c._onMouseDown(a)},onSelection:function(a){c._onSelection(a)}};var f=b.getModel();f.getBaseModel&&(f=f.getBaseModel());f.addEventListener("Changed",this._listener.onChanged);b.addEventListener("MouseDown",this._listener.onMouseDown);b.addEventListener("Selection",this._listener.onSelection);b.addEventListener("Destroy",this._listener.onDestroy);
b.addEventListener("LineStyle",this._listener.onLineStyle);var p=f.getCharCount(),n={start:0,contentStart:0,end:p,contentEnd:p};if(5E4<=p)var g=(new Date).getTime();this._rootBlock=this._stylerAdapter.createBlock(n,this,f,null);g&&(n=(new Date).getTime()-g,10<n&&v.logTiming("editor","styler compute blocks (ms/50000 chars)",5E4*n/p,d.getContentType()));a&&(d=[],a.removeAnnotations(t.AnnotationType.ANNOTATION_FOLDING),this._computeFolding(this._rootBlock.getBlocks(),b.getModel(),d),this._detectTasks&&
(a.removeAnnotations(t.AnnotationType.ANNOTATION_TASK),this._computeTasks(this._rootBlock,f,d)),a.replaceAnnotations([],d));b.redrawLines()}var q=function(b,a,d,c,f){var h;void 0===c&&(c=-1);void 0===f&&(f=b.length);for(;1<f-c;)if(h=Math.floor((f+c)/2),a<=b[h].start)f=h;else if(d&&a<b[h].end){f=h;break}else c=h;return f};d.prototype={blockSpansBeyondEnd:function(b){return b.pattern.regexEnd===this._eolRegex},computeBlocks:function(b,a,d,c,f,h,n){if(!a)return[];var g=[],l=[],r;f=f||0;h=h||Infinity;
n=n||Infinity;d.blockPatterns.forEach(function(b){(r=this._findMatch(b.regexBegin||b.regex,a,f))&&l.push({result:r,pattern:b})}.bind(this));if(!l.length)return g;l.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var m=0;0<l.length;){var q=l[0];l.splice(0,1);if(h<q.result.index)break;if(!(q.result.index<m)){var m=c+q.result.index,s=q.result.index,t=null,v=q.pattern.regexEnd;if(v){var s=s+q.result[0].length,
e=q.pattern,u=this._substituteCaptureValues(v,q.result);u!==v&&(e={pattern:e.pattern,regexBegin:e.regexBegin,regexEnd:u},v=u);for(u=s;!t;){r=this._findMatch(v,a,u);r||(this._eolRegex.lastIndex=0,r=this._eolRegex.exec(a),e={pattern:e.pattern,regexBegin:e.regexBegin,regexEnd:this._eolRegex});var u=this.createBlock({start:m,end:c+r.index+r[0].length,contentStart:c+s,contentEnd:c+r.index},d.styler,b,d,e),x=u.getBlocks();if(!x.length||x[x.length-1].end<=r.index+c)t=u;u=r.index+r[0].length}}else t=this.createBlock({start:m,
end:m+q.result[0].length,contentStart:m,contentEnd:m+q.result[0].length},d.styler,b,d,q.pattern);g.push(t);if(g.length===n||h<=t.end)break;m=t.end-c}this._updateMatch(q,a,l,m,h)}return g},computeStyle:function(b,a,d){if(!b.pattern)return null;var c={start:b.start,end:b.end,style:b.pattern.pattern.name};if(b.contentStart<=d&&d<b.contentEnd)return b.pattern.pattern.contentName?{start:b.contentStart,end:b.contentEnd,style:b.pattern.pattern.contentName}:c;var f,h;if(d<b.contentStart){h=b.pattern.pattern.beginCaptures||
b.pattern.pattern.captures;if(!h)return c;f=b.pattern.regexBegin;a=a.getText(b.start,b.contentStart);b=b.start}else{h=b.pattern.pattern.endCaptures||b.pattern.pattern.captures;if(!h)return c;f=b.pattern.regexEnd;a=a.getText(b.contentEnd,b.end);b=b.contentEnd}f.lastIndex=0;if(f=f.exec(a))if(a=[],this._getCaptureStyles(f,h,b,a),(h=a[q(a,d,!0)])&&h.start<=d&&d<h.end)return h;return c},createBlock:function(b,a,d,c,f){return new m(b,f?f.pattern.name:null,f?f.pattern.id:null,a,d,c,function(a){a.pattern=
f;a.linePatterns=[];a.blockPatterns=[];a.enclosurePatterns={};this._initPatterns(this._patternManager,a)}.bind(this))},getBlockContentStyleName:function(b){return b.pattern.pattern.contentName||b.pattern.pattern.name},getBlockEndStyle:function(b,a,d,c){var f;if(b.pattern.regexEnd&&(f=this._findMatch(b.pattern.regexEnd,a,0)))(a=b.pattern.pattern.endCaptures||b.pattern.pattern.captures)?this._getCaptureStyles(f,a,d-f[0].length,c):b.pattern.pattern.name&&c.push({start:d-f[0].length,end:d,style:b.pattern.pattern.name});
return f?f[0]:null},getBlockFoldBounds:function(b,a){return{start:b.start,end:b.end}},getBlockStartStyle:function(b,a,d,c){var f;if(b.pattern.regexBegin&&(f=this._findMatch(b.pattern.regexBegin,a,0)))(a=b.pattern.pattern.beginCaptures||b.pattern.pattern.captures)?this._getCaptureStyles(f,a,d,c):c.push({start:d,end:d+f[0].length,style:b.pattern.pattern.name});return f?f[0]:null},getBracketMatch:function(b,a){for(var d,c=Object.keys(b.enclosurePatterns),f=0;f<c.length;f++){var h=b.enclosurePatterns[c[f]],
n=this._findMatch(h.regex,a,0);if(n&&0===n.index){d=h;break}}if(!d)return null;f=!1;-1!==d.pattern.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)?(f=!0,c=d.pattern.name.replace(this._PUNCTUATION_SECTION_BEGIN,this._PUNCTUATION_SECTION_END)):c=d.pattern.name.replace(this._PUNCTUATION_SECTION_END,this._PUNCTUATION_SECTION_BEGIN);return!b.enclosurePatterns[c]?null:{beginName:d.pattern.name,endName:c,atStart:f}},getContentType:function(){return this._contentType},parse:function(b,a,d,c,f,h){if(b&&(c=c.linePatterns)){var n=
[],g;c.forEach(function(a){var c=a.regex||a.regexBegin;c.oldLastIndex=c.lastIndex;(g=this._findMatch(c,b,d))&&n.push({result:g,pattern:a})}.bind(this));n.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var l=d;0<n.length;){var r=n[0];n.splice(0,1);if(!(r.result.index<l)){var m=r.result.index,q,l=[];if(r.pattern.regex){g=r.result;q=m+g[0].length;q={start:a+m,end:a+q,style:r.pattern.pattern.name};if(!h){r.pattern.pattern.captures&&
this._getCaptureStyles(g,r.pattern.pattern.captures,a+m,l);l.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(m=0;m<l.length-1;m++)if(l[m+1].start<l[m].end){var s={start:l[m+1].end,end:l[m].end,style:l[m].style};l[m].end=l[m+1].start;l.splice(m+2,0,s)}}this._mergeStyles(q,l,f)}else l=r.pattern.regexEnd,l=this._substituteCaptureValues(l,r.result),g=this._findMatch(l,b,r.result.index+r.result[0].length),g||(this._eolRegex.lastIndex=0,g=this._eolRegex.exec(b)),q=g.index+g[0].length,
f.push({start:a+m,end:a+q,style:r.pattern.pattern.name});l=g.index+g[0].length}this._updateMatch(r,b,n,l)}c.forEach(function(a){a=a.regex||a.regexBegin;a.lastIndex=a.oldLastIndex})}},setStyler:function(b){},verifyBlock:function(b,a,d,c){var f=null,h=[],n;d.parent.blockPatterns.forEach(function(b){(n=this._findMatch(b.regexBegin||b.regex,a,0))&&h.push({result:n,pattern:b})}.bind(this));h.sort(function(a,b){return!a.result.index&&b.result.index?-1:a.result.index&&!b.result.index?1:!a.result.index&&
!b.result.index?a.pattern.pattern.index<b.pattern.pattern.index?-1:1:0});if(!h.length||0!==h[0].result.index||h[0].pattern.pattern.id!==d.pattern.pattern.id)f=!1;else{n=h[0];var g=n.pattern.regexEnd;if(g){for(var g=this._substituteCaptureValues(g,n.result),l=n.result[0].length,m=this._findMatch(g,a,l);null===f&&m&&d.start+m.index!==d.contentEnd+c;){var q=this.computeBlocks(b,a,d,d.start,l,m.index+1,null);!q.length||q[q.length-1].end<=d.start+m.index?f=!1:q.length?(l=q[q.length-1].end-d.start,m=this._findMatch(g,
a,l)):m=null}m||(this._eolRegex.lastIndex=0,m=this._eolRegex.exec(a),f=d.start+m.index===d.end+c)}else f=d.start+n.result[0].length===d.end+c}return null!==f?f:!0},_findMatch:function(b,a,d,c){var f=d,h=b.lastIndex;this._linebreakRegex.lastIndex=d;d=this._linebreakRegex.exec(a);var n,g;b.lastIndex=0;if(d){for(g=d.index;0<=--g&&!(n=a.charAt(g),n===this._NEWLINE||n===this._CR););n=a.substring(g+1,d.index+d[1].length);b.lastIndex=g=d.index-g-1}for(;d&&d.index<a.length;){var l;if(c){var m=b.lastIndex;
b.test(n)&&(b.lastIndex=m,l=b.exec(n))}else l=b.exec(n);if(l)return l.index+=f,l.index-=g,b.lastIndex=h,l;g=0;f+=d[0].length;if(d=this._linebreakRegex.exec(a))n=d[1],b.lastIndex=0}b.lastIndex=h;return null},_getCaptureStyles:function(b,a,d,c){if(a[0])c.push({start:d,end:d+b[0].length,style:a[0].name});else for(var f=0,h=1;h<b.length;h++)if(b[h]){var l=a[h];if(l){var g=d+f;c.push({start:g,end:g+b[h].length,style:l.name})}f+=b[h].length}},_initPatterns:function(b,a){if(a.pattern&&a.pattern.pattern.linePatterns)a.linePatterns=
a.pattern.pattern.linePatterns,a.blockPatterns=a.pattern.pattern.blockPatterns,a.enclosurePatterns=a.pattern.pattern.enclosurePatterns;else{var d=b.getPatterns(a.pattern?a.pattern.pattern:null),c=function(a){a="string"===typeof a?a:a.match;var b=this._ignoreCaseRegex.exec(a),c=this._FLAGS;b&&(a=a.substring(b[0].length),c+="i");return RegExp(a,c)}.bind(this),f=-1,h=0;d.forEach(function(b){var d;if(b.match&&!b.begin&&!b.end){if(d={regex:c(b.match),pattern:b},a.linePatterns.push(d),b.name&&0===b.name.indexOf("punctuation.section")&&
(-1!==b.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)||-1!==b.name.indexOf(this._PUNCTUATION_SECTION_END)))a.enclosurePatterns[b.name]=d}else!b.match&&(b.begin&&b.end)&&(f=h,d={regexBegin:c(b.begin),regexEnd:c(b.end),pattern:b},a.linePatterns.push(d));h++}.bind(this));a.blockPatterns=a.linePatterns.slice(0,f+1);a.pattern&&(a.pattern.pattern.enclosurePatterns=a.enclosurePatterns,a.pattern.pattern.linePatterns=a.linePatterns,a.pattern.pattern.blockPatterns=a.blockPatterns)}},_mergeStyles:function(b,
a,d){var c=b.start;a.forEach(function(a){c<=a.start&&d.push({start:c,end:a.start,style:b.style});d.push(a);c=a.end});c<b.end&&d.push({start:c,end:b.end,style:b.style})},_substituteCaptureValues:function(b,a){var d=b.toString();this._captureReferenceRegex.lastIndex=0;if(!this._captureReferenceRegex.test(d))return b;this._captureReferenceRegex.lastIndex=0;for(var c=this._captureReferenceRegex.exec(d);c;)d=d.replace(c[0],a[c[1]]||""),this._captureReferenceRegex.lastIndex=0,c=this._captureReferenceRegex.exec(d);
return RegExp(d.substring(1,d.length-1-this._FLAGS.length),this._FLAGS)},_updateMatch:function(b,a,d,c,f){var h=b.pattern.regex?b.pattern.regex:b.pattern.regexBegin;f=f||Infinity;if((a=this._findMatch(h,a,c,!0))&&a.index<f){b.result=a;for(f=0;f<d.length;f++)if(a.index<d[f].result.index||a.index===d[f].result.index&&b.pattern.pattern.index<d[f].pattern.pattern.index){d.splice(f,0,b);return}d.push(b)}},_captureReferenceRegex:/\\(\d)/g,_eolRegex:/$/,_ignoreCaseRegex:/^\(\?i\)\s*/,_linebreakRegex:/(.*)(?:[\r\n]|$)/g,
_CR:"\r",_FLAGS:"g",_NEWLINE:"\n",_PUNCTUATION_SECTION_BEGIN:".begin",_PUNCTUATION_SECTION_END:".end"};l.prototype={getPatterns:function(b){b?(b="string"===typeof b?b:b.qualifiedId,b+="#"):b=this._rootId+"#"+this._NO_ID;var a=[0],d={},c=RegExp("^"+b+"[^#]+$");this._patterns.forEach(function(b){if(c.test(b.qualifiedId))if(b.include)this._processInclude(b,a,d);else{var f=JSON.parse(JSON.stringify(b));f.index=a[0]++;d[b.qualifiedId]=f}}.bind(this));var f=[];Object.keys(d).forEach(function(a){f.push(d[a])});
return f},_addPattern:function(b,a,d){b.parentId=d;b.id=a;b.qualifiedId=b.parentId+"#"+b.id;this._patterns.push(b);b.patterns&&!b.include&&this._addPatterns(b.patterns,b.qualifiedId)},_addPatterns:function(b,a){b.forEach(function(b){this._addPattern(b,this._NO_ID+this._unnamedCounter++,a)}.bind(this))},_addRepositoryPatterns:function(b,a){Object.keys(b).forEach(function(d){this._addPattern(b[d],d,a)}.bind(this))},_processInclude:function(b,a,d){var c,f=b.include.indexOf("#");c=0===f?RegExp("^"+b.qualifiedId.substring(0,
b.qualifiedId.indexOf("#"))+b.include+"$"):-1===f?RegExp("^"+b.include+"#"+this._NO_ID+"[^#]+$"):RegExp("^"+b.include+"$");this._patterns.forEach(function(b){if(c.test(b.qualifiedId))if(b.include)this._processInclude(b,a,d);else if(!d[b.qualifiedId]){var f=JSON.parse(JSON.stringify(b));f.index=a[0]++;d[b.qualifiedId]=f}}.bind(this))},_NO_ID:"NoID"};m.prototype={adjustBounds:function(b,a){b<this.start&&(this.start+=a);b<this.contentStart&&(this.contentStart+=a);b<=this.end&&(this.end+=a);b<=this.contentEnd&&
(this.contentEnd+=a);this._subBlocks.forEach(function(d){b<=d.end&&d.adjustBounds(b,a)})},getBlocks:function(){return this._subBlocks},getBlockAtIndex:function(b){return q(this.getBlocks(),b,!0)},isRenderingWhitespace:function(){return this.styler._isRenderingWhitespace()}};h.prototype={getStyles:function(b){return this._styler.getStyles(b)}};s.prototype={addAnnotationProvider:function(b){"function"===typeof b&&this._annotationProviders.push(b)},computeBlocks:function(b,a,d,c,f,h,l){return this._stylerAdapter.computeBlocks(b,
a,d,c,f,h,l)},destroy:function(){if(this._view){var b=this._view.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);this._view.removeEventListener("MouseDown",this._listener.onMouseDown);this._view.removeEventListener("Selection",this._listener.onSelection);this._view.removeEventListener("Destroy",this._listener.onDestroy);this._view.removeEventListener("LineStyle",this._listener.onLineStyle);this._view=null}},getAnnotationModel:function(){return this._annotationModel},
getBlockAtIndex:function(b){return this._findBlock(this._rootBlock,b)},getRootBlock:function(){return this._rootBlock},getStyleAccessor:function(){return this._accessor},getStyles:function(b){var a=[],d=this._view.getModel();d.getBaseModel&&(d=d.getBaseModel());var c=this._findBlock(this._rootBlock,b),f=d.getLineAtOffset(b),h=d.getLine(f),l=[];this._stylerAdapter.parse(h,d.getLineStart(f),0,c,l);for((f=l[q(l,b,!0)])&&(f.start<=b&&b<f.end)&&a.push(f);c;)(f=this._stylerAdapter.computeStyle(c,d,b))&&
a.splice(0,0,f),c=c.parent;return a},getTextModel:function(){var b=this._view.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},removeAnnotationProvider:function(b){"function"===typeof b&&(b=this._annotationProviders.indexOf(b),-1!==b&&this._annotationProviders.splice(b,1))},setDetectHyperlinks:function(){},setDetectTasks:function(b){this._detectTasks=b},setFoldingEnabled:function(b){this._foldingEnabled=b},setHighlightCaretLine:function(b){this._highlightCaretLine=b},setWhitespacesVisible:function(b,
a){this._whitespacesVisible!==b&&(this._whitespacesVisible=b,a&&this._view.redraw())},_computeFolding:function(b,a,d){if(a.getBaseModel){var c=a.getBaseModel();b.forEach(function(b){var h=this._stylerAdapter.getBlockFoldBounds(b,c);(h=this._createFoldingAnnotation(a,c,h.start,h.end))&&d.push(h);this._computeFolding(b.getBlocks(),a,d)}.bind(this))}},_computeTasks:function(b,a,d,c,f){c=c||b.start;f=f||b.end;if(b.start<=f&&c<=b.end&&this._annotationModel){var h=t.AnnotationType.ANNOTATION_TASK;if(b.name&&
0===b.name.indexOf("comment")){var l=[],g=a.getLineAtOffset(b.contentStart),g=a.getLineStart(g);this._stylerAdapter.parse(a.getText(g,b.end),g,b.contentStart-g,b,l,!0);for(g=0;g<l.length;g++)"meta.annotation.task.todo"===l[g].style&&(c<=l[g].start&&l[g].end<=f)&&d.push(t.AnnotationType.createAnnotation(h,l[g].start,l[g].end,a.getText(l[g].start,l[g].end)))}b.getBlocks().forEach(function(b){this._computeTasks(b,a,d,c,f)}.bind(this))}},_createFoldingAnnotation:function(b,a,d,c){var f=a.getLineAtOffset(d),
h=a.getLineAtOffset(c);return f===h||f+1===h&&a.getLineStart(h)===a.getLineEnd(h)?null:new (t.AnnotationType.getType(t.AnnotationType.ANNOTATION_FOLDING))(d,c,b)},_findBlock:function(b,a){var d=b.getBlocks();if(!d.length)return b;var c=q(d,a,!0);return c<d.length&&d[c].start<=a&&a<d[c].end?this._findBlock(d[c],a):b},_findBrackets:function(b,a,d,c,f,h){for(var l=[],g=[],m=f,r=d.getBlocks(),s=q(r,f,!0);s<r.length&&!(r[s].start>=h);s++){var t=r[s].start,v=r[s].end;if(m<t){var x=b.getLineAtOffset(m),
x=b.getLineStart(x);this._stylerAdapter.parse(c.substring(x-f,t-f),x,m-x,d,g);g.forEach(function(b){b.style&&(0===b.style.indexOf(a.beginName)?l.push(b.start+1):0===b.style.indexOf(a.endName)&&l.push(-(b.start+1)))});g=[]}m=v}m<h&&(x=b.getLineAtOffset(m),x=b.getLineStart(x),this._stylerAdapter.parse(c.substring(x-f,h-f),x,m-x,d,g),g.forEach(function(b){b.style&&(0===b.style.indexOf(a.beginName)?l.push(b.start+1):0===b.style.indexOf(a.endName)&&l.push(-(b.start+1)))}));return l},_findMatchingBracket:function(b,
a,d){var c=b.getLineAtOffset(d),f=b.getLineEnd(c),h=b.getText(d,f),h=this._stylerAdapter.getBracketMatch(a,h);if(!h)return-1;for(var l=b.getLine(c),g=b.getLineStart(c),f=this._findBrackets(b,h,a,l,g,f),m=0;m<f.length;m++)if(l=0<=f[m]?1:-1,f[m]*l-1===d){d=1;if(h.atStart){for(m++;m<f.length;m++)if(l=0<=f[m]?1:-1,d+=l,0===d)return f[m]*l-1;c+=1;for(m=b.getLineCount();c<m;){l=b.getLine(c);g=b.getLineStart(c);f=b.getLineEnd(c);f=this._findBrackets(b,h,a,l,g,f);for(g=0;g<f.length;g++)if(l=0<=f[g]?1:-1,
d+=l,0===d)return f[g]*l-1;c++}}else{for(m--;0<=m;m--)if(l=0<=f[m]?1:-1,d+=l,0===d)return f[m]*l-1;for(c-=1;0<=c;){l=b.getLine(c);g=b.getLineStart(c);f=b.getLineEnd(c);f=this._findBrackets(b,h,a,l,g,f);for(m=f.length-1;0<=m;m--)if(l=0<=f[m]?1:-1,d+=l,0===d)return f[m]*l-1;c--}}break}return-1},_getLineStyle:function(b){if(this._highlightCaretLine){var a=this._view,d=a.getModel(),c=!1;if(!a.getSelections().some(function(a){return a.start===a.end?(c=c||d.getLineAtOffset(a.start)===b,!1):!0})&&c)return this._caretLineStyle}return null},
_getStyles:function(b,a,d,c,f){var h=c+d.length,l=[],g=c+f;f=b.getBlocks();for(var m=q(f,g,!0);m<f.length&&!(f[m].start>=h);m++){var r=f[m].start,s=f[m].end;if(g<r){var t=a.getLineAtOffset(g),t=a.getLineStart(t);this._stylerAdapter.parse(d.substring(t-c,r-c),t,g-t,b,l)}var v=Math.max(g,r);v===r&&(r=this._stylerAdapter.getBlockStartStyle(f[m],d.substring(v-c),v,l))&&(v+=r.length);var r=Math.min(h,s),x=[];r===s&&(g=d.substring(r-g-(f[m].end-f[m].contentEnd)),(g=this._stylerAdapter.getBlockEndStyle(f[m],
g,r,x))&&(r-=g.length));var t=a.getLineAtOffset(v),t=a.getLineStart(t),g=this._getStyles(f[m],a,d.substring(t-c,r-c),t,v-t),D=this._stylerAdapter.getBlockContentStyleName(f[m]);if(D){var e=v;g.forEach(function(a){a.start-e&&l.push({start:e,end:a.start,style:D});a.mergeable&&(a.style+=","+D);l.push(a);e=a.end});r-e&&l.push({start:e,end:r,style:D})}else l=l.concat(g);l=l.concat(x);g=s}g<h&&(t=a.getLineAtOffset(g),t=a.getLineStart(t),this._stylerAdapter.parse(d.substring(t-c,h-c),t,g-t,b,l));return l},
_isRenderingWhitespace:function(){return this._whitespacesVisible},_onDestroy:function(){this.destroy()},_onLineStyle:function(b){b.textView===this._view&&(b.style=this._getLineStyle(b.lineIndex));var a=b.lineStart,d=b.textView.getModel();if(d.getBaseModel)var a=d.mapOffset(a),c=d.getBaseModel();b.ranges=this._getStyles(this._rootBlock,c||d,b.lineText,a,0);for(a=b.ranges.length-1;0<=a;a--){var f=b.ranges[a];if(f.style){if(f.style={styleClass:f.style.replace(/\./g," ")},c){var h=f.end-f.start;f.start=
d.mapOffset(f.start,!0);f.end=f.start+h}}else b.ranges.splice(a,1)}this._isRenderingWhitespace()&&(this._spliceStyles(this._spacePattern,b.ranges,b.lineText,b.lineStart),this._spliceStyles(this._tabPattern,b.ranges,b.lineText,b.lineStart))},_onModelChanged:function(b){var a=b.start,d=b.removedCharCount;b=b.addedCharCount-d;var c=this._view.getModel(),f=c.getBaseModel?c.getBaseModel():c,d=a+d,h=f.getCharCount(),l=f.getLineStart(f.getLineAtOffset(a)),g=this._findBlock(this._rootBlock,a),m,r,s,v,x,z,
D;do{s=g.parent;if(!m&&s){if(0>b&&g.end-a<=-b){g=s;continue}x=f.getText(g.start,Math.min(h,g.end+b+1));if(!this._stylerAdapter.verifyBlock(f,x,g,b)){g=s;continue}}r=g.getBlocks();var e=r.length,u=q(r,l,!0),B=q(r,d,!1,u-1,e);m=!1;if(u&&r.length&&r[u-1].end===a){x=f.getText(r[u-1].start,Math.min(h,a+1));var E=this.computeBlocks(f,x,g,r[u-1].start,null,null,null);E.length&&E[0].end!==r[u-1].end&&(u--,m=!0)}u<e&&r[u].start<=l&&(l<r[u].end||m)?(D=r[u].start,D>a&&(D+=b)):u===e&&0<e&&g.end-b===r[e-1].end?
(D=r[--u].start,D>a&&(D+=b)):D=Math.max(l,g.contentStart);z=B<e?r[B].end:g.contentEnd;a<=z&&(z+=b);z=Math.min(z,h-1);x=f.getText(D,z+1);E=this.computeBlocks(f,x,g,D,null,null,null);if(B<e){if(E.length&&E[E.length-1].end===z&&E[E.length-1].typeId===r[B].typeId)break;if(E.length&&this._stylerAdapter.blockSpansBeyondEnd(E[E.length-1])){B++;for(var J=E[E.length-1].getBlocks(),J=(J.length?J[J.length-1]:E[E.length-1]).typeId;B<e;){if(r[B].typeId===J){var K=r[B].end+b,K=Math.min(K,h-1);x=f.getText(D,K+1);
x=this.computeBlocks(f,x,g,D,null,null,null);if(x.length&&x[x.length-1].end===K){z=K;E=x;break}}B++}if(B<e)break}}else if(!E.length||E[E.length-1].end<=g.contentEnd+b)break;if(!s){z=h;B=e;x=f.getText(D,z);E=this.computeBlocks(f,x,g,D,null,null,null);break}g=s;v=!0}while(1);this._rootBlock.adjustBounds(a,b);B=Math.min(B+1,e);v||(v=B-u!==E.length);if(!v)for(e=0;e<E.length;e++)if(m=r[u+e],h=E[e],m.start!==h.start||m.end!==h.end||m.typeId!==h.typeId){v=!0;break}!r.length&&!E.length?(m=[g],this.dispatchEvent({type:"BlocksChanged",
oldBlocks:[g],newBlocks:m}),g=m[0]):this.dispatchEvent({type:"BlocksChanged",oldBlocks:r.slice(u,B),newBlocks:E});u=[u,B-u].concat(E);Array.prototype.splice.apply(r,u);v&&(r=D,v=z,c!==f&&(r=c.mapOffset(r,!0),v=c.mapOffset(v,!0)),this._view.redrawRange(r,v));if(this._annotationModel){var I=[],L=[],G=[];r=this._annotationModel.getAnnotations(D,z);v=this._foldingEnabled&&f!==c;for(u=g.parent||g;r.hasNext();)if(B=r.next(),v&&B.type===t.AnnotationType.ANNOTATION_FOLDING){G.push(B);for(m=this._findBlock(u,
B.start);m;){var M=this._stylerAdapter.getBlockFoldBounds(m,f);if(B.start===M.start&&B.end===M.end)break;m=m.parent}m&&B.start===M.start&&B.end===M.end?(E=B.start,m=B.end,E>a&&(E-=b),m>a&&(m-=b),E<=a&&(a<m&&E<=d&&d<m)&&(E=f.getLineAtOffset(B.start),m=f.getLineAtOffset(B.end),E!==m?B.expanded||B.expand():I.push(B))):(I.push(B),B.expand())}else B.type===t.AnnotationType.ANNOTATION_TASK&&g.start<=B.start&&B.end<=g.end&&I.push(B);v&&u.getBlocks().forEach(function(a){this._updateFolding(a,f,c,G,L,D,z)}.bind(this));
this._detectTasks&&this._computeTasks(g,f,L,D,z);this._annotationProviders.forEach(function(a){var b=[],c=[];a(this._annotationModel,f,g,D,z,b,c);I=I.concat(b);L=L.concat(c)}.bind(this));this._annotationModel.replaceAnnotations(I,L)}},_onMouseDown:function(b){if(2===b.clickCount){var a=this._view.getModel(),d=this._view.getOffsetAtLocation(b.x,b.y);if(0<d){var c=d-1,f=a;a.getBaseModel&&(c=a.mapOffset(c),f=a.getBaseModel());var h=this._findBlock(this._rootBlock,c),c=this._findMatchingBracket(f,h,c);
-1!==c&&(b.preventDefault(),b=c,a.getBaseModel&&(b=a.mapOffset(b,!0)),d>b&&(d--,b++),this._view.setSelection(b,d))}}},_onSelection:function(b){var a=Array.isArray(b.oldValue)?b.oldValue:[b.oldValue];b=Array.isArray(b.newValue)?b.newValue:[b.newValue];var d=this._view,c=d.getModel(),f;if(this._highlightCaretLine){var h=function(a){var b={};return a.some(function(a){if(a.isEmpty())b[c.getLineAtOffset(a.start).toString()]=!0;else return!0;return!1})?{}:b},a=h(a),h=h(b),l=function(a,b){for(var c in a)b[c]||
(f=c>>0,d.redrawLines(f,f+1))};l(a,h);l(h,a)}if(this._annotationModel){var a=this._bracketAnnotations,g,m;if(1===b.length&&b[0].isEmpty()&&0<(m=b[0].getCaret()))m-=1,c.getBaseModel&&(m=c.mapOffset(m),c=c.getBaseModel()),b=this._findBlock(this._rootBlock,m),b=this._findMatchingBracket(c,b,m),-1!==b&&(g=[t.AnnotationType.createAnnotation(t.AnnotationType.ANNOTATION_MATCHING_BRACKET,b,b+1),t.AnnotationType.createAnnotation(t.AnnotationType.ANNOTATION_CURRENT_BRACKET,m,m+1)]);this._bracketAnnotations=
g;this._annotationModel.replaceAnnotations(a,g)}},_spliceStyles:function(b,a,d,c){for(var f=b.regex,h=f.lastIndex=0,l=f.exec(d);l;){for(l=c+l.index;h<a.length&&!(l<a[h].end);)h++;var g={start:l,end:l+1,style:JSON.parse(JSON.stringify(b.style))};if(h<a.length&&a[h].start<=l){var m={start:l+1,end:a[h].end,style:a[h].style};a[h].end=l;a.splice(h+1,0,m);a.splice(h+1,0,g);h+=2;g.style.styleClass+=" "+a[h].style.styleClass}else a.splice(h,0,g),h++;l=f.exec(d)}},_updateFolding:function(b,a,d,c,f,h,l){h=
h||b.start;l=l||b.end;var g=this._stylerAdapter.getBlockFoldBounds(b,a);if(!b.doNotFold&&g.start<=l&&h<=g.end){var m=q(c,g.start,!0);m<c.length&&c[m].start===g.start&&c[m].end===g.end||(g=this._createFoldingAnnotation(d,a,g.start,g.end))&&f.push(g);b.getBlocks().forEach(function(b){this._updateFolding(b,a,d,c,f,h,l)}.bind(this))}},_caretLineStyle:{styleClass:"meta annotation currentLine"},_spacePattern:{regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},_tabPattern:{regex:/\t/g,
style:{styleClass:"punctuation separator tab",unmergeable:!0}}};x.EventTarget.addMixin(s.prototype);return{TextStyler:s,Block:m,createPatternBasedAdapter:function(b,a,h){return new d(b,a,h)}}});
define("orion/editor/edit","require orion/editor/textView orion/editor/textModel orion/editor/textTheme orion/editor/projectionTextModel orion/editor/editor orion/editor/editorFeatures orion/editor/contentAssist orion/editor/textStyler".split(" "),function(t,x,v,d,l,m,h,s,q){function b(a,b,c){for(var d;c&&c!==b&&"none"!==d;)d=a.getComputedStyle?a.getComputedStyle(c,null).getPropertyValue("display"):c.currentStyle.display,c=c.parentNode;return!c||!d?"none":d}function a(a){var c=a.firstChild;if(c&&
"TEXTAREA"===c.tagName)return c.value;var d=a.ownerDocument,f=d.defaultView||d.parentWindow;if(!f.getSelection||1===a.childNodes.length&&c.nodeType===Node.TEXT_NODE||"none"===b(f,d,a))return a.innerText||a.textContent;c=d.createRange();c.selectNode(a);a=f.getSelection();f=[];for(d=0;d<a.rangeCount;d++)f.push(a.getRangeAt(d));a.removeAllRanges();a.addRange(c);c=a.toString();a.removeAllRanges();for(d=0;d<f.length;d++)a.addRange(f[d]);return c}function k(a){if("data-editor-"===a.substring(0,12))return a=
a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function f(a,b){var d={};c(d,b);for(var f,g=0,h=a.attributes,e=h.length;g<e;g++){f=h.item(g);var l=k(f.nodeName);if(l){f=f.nodeValue;if("true"===f||"false"===f)f="true"===f;d[l]=f}}return d}function p(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);b=b.replace(/ *$/,"");return a.querySelectorAll?a.querySelectorAll((" "+b).replace(/ +/g,
".")):null}function n(c){var g=c.document||document,k=c.parent;k||(k="editor");"string"===typeof k&&(k=g.getElementById(k));if(!k&&c.className){var w=p(g,c.className);if(w){c.className=void 0;1<w.length&&void 0===c.noFocus&&(c.noFocus=!0);for(var g=[],z=w.length-1;0<=z;z--)c.parent=w[z],g.push(n(c));return g}}if(!k)throw Error("no parent");c=f(k,c);if("string"===typeof c.theme){var w=d.TextTheme.getTheme(c.theme),D=c.theme.lastIndexOf("/"),e=c.theme;-1!==D&&(e=e.substring(D+1));".css"===e.substring(e.length-
4)&&(e=e.substring(0,e.length-4));w.setThemeClass(e,{href:c.theme});c.theme=w}var u;c.readonly||(z={createContentAssistMode:function(a){u=new s.ContentAssist(a.getTextView());a=new s.ContentAssistWidget(u);a=new s.ContentAssistMode(u,a);u.setMode(a);return a}});var B=new m.Editor({textViewFactory:function(){return new x.TextView({parent:k,model:new l.ProjectionTextModel(c.model?c.model:new v.TextModel("")),tabSize:c.tabSize?c.tabSize:4,readonly:c.readonly,fullSelection:c.fullSelection,tabMode:c.tabMode,
expandTab:c.expandTab,singleMode:c.singleMode,themeClass:c.themeClass,theme:c.theme,wrapMode:c.wrapMode,wrappable:c.wrappable})},undoStackFactory:new h.UndoFactory,annotationFactory:new h.AnnotationFactory,lineNumberRulerFactory:new h.LineNumberRulerFactory,foldingRulerFactory:new h.FoldingRulerFactory,textDNDFactory:new h.TextDNDFactory,contentAssistFactory:z,keyBindingFactory:new h.KeyBindingsFactory,statusReporter:c.statusReporter,domNode:k});B.addEventListener("TextViewInstalled",function(){var a=
B.getLineNumberRuler();a&&void 0!==c.firstLineIndex&&a.setFirstLine(c.firstLineIndex);if(a=B.getSourceCodeActions())a.setAutoPairParentheses(c.autoPairParentheses),a.setAutoPairBraces(c.autoPairBraces),a.setAutoPairSquareBrackets(c.autoPairSquareBrackets),a.setAutoPairAngleBrackets(c.autoPairAngleBrackets),a.setAutoPairQuotations(c.autoPairQuotations),a.setAutoCompleteComments(c.autoCompleteComments),a.setSmartIndentation(c.smartIndentation)});z=c.contents;void 0===z&&(z=a(k));z||(z="");B.installTextView();
B.setLineNumberRulerVisible(void 0===c.showLinesRuler||c.showLinesRuler);B.setAnnotationRulerVisible(void 0===c.showAnnotationRuler||c.showFoldingRuler);B.setOverviewRulerVisible(void 0===c.showOverviewRuler||c.showOverviewRuler);B.setZoomRulerVisible(void 0===c.showZoomRuler||c.showZoomRuler);B.setFoldingRulerVisible(void 0===c.showFoldingRuler||c.showFoldingRuler);B.setInput(c.title,null,z,!1,c.noFocus);({styler:null,highlight:function(a,b){this.styler&&this.styler.destroy&&this.styler.destroy();
this.styler=null;"js"===a?a="application/javascript":"css"===a?a="text/css":"html"===a?a="text/html":"java"===a&&(a="text/x-java-source");var d=b.getTextView(),e=b.getAnnotationModel();if(a){var f=a.replace(/[*|:/".<>?+]/g,"_");t(["./stylers/"+f+"/syntax"],function(b){b=new q.createPatternBasedAdapter(b.grammars,b.id,a);this.styler=new q.TextStyler(d,e,b)},function(a){})}"text/css"===a&&b.setFoldingRulerVisible(void 0===c.showFoldingRuler||c.showFoldingRuler)}}).highlight(c.contentType||c.lang,B);
z=g.defaultView||g.parentWindow;!c.noComputeSize&&("none"!==b(z,g,k)&&50>=k.clientHeight)&&(g=B.getTextView().computeSize().height,k.style.height=g+"px");return B}var g=this.orion?this.orion.editor:void 0;if(g){for(var w=0;w<arguments.length;w++)c(g,arguments[w]);g.edit=n}return n});define(["orion/editor/edit"],function(t){return t});